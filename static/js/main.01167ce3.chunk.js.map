{"version":3,"sources":["assets/images/preloader1.gif","assets/images/user.png","components/Profile/Profile.module.css","components/Profile/MyPosts/Post/Post.module.css","components/common/FormsControls/FormsControls.module.css","components/Navbar/Navbar.module.css","components/common/utils/indexedDB.js","api/api.js","redux/auth-reducer.js","components/Header/Header.jsx","components/Navbar/Navbar.jsx","hoc/WithAuthRedirect.jsx","components/common/utils/quotes.js","redux/chats-reducer.js","components/common/Preloader/Preloader.js","components/common/utils/convertTime.js","components/common/FormsControls/FormsControls.jsx","utils/validators/validators.js","components/common/utils/backupQuotes.js","components/common/utils/object-helpers.js","redux/users-reducer.js","components/Users/User.jsx","components/common/Paginator/Paginator.jsx","components/Users/Users.jsx","redux/users-selectors.js","components/Users/UsersSearch.jsx","components/Users/UsersContainer.jsx","customHooks/usersHooks.jsx","components/Chats/ChatItem/ChatItem.jsx","redux/chats-selector.js","redux/app-reducer.js","components/Chats/ChatsContainer.jsx","redux/profile-reducer.js","customHooks/hotEditing.jsx","components/Profile/ProfileInfo/ProfileStatusWithHooks.jsx","components/Profile/ProfileInfo/ProfileInfo.jsx","components/Profile/MyPosts/Post/Post.jsx","components/Profile/MyPosts/MyPosts.jsx","components/Profile/Profile.jsx","customHooks/reduceUnsafeMethods.jsx","components/Login/Login.jsx","components/Profile/UpdateDeleteProfile/UpdateProfile.jsx","components/Chats/Message/EditMessage.jsx","components/Chats/Message/Message.jsx","components/Chats/Message/CreateMessage.jsx","components/Chats/ChatItem/ChatDetail.jsx","App.js","serviceWorker.js","redux/sidebar-reducer.js","redux/redux-store.js","index.js","components/Profile/ProfileInfo/ProfileInfo.module.css","components/Chats/Chats.module.css","components/Profile/MyPosts/MyPosts.module.css","components/Chats/Message/Message.module.css","components/Header/Header.module.css","components/common/Paginator/paginator.module.css","components/Users/Users.module.css"],"names":["module","exports","dbPromise","openDB","upgrade","db","createObjectStore","idbKeyval","key","get","val","put","delete","getAllKeys","instance","axios","baseURL","headers","interceptors","request","use","config","a","token","error","Promise","reject","authAPI","login","password","console","log","post","profileAPI","userId","profileData","status","photo","usersAPI","getUsers","currentPage","query","follow","unfollow","getfollow","chatsAPI","chatPut","chatTypeId","chatId","putType","secondArgName","secondArg","putData","getChats","page","createChat","snusers","name","getChat","deleteChat","clearChat","clearType","this","renameChat","newChatName","updateUnreadMsgs","lastGlobalReadMsgId","toogleMemberStatusForConversation","addMemberForConversation","removeMemberFromConversation","removeMemberMsgsForConversation","removeOneMemberMsgForConversation","setChatPhoto","newChatPhoto","getMessages","readFromIndex","readFromIndexBefore","numOfDeletedMsgs","createMessage","messageBody","fileId","getFile","uploadFile","fileURL","fileName","editMessage","messageId","newMessageBody","deleteMessage","initialState","email","isAuth","setAuthUserData","type","payload","destructAUD","data","dispatchSAUD","dispatch","authReducer","state","action","Header","props","className","s","header","src","loginBlock","onClick","logout","to","HeaderContainer","React","Component","connect","auth","Navbar","nav","item","activeClassName","activeLink","active","mapStateToPropsForRedirect","withAuthRedirect","WrappedComponent","RedirectComponent","replaceQuotes","string","JSON","parse","replace","chatsAliases","messages","chats","currentChat","isFetching","isUnmount","membersToSelect","readFromIndexNext","IsFetchingMsgs","loadingFilesIds","windowScrollOnMsgCreate","isMessageCreating","isRefreshedAfterMC","setCurrentChatMembers","members","setCurrentChatName","setCurrentChatPhoto","chatPhoto","setCurrentChatIdsToStore","currentChatDataFetching","saveImageToIDB","blobObj","urltoFile","url","filename","mimeType","fetch","then","res","arrayBuffer","buf","File","setChats","setMessages","setReadFromIndexes","setFetchingMoreMsgs","shouldWindowScrollDown","setMessageCreating","setRefreshMessageCreating","refreshCurrentChatData","method","requiredDataKey","parseInt","localStorage","getItem","response","resultCode","getChatHelper","chatArray","all","map","chat","id","chatTimeStamp","unfilteredArray","sort","chat1","chat2","getMessagesHelper","array","msg","isRefreshAfterMsgCreating","allKeysForImgs","allMsgs","items","tryIdbKey","includes","length","createMessageSnippent","message","stopSubmit","_error","clearChatTypes","cleared","clearChatMyLocal","clearChatMyGlobal","clearChatAllLocal","clearChatAllGlobal","createChatRequest","created","renameChatRequest","renamed","addMember","chatPutParts","bind","setChatPhotoRequest","apiMethod","onSuccStr","onSuccDataKey","onErrorStr","storeDispatchMethod","chatsReducer","nodm","idbFileMessageKey","body","Preloader","style","backgroundColor","preloader","width","height","convertTime","unix_timestamp","time","Date","hours","getHours","mins","getMinutes","FormControl","input","meta","touched","warning","children","hasError","hasWarn","styles","formControl","TextArea","restProps","child","Input","FileInput","getBase64","file","resolve","reader","FileReader","readAsDataURL","onload","result","onerror","onFileChange","e","targetFile","target","files","onChange","fileInputKey","value","createField","placeholder","component","validators","text","Field","validate","ReduxFormSnippet","pristine","reset","submitting","sumbitButtonName","formSummaryError","disabled","requiredField","maxLength","max","undefined","maxLength30","maxLength50","maxLength200","maxLength1000","backupQuotes","stringify","updateObjectInArray","itmes","itemId","objPropName","newObjProps","users","pageSize","totalUsersCount","followingInProgress","followUnfollowSuccess","userRelation","setUsers","setCurrentPage","setTotalUsersCount","count","toggleIsFetching","toggleFollowingProgress","searchUsers","totalCount","followUnfollowFlow","actionCreator","response2","usersReducer","l","filter","User","user","photos","small","userPhoto","some","ForChatUser","setSelectedForChatUsers","setSelectedForChatUser","selectedForChatUsers","chatUsersIds","styleForUser","userChoosePhoto","alt","selUserId","color","Paginator","totalItemsCount","onPageChanged","portionSize","pagesCount","Math","ceil","pages","i","push","portionCount","useState","portionNumber","setPortionNumber","leftPortionPageNumber","rightPortionPageNumber","paginator","p","cn","selectedPage","pageNumber","Users","forChat","styleForUsers","u","fWAUFC","clearCurrentFocusedWindow","createSelector","usersPage","getQuery","getPageSize","getTotalUsersCount","getCurrentPage","getIsFetching","getFollowingInProgress","UsersSearchReduxForm","reduxForm","form","handleSubmit","onSubmit","defaultValue","setQuery","htmlFor","formData","search","compose","useEffect","useUsersEffects","fWUFCID","ChangeChatPhotoFormRedux","msgStyle","addBorder","ChangeChatPhoto","newPhotoObject","RenameChatFormRedux","RenameChat","Member","member","memberStyle","chatMemberSettings","setMemberOperShow","setSelectedMember","memberName","memberPhoto","event","Members","membersShow","memberOperShow","selectedMember","memberOpers","styleMessages","chatsMembersActive","chatsMembers","smthElseListActive","smthElseList","memberOper","subElemMSBs","infoItemMSBs","membOperLink","SelectMemberToChat","getMemberList","stopPropagation","selectedForChatUser","usersForChatActive","userForChat","LastMessage","sended","authorName","chatLMAuthorName","chatLMAuthorNameDotted","chatLMBody","chatLMSended","ChatItem","lastMessage","getCountOfNewGlobalMsgs","chatType","setCurrentChatData","chatPhotoSmall","deleteChatRequest","clearChatByMethod","path","subElem2","addMemberHeader","chatItem","chatItemData","chatItemPhoto","Object","keys","chatItemNewMsgsNum","chatItemName","chatSettings","chatSettingsHeader","chatSettingsMembersListHeader","chatSettingsMembersList","smthElseHeader","subElem","infoItem","renameChatHeader","renameChatItem","changePhotoChat","addMemberItem","addFocusedWindow","selectChats","chatsPage","selectChatMessages","selectCTIPS","selectCIPS","selectCurrentChat","selectFocusedWindowsPS","app","focusedWindows","selectFocusedWindowsIdsPS","focusedWindowsIds","selectFocusedWindow","windowIdKey","find","window","selectFocusedWindowUsersForChat","selectFocusedWindowAddUserForChat","selectFocusedWindowMembersForChat","selectFocusedWindowMemberOperationsForChat","initialized","fWUsersFCId","fWAddUserFCId","fWMembersId","fWMemberOperationsId","newFocusedWindow","currentWindowId","appReducer","CreateChatReduxForm","chatsStyles","createChatForm","myUserId","OLDsnusers","usersToSelect","fWUFC","fWMFC","fWMOFC","setItem","unSetCurrentChatData","createDialog","createConversation","withRouter","iF","setIF","callbackMethod","useUsersSelector","fetchData","setTimeout","chatsElements","chats_header","createChatHeader","toogleFocuseElem","chatsItems","posts","likesCount","profile","setUserProfile","setStatus","setUpdateUserProfile","getUserProfile","contacts","updateUserProfile","profileReducer","newPost","newPostText","postId","useHotEditing","startFieldValue","apiFunction","editMode","setEditMode","fieldValue","setFieldValue","isInvalid","setisInvalid","charCount","setCharCount","activateEditMode","deactivateEditMode","onFieldValueChange","every","valid","currentTarget","chars","currLen","ProfileStatusWithHooks","updateStatus","onStatusChange","ENSM","onDoubleClick","autoFocus","onBlur","ProfileInfo","updatePhoto","large","profile_info","landi_block","descriptionBlock","ava_block","username","userinfo","href","Post","AddNewPostFormRedux","profilePage","addPost","postsElements","postsBlock","myPostsHeader","createPost","deleteUserProfile","exchangeNotSafeMethods","setExchangeNotSafeMethods","shown","setShown","isReduced","useForbidUnsafeMethods","reduceMethods","match","params","history","profile_wrapper","LoginReduxForm","UpdateProfileReduxForm","lookingForAJob","lFAJ","setLFAJ","checked","lookingForAJobDescription","fullname","github","vk","facebook","instagram","twitter","website","youtube","mainLink","profileRedirect","setProfileRedirect","addProfleFilledProperty","obj","prop","subObjects","start","startsWith","split","profProp","reduce","EditMessageActive","onMBChange","editedMessage","editField","errorField","countChars","EditMessageInactive","fileImageURL","loadFile","messageFile","fileImageDeactivate","fileImageActivate","EditMessage","fileIDBKey","loadImageFromIDB","setFIU","loadFromIdb","fileIDBValue","forwardRef","ref","inputRef","useRef","useImperativeHandle","node","current","editMessageRequest","deleteMessageRequest","downloadFile","messageAuthorName","authorId","messageSendedEdited","messageSended","messageEdited","edited","msgCreationStyleForm","CreateMessageReduxForm","createMessageRequest","fileUploadResponse","getMessageTagWithRef","refCondition","withNewMsgsTag","NMTRefCondition","newMsgsStartTag","local","_chatTypeId","_chatId","getCurrentChatData","isUpdated","toogleMemberStatus","removeMemberMsgs","removeOneMemberMsg","removeMember","downloadedFile","format","fileConv","isImage","upload","blob","URL","createObjectURL","saveAs","revokeObjectURL","ImgKey","_readFromIndexNext","_readFromIndex","oldMsgsDonwload","setOldMsgsDonwload","preFetch","setPreFetch","refToTopAtStart","setRTTAS","positioningScrollRefScroll","setPSRS","refOMDPSR","refAtStart","refToObserve","refreshIsRunning","setRIR","refLastMsg","ULTIMATE_CALLBACK","firstNewMsgID","scrollIntoView","steps","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","innerText","unobserve","threshold","Array","fill","_","index","observe","nodeToScrollType","nodeToScroll","conditionNTS","nodeToObserve","scrollTop","scrollHeight","populatePreFetchData","sTOID","clearTimeout","fetchOldMsgs","beforeMsgsDiv","loadOldMsgsDiv","startChatDiv","dataToMsg","flat","unshift","chatMember","styleChats","selectedMemberId","chatsHeader","chatsHeaderPhoto","chatsHeaderPhotoAlt","chatsHeaderName","chatsHeaderSettings","chatsSettings","chatsSettingsItem","chatsSettingsItemH","chatsSettingsItemForm","chatsMembersHeader","createMessageForm","App","memo","initializeApp","clearAllFocusedWindows","render","Profile","exact","detail","catch","Boolean","location","hostname","sidebarReducer","reducers","combineReducers","sidebar","formReducer","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","store","createStore","applyMiddleware","thunkMiddleware","__store__","reactDebugHooks","ReactDOM","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"2FAAAA,EAAOC,QAAU,IAA0B,wC,oBCA3CD,EAAOC,QAAU,IAA0B,kC,oBCC3CD,EAAOC,QAAU,CAAC,gBAAkB,mC,oBCApCD,EAAOC,QAAU,CAAC,KAAO,mBAAmB,MAAQ,sB,qGCApDD,EAAOC,QAAU,CAAC,YAAc,mCAAmC,MAAQ,6BAA6B,QAAU,+BAA+B,iBAAmB,0C,mBCApKD,EAAOC,QAAU,CAAC,IAAM,oBAAoB,KAAO,qBAAqB,WAAa,6B,iNCwG/EC,EAAYC,YAAO,eAAgB,EAAG,CAC1CC,QAD0C,SAClCC,GACNA,EAAGC,kBAAkB,aAIZC,EAAY,SACbC,GAAM,OAAD,oHACCN,EADD,uCACYO,IAAI,SAAUD,IAD1B,8CADJD,EAAY,SAIbC,EAAKE,GAAM,OAAD,oHACJR,EADI,uCACOS,IAAI,SAAUD,EAAKF,IAD1B,8CAJTD,EAAY,SAOVC,GAAM,OAAD,oHACFN,EADE,uCACSU,OAAO,SAAUJ,IAD1B,8CAPPD,EAAY,WAaT,OAAD,oHACGL,EADH,uCACcW,WAAW,WADzB,8CCxHTC,EAAWC,SAAa,CAE1BC,QAAS,kCACTC,QAAS,CACL,eAAgB,sBAIxBH,EAASI,aAAaC,QAAQC,IAA9B,uCACI,WAAOC,GAAP,eAAAC,EAAA,sEAEsBf,EAAc,SAFpC,cAEQgB,EAFR,QAKQF,EAAOJ,QAAP,cAAkC,UAAYM,SAEvCF,EAAOJ,QAAP,cAPf,kBAYWI,GAZX,2CADJ,uDAeI,SAAAG,GACIC,QAAQC,OAAOF,MAKhB,IAAMG,EAAU,WAEf,OAAOb,EAASL,IAAI,iBAFfkB,EAAU,SAIbC,EAAOC,GAET,OADAC,QAAQC,IAAIH,EAAO,OAASC,GACrBf,EAASkB,KAAK,kBAAmB,CAAC,SAAYJ,EAAO,SAAYC,KAanEI,EAAa,SACXC,GACP,OAAOpB,EAASL,IAAT,sBAA4ByB,EAA5B,OAFFD,EAAa,SAKRE,GAEV,OAAOrB,EAASH,IAAI,eAAgBwB,IAP/BF,EAAa,WAUlB,OAAOnB,EAASF,OAAO,iBAVlBqB,EAAa,SAeTG,GACT,OAAOtB,EAASH,IAAI,sBAAuB,CAAC,OAAUyB,KAhBjDH,EAAa,SAqBVI,GAER,OAAOvB,EAASH,IAAI,qBAAsB,CAAC,OAAU0B,KAKhDC,EAAW,CACpBC,SADoB,WACkB,IAA7BC,EAA4B,uDAAd,EAAGC,EAAW,uDAAL,KAG5B,OADAX,QAAQC,IAAR,yBAA8BS,EAA9B,cAA+CC,IAChC,OAARA,EAAe3B,EAASL,IAAT,yBAA+B+B,IAAiB1B,EAASL,IAAT,yBAA+B+B,EAA/B,cAAgDC,KAK1HC,OAToB,SASbR,GAEH,OAAOpB,EAASkB,KAAT,qBAA4BE,EAA5B,OAEXS,SAboB,SAaXT,GACL,OAAOpB,EAASF,OAAT,qBAA8BsB,EAA9B,OAEXU,UAhBoB,SAgBVV,GACN,OAAOpB,EAASL,IAAT,qBAA2ByB,EAA3B,QAIFW,EAAW,CAEpBC,QAFoB,SAEZC,EAAYC,EAAQC,EAASC,EAAeC,GAEhD,IAAIC,EAAU,CAAC,QAAWH,GAE1B,OADAG,EAAQF,GAAiBC,EAClBrC,EAASH,IAAT,oBAA0BoC,EAA1B,YAAwCC,EAAxC,KAAmDI,IAI9DC,SAVoB,SAUXC,EAAMb,GACX,OAAe,OAARA,EACH3B,EAASL,IAAT,0BAAgC6C,IAChCxC,EAASL,IAAT,0BAAgC6C,EAAhC,kBAA8Cb,KAEtDc,WAfoB,SAeTC,GAAoB,IAAXC,EAAU,uDAAL,KACrB,OAAc,OAAPA,EACa3C,EAASkB,KAAK,oBAAqB,CAACwB,UAASC,SAC7C3C,EAASkB,KAAK,oBAAqB,CAACwB,aAE5DE,QApBoB,SAoBZX,EAAYC,GAChB,OAAOlC,EAASL,IAAT,oBAA0BsC,EAA1B,YAAwCC,EAAxC,OAEXW,WAvBoB,SAuBTZ,EAAYC,GACnB,OAAOlC,EAASF,OAAT,oBAA6BmC,EAA7B,YAA2CC,EAA3C,OAGXY,UA3BoB,SA2BVb,EAAYC,EAAQC,EAASY,GACnC,OAAOC,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,YAAaY,IAElEE,WA9BoB,SA8BThB,EAAYC,EAAQC,EAASe,GACpC,OAAOF,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,cAAee,IAEpEC,iBAjCoB,SAiCHlB,EAAYC,EAAQC,EAASiB,GAC1C,OAAOJ,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,sBAAuBiB,IAG5EC,kCArCoB,SAqCcpB,EAAYC,EAAQC,EAASf,GAC3D,OAAO4B,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,SAAUf,IAE/DkC,yBAxCoB,SAwCKrB,EAAYC,EAAQC,EAASf,GAClD,OAAO4B,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,SAAUf,IAE/DmC,6BA3CoB,SA2CStB,EAAYC,EAAQC,EAASf,GACtD,OAAO4B,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,SAAUf,IAE/DoC,gCA9CoB,SA8CYvB,EAAYC,EAAQC,EAASf,GACzD,OAAO4B,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,SAAUf,IAE/DqC,kCAjDoB,SAiDcxB,EAAYC,EAAQC,EAASf,GAC3D,OAAO4B,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,SAAUf,IAG/DsC,aArDoB,SAqDPzB,EAAYC,EAAQC,EAASwB,GACtC,OAAOX,KAAKhB,QAAQC,EAAYC,EAAQC,EAAS,eAAgBwB,IAIrEC,YA1DoB,SA0DR3B,EAAYC,EAAQ2B,EAAeC,EAAqBnC,EAAOoC,GAEvE,OAA6B,OAArBA,EACI,OAARpC,EACA3B,EAASL,IAAT,oBAA0BsC,EAA1B,YAAwCC,EAAxC,oCAA0E2B,EAA1E,gCAA+GC,IAC/G9D,EAASL,IAAT,oBAA0BsC,EAA1B,YAAwCC,EAAxC,oCAA0E2B,EAA1E,gCAA+GC,EAA/G,kBAA4InC,IAEpI,OAARA,EACA3B,EAASL,IAAT,oBAA0BsC,EAA1B,YAAwCC,EAAxC,oCAA0E2B,EAA1E,gCAA+GC,EAA/G,6BAAuJC,IACvJ/D,EAASL,IAAT,oBAA0BsC,EAA1B,YAAwCC,EAAxC,oCAA0E2B,EAA1E,gCAA+GC,EAA/G,kBAA4InC,EAA5I,6BAAsKoC,KAI9KC,cAvEoB,SAuEN/B,EAAYC,EAAQ+B,GAA0B,IAAbC,EAAY,uDAAL,KAElD,OAAOlE,EAASkB,KAAT,oBAA2Be,EAA3B,YAAyCC,EAAzC,qBAAoE,CAAC+B,cAAaC,YAiB7FC,QA1FoB,SA0FXD,GACL,OAAOlE,EAASL,IAAT,oBAA0BuE,KAiBrCE,WA5GoB,SA4GRC,EAASC,GACjB,OAAOtE,EAASkB,KAAT,aAA4B,CAACmD,UAASC,cAgBjDC,YA7HoB,SA6HRtC,EAAYC,EAAQsC,EAAWC,GAIvC,OAFAzD,QAAQC,IAAR,oBAAyBgB,EAAzB,YAAuCC,EAAvC,qBAA0DsC,EAA1D,MACAxD,QAAQC,IAAI,CAACwD,mBACNzE,EAASH,IAAT,oBAA0BoC,EAA1B,YAAwCC,EAAxC,qBAA2DsC,EAA3D,KAAyE,CAACC,oBAErFC,cAnIoB,SAmINzC,EAAYC,EAAQsC,GAC9B,OAAOxE,EAASF,OAAT,oBAA6BmC,EAA7B,YAA2CC,EAA3C,qBAA8DsC,EAA9D,Q,QCCXG,EAAe,CACfvD,OAAQ,KACRwD,MAAO,KACP9D,MAAO,KACP+D,QAAQ,GAiBCC,EAAkB,SAAC1D,EAAQwD,EAAO9D,EAAO+D,GAAvB,MAAmC,CAACE,KAxB7C,4BAwBkEC,QAAQ,CAAC5D,SAAQwD,QAAO9D,QAAO+D,YAEnHI,EAAc,SAACC,GAEf,MAAO,CAACA,EAAK9D,OAAQ8D,EAAKN,MAAOM,EAAKpE,QAEtCqE,EAAe,SAACC,EAAUF,GAAuB,IAAjBL,IAAgB,yDAChD,OAAOO,EAASN,EAAe,WAAf,cAAmBG,EAAYC,IAA/B,QAAsCL,OA+D3CQ,EAnFK,WAAmC,IAAlCC,EAAiC,uDAAzBX,EAAcY,EAAW,uCAClD,OAAQA,EAAOR,MACX,IAbc,4BAcV,OAAO,2BACAO,GACAC,EAAOP,SAElB,QACI,OAAOM,I,yBClPbE,EAAS,SAACC,GACZ,OAAO,4BAAQC,UAAWC,IAAEC,QACxB,yBAAKC,IAAI,6DAEPJ,EAAMZ,OACR,yBAAKa,UAAWC,IAAEG,YAAaL,EAAM3E,MAArC,MAA8C,uBAAGiF,QAASN,EAAMO,QAAlB,WAE9C,yBAAKN,UAAWC,IAAEG,YAAY,kBAAC,IAAD,CAASG,GAAI,UAAb,YAUhCC,E,uKAME,OAAO,kBAAC,EAAWlD,KAAKyC,W,GANFU,IAAMC,WAcrBC,eALS,SAACf,GAAD,MAAY,CAChCxE,MAAOwE,EAAMgB,KAAKxF,MAClB+D,OAAQS,EAAMgB,KAAKzB,UAGiB,CAACmB,OD0QnB,yDAAM,WAAMZ,GAAN,SAAA5E,EAAA,sEAIlBf,EAAiB,SAJC,OAOxB2F,EAASN,EAAgB,KAAM,KAAM,MAAM,IAPnB,2CAAN,wDC1QPuB,CAAmCH,G,iBCInCK,EAvCA,WACX,OACI,yBAAKb,UAAWC,IAAEa,KACd,yBAAKd,UAAWC,IAAEc,MACd,kBAAC,IAAD,CAASR,GAAG,WAAWS,gBAAiBf,IAAEgB,YAA1C,YAEJ,yBAAKjB,UAAS,UAAKC,IAAEc,KAAP,YAAed,IAAEiB,SAC3B,kBAAC,IAAD,CAASX,GAAG,SAASS,gBAAiBf,IAAEgB,YAAxC,UAEJ,yBAAKjB,UAAS,UAAKC,IAAEc,KAAP,YAAed,IAAEiB,SAC3B,kBAAC,IAAD,CAASX,GAAG,SAASS,gBAAiBf,IAAEgB,YAAxC,UAkBJ,yBAAKjB,UAAS,UAAKC,IAAEc,KAAP,YAAed,IAAEiB,SAC3B,kBAAC,IAAD,CAASX,GAAG,SAASS,gBAAiBf,IAAEgB,YAAxC,Y,wBC7BZE,EAA6B,SAACvB,GAAD,MAAY,CACzCT,OAAQS,EAAMgB,KAAKzB,OACnBzD,OAAQkE,EAAMgB,KAAKlF,SAkBR0F,EAfU,SAACC,GAAuB,IAEvCC,EAFsC,uKAQpC,OAAKhE,KAAKyC,MAAMZ,OACT,kBAACkC,EAAqB/D,KAAKyC,OADH,kBAAC,IAAD,CAAUQ,GAAG,eARR,GAEZE,IAAMC,WAUtC,OAAOC,YAAQQ,EAARR,CAAoCW,IChBhCC,GALO,SAACC,GAGnB,OADAA,EAASC,KAAKC,MAAMF,EAAOG,QAAQ,KAAM,O,UC8CzC1C,GAAe,CACfzC,OAAQ,KACRD,WAAY,KACZqF,aAAc,GACdC,SAAU,GACVC,MAAO,GAGPC,YAAa,KACbC,YAAY,EACZC,WAAW,EAIXC,gBAAiB,GAEjB/D,cAAe,KACfgE,kBAAmB,KACnB/D,oBAAqB,KAErBgE,gBAAgB,EAChBC,gBAAiB,GAQjBC,yBAAyB,EAEzBC,mBAAmB,EAEnBC,oBAAoB,EAGpBnE,iBAAkB,GA2HToE,GAAwB,SAACC,GAAD,MAAc,CAACrD,KA/LpB,2BA+LoDqD,YACvEC,GAAqB,SAAC1F,GAAD,MAAW,CAACoC,KA9LhB,wBA8L6CpC,SAC9D2F,GAAsB,SAACC,GAAD,MAAgB,CAACxD,KAhMrB,yBAgMmDwD,cAIrEC,GAA2B,SAACvG,EAAYC,EAAQuF,GAArB,MAAsC,CAAC1C,KA5MjD,wBA4M8E7C,SAAQD,aAAYwF,gBAEnHgB,GAA0B,SAACf,GAAD,MAAiB,CAAC3C,KA3MtB,6BA2MwD2C,eAe9EgB,GAAiB,SAACC,EAASzE,GAAV,8CAAsB,WAAMkB,GAAN,SAAA5E,EAAA,sEAO1Cf,EAAA,gBAAuByE,GAAUyE,GAPS,2CAAtB,uDAgB9B,SAASC,GAAUC,EAAKC,EAAUC,GAG9B,OAFA/H,QAAQC,IAAI,cAAgB4H,GAC5B7H,QAAQC,IAAI4H,GACJG,MAAMH,GACTI,MAAK,SAASC,GAAK,OAAOA,EAAIC,iBAC9BF,MAAK,SAASG,GAAK,OAAO,IAAIC,KAAK,CAACD,GAAMN,EAAS,CAAC/D,KAAKgE,OAK3D,IAwEMO,GAAW,SAAC9B,GAAD,MAAY,CAACzC,KAlUnB,YAkUoCyC,UACzC+B,GAAc,SAAChC,GAAD,MAAe,CAACxC,KAjUtB,eAiU0CwC,aAUlDiC,GAAqB,SAAC3F,EAAegE,EAAmB/D,GAAnC,MAA4D,CAACiB,KA5TjE,wBA4T8FlB,gBAAegE,oBAAmB/D,wBAIjJ2F,GAAsB,SAAC3B,GAAD,MAAqB,CAAC/C,KA9T/B,oBA8TwD+C,mBASrE4B,GAA0B,SAAC1B,GAAD,MAA8B,CAACjD,KA3TpC,4BA2TqEiD,4BAG1F2B,GAAqB,SAAC1B,GAAD,MAAwB,CAAClD,KA7T9B,uBA6T0DkD,sBAC1E2B,GAA4B,SAAC1B,GAAD,MAAyB,CAACnD,KA7TxB,qCA6TkEmD,uBA0GhG2B,GAAyB,SAACC,EAAQC,GAAT,8CAA6B,WAAM3E,GAAN,mBAAA5E,EAAA,6DAC3D0B,EAAS8H,SAASC,aAAaC,QAAQ,WACvCjI,EAAa+H,SAASC,aAAaC,QAAQ,eAFgB,SAG1CnI,EAASa,QAAQX,EAAYC,GAHa,OAI/B,KAD5BiI,EAH2D,QAInDjF,KAAKkF,WACbhF,EAAS0E,EAAOK,EAASjF,KAAKA,KAAK6E,KAEnC/I,QAAQC,IAAI,0CAA2CkJ,EAASjF,KAAKqC,SAAS,IAPnB,2CAA7B,uDAmChC8C,GAAa,uCAAG,WAAMC,GAAN,eAAA9J,EAAA,sEACUG,QAAQ4J,IAAID,EACnCE,IADmC,uCAC/B,WAAOC,GAAP,eAAAjK,EAAA,sEACgBuB,EAASa,QAAQ6H,EAAKxI,WAAYwI,EAAKC,IADvD,UAE2B,KAD5BP,EADC,QAEOjF,KAAKkF,WAFZ,wBAGDD,EAASjF,KAAKA,KAAd,WAAmCuF,EAAKxI,WACxCkI,EAASjF,KAAKA,KAAd,OAA6BuF,EAAKC,GAClCP,EAASjF,KAAKA,KAAd,cAAoCuF,EAAKE,cACpB,IAAlBF,EAAKxI,WACJkI,EAASjF,KAAKA,KAAd,SAA+B,SAE/BiF,EAASjF,KAAKA,KAAd,SAA+B,eATlC,kBAWMiF,EAASjF,KAAKA,MAXpB,eAaDlE,QAAQC,IAAI,iBAAkBkJ,EAASjF,KAAKqC,SAAS,IAbpD,kBAcM,MAdN,4CAD+B,wDADtB,cACdqD,EADc,yBAoBXA,EAAgBC,MAAK,SAACC,EAAMC,GAAP,OAAeA,EAAMJ,cAAgBG,EAAMH,kBApBrD,2CAAH,sDAuCbK,GAAoB,SAACC,EAAOhJ,EAAYC,GAApB,OAA+B+I,EAAMT,KAAI,SAAAU,GAAG,OAAKA,EAAIjJ,GAAYA,EAAYiJ,EAAIhJ,GAAQA,EAAQgJ,MAO9GtH,GAAc,SAAC3B,EAAYC,EAAQ2B,EAAeC,GAApC,IAECnC,EAFD,uDAEO,KAAMwJ,EAFb,uDAEuC,KAAMpH,EAF7C,uDAE8D,EAF9D,8CAEqE,WAAMqB,GAAN,mBAAA5E,EAAA,6DAE5F4E,EAASqE,IAAoB,IAC1B1F,EAAmB,GAClBqB,EA9LmC,CAACL,KA3TX,6BAqf+D,SAMvEhD,EAAS6B,YAAY3B,EAAYC,EAAQ2B,EAAeC,EAAqBnC,EAAOoC,GANb,UAO5D,KAD5BoG,EANwF,QAOhFjF,KAAKkF,WAP2E,iCAS7D3K,IAT6D,OASpF2L,EAToF,OAWpFC,EAAUL,GAAkBb,EAASjF,KAAKA,KAAKoG,MAAOrJ,EAAYC,GACrDsI,KAAK,SAACU,GACH,GAAkB,OAAfA,EAAIhH,OAAgB,CAEnB,IAAIqH,EAAS,gBAAYL,EAAIhH,QAC1BkH,EAAeI,SAASD,KAGvBL,EAAG,WAAiBK,GAG5B,OAAOL,KAI3B9F,EAASmE,GAAY8B,IAElBA,EAAQI,OAAS,EAChBrG,EAASoE,GAAmB6B,EAAQ,GAAGX,GAAIP,EAASjF,KAAKA,KAAK2C,kBAAmBsC,EAASjF,KAAKA,KAAKpB,sBAEpGsB,EAASoE,GAAmB3F,EAAesG,EAASjF,KAAKA,KAAK2C,kBAAmBsC,EAASjF,KAAKA,KAAKpB,sBAIrGqH,IACC/F,EAASsE,IAAuB,IAChCtE,EAASwE,IAA0B,KArCiD,wBA4CxF5I,QAAQC,IAAI,qBAAsBkJ,EAASjF,KAAKqC,SAAS,IA5C+B,QAgD5FnC,EAASqE,IAAoB,IAhD+D,4CAFrE,uDA2ErBiC,GAAqB,uCAAG,WAAMzJ,EAAYC,EAAQ+B,EAAaC,EAAQkB,GAA/C,iBAAA5E,EAAA,sEACLuB,EAASiC,cAAc/B,EAAYC,EAAQ+B,EAAaC,GADnD,OAEM,KAD5BiG,EADsB,QAEdjF,KAAKkF,WACbhF,EAASsE,IAAuB,KAG5BiC,EAAUxB,EAASjF,KAAKqC,SAASkE,OAAUtB,EAASjF,KAAKqC,SAAS,GAAK,aAC3EnC,EAASwG,YAAW,gBAAiB,CAACC,OAAQF,MAPxB,2CAAH,8DAuErBG,GAAiB,CAAC,UAAW,WAAY,WAAY,aAC9ChJ,GAAY,SAACb,EAAYC,EAAQC,EAASY,GAA9B,8CAA4C,WAAMqC,GAAN,eAAA5E,EAAA,sEAM5CuB,EAASe,UAAUb,EAAYC,EAASC,EAASY,GANL,UAQjC,KAF5BoH,EAN6D,QAQrDjF,KAAKkF,WARgD,yCAStDD,EAASjF,KAAKA,KAAK6G,SATmC,OAW7D/K,QAAQC,IAAI,0BAA2BkJ,EAASjF,KAAKqC,SAAS,IAXD,2CAA5C,uDAcZyE,GAAmB,SAAC/J,EAAYC,GAAb,IAAqBC,EAArB,uDAA6B,QAASY,EAAtC,uDAAgD+I,GAAe,GAA/D,OAAwEhJ,GAAUb,EAAYC,EAAQC,EAASY,IAClIkJ,GAAoB,SAAChK,EAAYC,GAAb,IAAqBC,EAArB,uDAA6B,QAASY,EAAtC,uDAAgD+I,GAAe,GAA/D,OAAuEhJ,GAAUb,EAAYC,EAAQC,EAASY,IAClImJ,GAAoB,SAACjK,EAAYC,GAAb,IAAqBC,EAArB,uDAA6B,QAASY,EAAtC,uDAAgD+I,GAAe,GAA/D,OAAuEhJ,GAAUb,EAAYC,EAAQC,EAASY,IAClIoJ,GAAqB,SAAClK,EAAYC,GAAb,IAAqBC,EAArB,uDAA6B,QAASY,EAAtC,uDAAgD+I,GAAe,GAA/D,OAAuEhJ,GAAUb,EAAYC,EAAQC,EAASY,IAInII,GAAmB,SAAClB,EAAYC,EAAQkB,GAArB,IAA0CjB,EAA1C,uDAAkD,mBAAlD,8CAAyE,WAAMiD,GAAN,eAAA5E,EAAA,sEAGhFuB,EAASoB,iBAAiBlB,EAAYC,EAAQC,EAASiB,GAHyB,cAMrE,KAH5B+G,EAHiG,QAMzFjF,KAAKkF,WACbpJ,QAAQC,IAAI,4BAEZD,QAAQC,IAAI,0BATqF,kBAW9FkJ,GAX8F,2CAAzE,uDAenBiC,GAAoB,SAAC1J,EAASC,GAAV,8CAAmB,WAAMyC,GAAN,iBAAA5E,EAAA,sEAE3BuB,EAASU,WAAWC,EAASC,GAFF,OAIhB,KAF5BwH,EAF4C,QAIpCjF,KAAKkF,WACbpJ,QAAQC,IAAI,8BAAgCkJ,EAASjF,KAAKA,KAAKmH,UAE/DrL,QAAQC,IAAI,2BACR0K,EAAUxB,EAASjF,KAAKqC,SAASkE,OAAUtB,EAASjF,KAAKqC,SAAS,GAAK,aAC3EnC,EAASwG,YAAW,aAAc,CAACC,OAAQF,MATC,2CAAnB,uDA6BpBW,GAAoB,SAACrK,EAAYC,EAAQgB,GAArB,IAAkCf,EAAlC,uDAA0C,SAA1C,8CAAuD,WAAMiD,GAAN,iBAAA5E,EAAA,sEAE/DuB,EAASkB,WAAWhB,EAAYC,EAAQC,EAASe,GAFc,OAIpD,KAF5BiH,EAFgF,QAIxEjF,KAAKkF,YACbpJ,QAAQC,IAAI,gBAAiBkJ,EAASjF,KAAKA,KAAKqH,SAChDnH,EAASyE,GAAuBxB,GAAoB,WAEhDsD,EAAUxB,EAASjF,KAAKqC,SAASkE,OAAUtB,EAASjF,KAAKqC,SAAS,GAAK,aAC3EnC,EAASwG,YAAW,aAAc,CAACC,OAAQF,MATqC,2CAAvD,uDA8BpBa,GAAY,SAACvK,EAAYC,EAAQd,GAArB,IAA6Be,EAA7B,uDAAqC,YAArC,8CAAqD,WAAMiD,GAAN,SAAA5E,EAAA,6DAC1EQ,QAAQC,IAAI,iBACZD,QAAQC,IAAIgB,EAAYC,EAAQd,GAF0C,SAUpEqL,GAAaxK,EAAYC,EAAQd,EAAQe,EAASJ,EAASuB,yBAAyBoJ,KAAK3K,GAAW,iBAAkB,cAAe,oBAAqBqD,EAAU+C,GAAuB,WAVvH,2CAArD,uDAsDZwE,GAAsB,SAAC1K,EAAYC,EAAQyB,GAArB,IAAmCxB,EAAnC,uDAA2C,eAA3C,8CAA8D,WAAMiD,GAAN,SAAA5E,EAAA,sEACvFiM,GAAaxK,EAAYC,EAAQyB,EAAcxB,EAASJ,EAAS2B,aAAagJ,KAAK3K,GAAW,uBAAwB,qBAAsB,8BAA+BqD,EAAUkD,GAAqB,aADnH,2CAA9D,uDAK7BmE,GAAY,uCAAG,WAAMxK,EAAYC,EAAQI,EAASH,EAASyK,EAAWC,EAAWC,EAAeC,GAAjF,mCAAAvM,EAAA,6DAA6F4E,EAA7F,+BAAsG,KAAM4H,EAA5G,+BAAgI,KAAMjD,EAAtI,kCAAsJ,KAAtJ,SAEI6C,EAAU3K,EAAYC,EAAQC,EAASG,GAF3C,cAIe,KAF5B6H,EAFa,QAILjF,KAAKkF,YACbpJ,QAAQC,IAAI4L,EAAY1C,EAASjF,KAAKA,KAAK4H,IAC3CE,GAAuB5H,EAASyE,GAAuBmD,EAAqBjD,MAExE4B,EAAUxB,EAASjF,KAAKqC,SAASkE,OAAUtB,EAASjF,KAAKqC,SAAS,GAAK,aAC3EvG,QAAQC,IAAI8L,EAAapB,IATZ,kBAWVxB,GAXU,2CAAH,oEAaH8C,GAjwBM,WAAmC,IAAlC3H,EAAiC,uDAAzBX,GAAcY,EAAW,uCACnD,OAAQA,EAAOR,MAEX,IAhDwB,0BAiDpB,IAAImI,EAAO5H,EAAMvB,iBAAmB,EACpC,OAAO,2BAAIuB,GAAX,IAAkBvB,iBAAkBmJ,IAExC,IAnDyB,2BAoDrB,IAAIA,EAAO,EACX,OAAO,2BAAI5H,GAAX,IAAkBvB,iBAAkBmJ,IAKxC,IAhGU,YAiGN,OAAO,2BAAI5H,GAAX,IAAkBkC,MAAOjC,EAAOiC,QAEpC,IAlGoB,sBAmGhB,OAAO,2BAAIlC,GAAX,IAAkBgC,aAAc/B,EAAO+B,eAE3C,IApGa,eAqGT,OAAO,2BAAIhC,GAAX,IAAkBiC,SAAUhC,EAAOgC,WAEvC,IAtGsB,wBAuGlB,OAAO,2BAAIjC,GAAX,IAAkBpD,OAAQqD,EAAOrD,OAAQD,WAAYsD,EAAOtD,WAAYwF,YAAalC,EAAOkC,cAEhG,IArGkB,oBAsGd,OAAO,2BAAInC,GAAX,IAAkBqC,UAAWpC,EAAOoC,YAGxC,IA1G2B,6BA2GvB,OAAO,2BAAIrC,GAAX,IAAkBoC,WAAYnC,EAAOmC,aAGzC,IA1GwB,2BA2GpB,OAAO,2BAAIpC,GAAX,IAAkBmC,YAAY,2BAAKnC,EAAMmC,aAAZ,IAAyBW,QAAS7C,EAAO6C,YAE1E,IA3GsB,wBA4GlB,OAAO,2BAAI9C,GAAX,IAAkBmC,YAAY,2BAAKnC,EAAMmC,aAAZ,IAAyB9E,KAAM4C,EAAO5C,SAEvE,IA/GuB,yBAgHnB,OAAO,2BAAI2C,GAAX,IAAkBmC,YAAY,2BAAKnC,EAAMmC,aAAZ,IAAyBc,UAAWhD,EAAOgD,cAU5E,IApHsB,wBAqHlB,OAAO,2BAAIjD,GAAX,IAAkBzB,cAAe0B,EAAO1B,cAAegE,kBAAmBtC,EAAOsC,kBAAmB/D,oBAAqByB,EAAOzB,sBAKpI,IAxHkB,oBAyHd,OAAO,2BAAIwB,GAAX,IAAkBwC,eAAgBvC,EAAOuC,iBAY7C,IAzH0B,4BA0HtB,OAAO,2BAAIxC,GAAX,IAAkB0C,wBAAyBzC,EAAOyC,0BAWtD,IApIqB,uBAqIjB,OAAO,2BAAI1C,GAAX,IAAkB2C,kBAAmB1C,EAAO0C,oBAEhD,IAtImC,qCAuI/B,OAAO,2BAAI3C,GAAX,IAAkB4C,mBAAoB3C,EAAO2C,qBAGjD,IAnIuB,yBAoInB,OAAO,2BAAI5C,GAAX,IAAkBiC,SAAUhC,EAAO4H,oBAmBvC,IA3La,eA4LT,OAAO,2BAAI7H,GAAX,IAAkBiC,SAAUjC,EAAMiC,SAASiD,KAAI,SAAAU,GAAG,OAAKA,EAAIR,KAAOnF,EAAOf,UAAlB,2BAAmC0G,GAAnC,IAAwCkC,KAAM7H,EAAOd,iBAAkByG,OAElI,QACI,OAAO5F,I,qBChMJ+H,GANC,SAAC5H,GACb,OAAO,yBAAM6H,MAAQ,CAAEC,gBAAiB,UACpC,yBAAK1H,IAAK2H,KAAWF,MAAQ,CAAEG,MAAO,MAAOC,OAAQ,W,+CCJhDC,GAAc,SAACC,GACxB,IAAIA,EAAgB,MAAO,GAC3B,IAAIC,EAAO,IAAIC,KAAsB,IAAjBF,GAChBG,EAAQF,EAAKG,WAAY,GAAjB,WAA0BH,EAAKG,YAAeH,EAAKG,WAC3DC,EAAOJ,EAAKK,aAAe,GAApB,WAA6BL,EAAKK,cAAgBL,EAAKK,aAClE,MAAM,GAAN,OAAUH,EAAV,YAAmBE,I,8BCOjBE,GAAc,SAAC,GAAyD,EAAvDC,MAAwD,IAAD,IAAhDC,KAAOC,EAAyC,EAAzCA,QAAS5N,EAAgC,EAAhCA,MAAO6N,EAAyB,EAAzBA,QAAUC,EAAe,EAAfA,SACrDC,EAAWH,GAAW5N,EACtBgO,EAAUJ,GAAWC,EAC3B,OACI,yBAAK7I,UAAWiJ,KAAOC,YAAc,KAAOH,EAAWE,KAAOjO,MAAO,IAAM,KAAOgO,EAAUC,KAAOJ,QAAS,KACxG,yBAAK7I,UAAU,IACV8I,GAEL,yBAAK9I,UAAU,IAEV+I,GAAY,8BAAO/N,IACnBgO,GAAW,8BAAOH,MAQtBM,GAAW,SAACpJ,GAAW,IACxB2I,EAAqC3I,EAArC2I,MAAuBU,GAAcrJ,EAA9B4I,KAA8B5I,EAAxBsJ,MADU,aACctJ,EADd,2BAE/B,OAAQ,kBAAC,GAAgBA,EAAO,8CAAc2I,EAAWU,MAGhDE,GAAQ,SAACvJ,GAAW,IACrB2I,EAAqC3I,EAArC2I,MAAuBU,GAAcrJ,EAA9B4I,KAA8B5I,EAAxBsJ,MADO,aACiBtJ,EADjB,2BAO5B,OAAQ,kBAAC,GAAgBA,EAAO,2CAAW2I,EAAWU,MAgH7CG,GAAY,SAACxJ,GAAW,IAEzB2I,EAAqC3I,EAArC2I,MAEFc,GAFuCzJ,EAA9B4I,KAA8B5I,EAAxBsJ,MAFW,aAEatJ,EAFb,0BAId,SAAC0J,GACjB,OAAO,IAAIxO,SAAQ,SAACyO,EAASxO,GAC3B,IAAMyO,EAAS,IAAIC,WACnBD,EAAOE,cAAcJ,GACrBE,EAAOG,OAAS,kBAAMJ,EAAQC,EAAOI,SACrCJ,EAAOK,QAAU,SAAAhP,GAAK,OAAIE,EAAOF,SAI/BiP,EAAY,uCAAG,WAAOC,GAAP,mBAAApP,EAAA,yDACX4N,EAAU3I,EAAV2I,QACFyB,EAAaD,EAAEE,OAAOC,MAAM,IAFf,gCAICb,EAAUW,GAJX,OAIXjQ,EAJW,OAKjBwO,EAAM4B,SAAS,CAAC,QAAWpQ,EAAK,SAAWiQ,EAAWlN,OALrC,uBAOjByL,EAAM4B,SAAS,MAPE,4CAAH,sDAYZC,EAAe7B,EAAM8B,MAAQ9B,EAAM8B,MAAMvN,MAAQ,IAAImL,KAE3D,OAEI,2BACEpO,IAAKuQ,EACLlL,KAAK,OACLiL,SAAUL,KAoDPQ,GAAc,SAACC,EAAazN,EAAM0N,EAAWC,GAAmC,IAAvB7K,EAAsB,uDAAhB,GAAI8K,EAAY,uDAAP,GACjF,OAAO,yBAAK7K,UAAU,IAAG,kBAAC8K,GAAA,EAAD,eAAOJ,YAAaA,EAAazN,KAAMA,EAAM0N,UAAWA,EAAWI,SAAUH,GAAgB7K,IAAS8K,IAgCtHG,IA5BuBvK,IAAMC,UA4BV,SAAC,GAA+D,IAA7DuK,EAA4D,EAA5DA,SAAUC,EAAkD,EAAlDA,MAAOC,EAA2C,EAA3CA,WAAYnQ,EAA+B,EAA/BA,MAAOoQ,EAAwB,EAAxBA,iBACnE,OACI,oCAEIpQ,GACA,yBAAKgF,UAAWiJ,KAAOoC,kBAClBrQ,GAGL,yBAAKgF,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,GAAcC,IAE9D,yBAAKpL,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,EAAY9K,QAAS6K,GAAjE,aC9RHK,GAAgB,SAAAf,GACzB,IAAGA,EACH,MAAO,qBAILgB,GAAY,SAAAC,GAAG,OAAI,SAAAjB,GAAK,OAC1BA,GAASA,EAAMzE,OAAS0F,EAAxB,uCAA8DA,EAA9D,iBAA6EC,IAIpEC,IADcH,GAAU,IACVA,GAAU,KACxBI,GAAcJ,GAAU,IACxBK,GAAeL,GAAU,KACzBM,GAAgBN,GAAU,K,UCRxBO,GANM,SAACvK,GAIlB,OAFAA,EAASC,KAAKuK,UAAUxK,GAAQG,QAAQ,KAAM,MCFrCsK,GAAsB,SAACC,EAAOC,EAAQC,EAAaC,GAE5D,OAAOH,EAAMpH,KAAK,SAAA/D,GACd,OAAIA,EAAKqL,KAAiBD,EACf,2BAAIpL,GAASsL,GAEjBtL,MCMX9B,GAAe,CACfqN,MAAO,GACPC,SAAU,EACVC,gBAAiB,EACjBxQ,YAAa,EACbgG,YAAY,EACZyK,oBAAqB,GACrBxQ,MAAO,IAkDEyQ,GAAwB,SAAChR,EAAQiR,GAAT,MAA2B,CAACtN,KAhEzC,kBAgEgE3D,SAAQiR,iBAEnFC,GAAW,SAACN,GAAD,MAAY,CAACjN,KAjEnB,YAiEoCiN,UACzCO,GAAiB,SAAC7Q,GAAD,MAAkB,CAACqD,KAjExB,mBAiEgDrD,gBAC5D8Q,GAAqB,SAACN,GAAD,MAAsB,CAACnN,KAjE3B,wBAiEwD0N,MAAOP,IAChFQ,GAAmB,SAAChL,GAAD,MAAiB,CAAC3C,KAjEvB,qBAiEiD2C,eAC/DiL,GAA0B,SAACjL,EAAYtG,GAAb,MAAyB,CAAC2D,KAjE5B,+BAiEgE2C,aAAYtG,WAuBpGwR,GAAc,SAACpQ,EAAMb,GAC9B,8CAAO,WAAMyD,GAAN,eAAA5E,EAAA,6DACH4E,EAASsN,IAAiB,IAC1BtN,EAASmN,GAAe/P,IAFrB,SAImBhB,EAASC,SAASe,EAAMb,GAJ3C,OAICwI,EAJD,OAOH/E,EAASsN,IAAiB,IAC1BtN,EAASkN,GAASnI,EAASjF,KAAK8M,MAAM1G,QACtClG,EAASoN,GAAmBrI,EAASjF,KAAK8M,MAAMa,aAT7C,2CAAP,uDAaEC,GAAkB,uCAAG,WAAM1N,EAAUhE,EAAQwL,EAAWmG,GAAnC,iBAAAvS,EAAA,6DACvB4E,EAASuN,IAAwB,EAAMvR,IADhB,SAGDwL,EAAUxL,GAHT,UAKU,KAF7B+I,EAHmB,QAKVjF,KAAKkF,YAAsC,KAAlBD,EAASjF,KALxB,gCAMG1D,EAASM,UAAUV,GANtB,OAQe,KAF9B4R,EANe,QAQL9N,KAAKkF,YACfhF,EAAS2N,EAAc3R,EAAQ4R,EAAU9N,KAAKA,KAAKmN,eATpC,OAYvBjN,EAASuN,IAAwB,EAAOvR,IAZjB,4CAAH,4DA0BT6R,GApHM,WAAmC,IAAlC3N,EAAiC,uDAAzBX,GAAcY,EAAW,uCACnD,OAAOA,EAAOR,MACV,IAbU,YAcN,OAAO,2BAAIO,GAAX,IAAkB3D,MAAM4D,EAAO5D,QAEnC,IAtBgB,kBAwBZ,OAAO,2BACA2D,GADP,IAEI0M,MAAOL,GAAoBrM,EAAM0M,MAAOzM,EAAOnE,OAAQ,SAAU,CAACiR,aAAc9M,EAAO8M,iBAQ/F,IAjCU,YAkCN,OAAO,2BAAK/M,GAAZ,IAAmB0M,MAAOzM,EAAOyM,QAErC,IAnCiB,mBAoCb,OAAO,2BAAK1M,GAAZ,IAAmB5D,YAAa6D,EAAO7D,cAE3C,IArCsB,wBAsClB,OAAO,2BAAK4D,GAAZ,IAAmB4M,gBAAiB3M,EAAOkN,QAE/C,IAvCmB,qBAwCf,OAAO,2BAAKnN,GAAZ,IAAmBoC,WAAYnC,EAAOmC,aAE1C,IAzC6B,+BA4CzB,IAAIwL,EAAC,2BACE5N,GADF,IAED6M,oBAAqB5M,EAAOmC,WAAP,sBACXpC,EAAM6M,qBADK,CACgB5M,EAAOnE,SACtCkE,EAAM6M,oBAAoBgB,QAAO,SAAAzI,GAAE,OAAIA,IAAOnF,EAAOnE,YAG/D,OAAO8R,EAEX,QACI,OAAO5N,I,yCCZJ8N,GA7CJ,SAAC,GAAmD,IAAlDC,EAAiD,EAAjDA,KAAMlB,EAA2C,EAA3CA,oBAAqBtQ,EAAsB,EAAtBA,SAAUD,EAAY,EAAZA,OAG9C,OAFAZ,QAAQC,IAAIoS,GAGT,6BACS,8BACI,6BACG,kBAAC,IAAD,CAASpN,GAAI,YAAcoN,EAAKjS,QAC/B,yBAAKyE,IAA0B,MAArBwN,EAAKC,OAAOC,MAAgBF,EAAKC,OAAOC,MAAQC,KACrD9N,UAAWiJ,KAAO6E,cAG3B,6BAC4B,iBAAtBH,EAAKhB,cAAyD,WAAtBgB,EAAKhB,aAG3C,4BAAQrB,SAAUmB,EACbsB,MAAK,SAAA/I,GAAE,OAAIA,IAAO2I,EAAKjS,UAClB2E,QAAS,WAAQlE,EAASwR,EAAKjS,UAFzC,YAQA,4BAAQ4P,SAAUmB,EACbsB,MAAK,SAAA/I,GAAE,OAAIA,IAAO2I,EAAKjS,UAClB2E,QAAS,WAAQnE,EAAOyR,EAAKjS,UAFvC,YAQZ,8BACI,8BACI,6BAAMiS,EAAK1Q,MACX,6BAAM0Q,EAAK/R,YActBoS,GAAc,SAAC,GAAyH,IAAxHL,EAAuH,EAAvHA,KAAMM,EAAiH,EAAjHA,wBAAyBC,EAAwF,EAAxFA,uBAAwBC,EAAgE,EAAhEA,qBAAsBC,EAA0C,EAA1CA,aAA0C,EAA5BC,aAA4B,iIAKhJ,OACI,6BACI,kBAAC,IAAD,CAAS9N,GAAI,YAAcoN,EAAKjS,QAC5B,6BAAOiS,EAAK1Q,MACZ,yBAAK+C,UAAWiJ,KAAOqF,iBAAiB,yBAAKnO,IAAKwN,EAAKC,OAAOC,MAAOU,IAAI,UAE3EJ,EAEEA,EAAqBrI,SAAS6H,EAAKjS,QAEnC,uBAAG2E,QAAS,WAAK4N,EAAyBE,EAAqBV,QAAO,SAAAe,GAAS,OAAIA,IAAcb,EAAKjS,aAAtG,eAKA,uBAAG2E,QAAS,WAAK4N,EAAwB,GAAD,mBAAKE,GAAL,CAA2BR,EAAKjS,YAAxE,YAGA0S,EAAatI,SAAS6H,EAAKjS,QACvB,yBAAKkM,MAAO,CAAC6G,MAAM,SAAnB,eAGH,uBAAGpO,QAAS,WAER6N,EAAuBP,EAAKjS,QAC5BJ,QAAQC,IAAI,0DAA2DoS,EAAKjS,UAHhF,gB,kDC1CFgT,GArCC,SAAC,GAKb,IAL4F,IAA9EC,EAA6E,EAA7EA,gBAAiBpC,EAA4D,EAA5DA,SAAUvQ,EAAkD,EAAlDA,YAAa4S,EAAqC,EAArCA,cAAqC,IAAtBC,mBAAsB,MAAR,GAAQ,EAEvFC,EAAaC,KAAKC,KAAKL,EAAkBpC,GAEzC0C,EAAQ,GACHC,EAAI,EAAGA,GAAKJ,EAAYI,IAC7BD,EAAME,KAAKD,GAGf,IAAIE,EAAeL,KAAKC,KAAKF,EAAaD,GATiD,EAUnDQ,mBAAS,GAV0C,mBAUtFC,EAVsF,KAUvEC,EAVuE,KAWvFC,GAAyBF,EAAgB,GAAKT,EAAc,EAC5DY,EAAyBH,EAAgBT,EAG7C,OAAO,yBAAK7O,UAAWiJ,KAAOyG,WACxBJ,EAAgB,GAClB,4BAAQjP,QAAS,kBAAMkP,EAAiBD,EAAgB,KAAxD,QAEKL,EACIxB,QAAO,SAAAkC,GAAC,OAAIA,GAAKH,GAAyBG,GAAGF,KAC7C3K,KAAI,SAAC6K,GACN,OAAO,0BAAM3P,UAAY4P,KAAG,gBACvB3G,KAAO4G,aAAe7T,IAAgB2T,GACxC1G,KAAO6G,YACG9V,IAAK2V,EACLtP,QAAS,SAAC6J,GACN0E,EAAce,KACdA,MAEvBP,EAAeE,GACb,4BAAQjP,QAAS,kBAAMkP,EAAiBD,EAAgB,KAAxD,UCYGS,GAxCH,SAAC,GAE0D,IAFzD/T,EAEwD,EAFxDA,YAAawQ,EAE2C,EAF3CA,gBAAiBD,EAE0B,EAF1BA,SAAUqC,EAEgB,EAFhBA,cAAetC,EAEC,EAFDA,MAEC,IAFM0D,eAEN,SADsB/B,EACtB,EADsBA,wBAAyBC,EAC/C,EAD+CA,uBAAyBE,EACxE,EADwEA,aAC1ID,EAAkE,EAAlEA,qBAAqCE,GAA6B,EAA5C4B,cAA4C,EAA7B5B,cAAkBtO,EAAW,uNAIlE,OAAO,6BACH,kBAAC,GAAD,CAAW/D,YAAaA,EAAa4S,cAAeA,EACzCD,gBAAiBnC,EAAiBD,SAAUA,IACvD,6BAEQD,EAAMxH,KAAI,SAAAoL,GAAC,OAAIF,EAAU,kBAAC,GAAD,CAAarC,KAAMuC,EAExBjC,wBAA0BA,EAC1BC,uBAAwBA,EACxBC,qBAAsBA,EACtBE,aAAeA,EACfD,aAAgBA,EAKhB+B,OAAQpQ,EAAMoQ,OACdC,0BAA2BrQ,EAAMqQ,0BAIhCpW,IAAKkW,EAAElL,KAEP,kBAAC,GAAD,CAAM2I,KAAMuC,EACZzD,oBAAqB1M,EAAM0M,oBAC3BzS,IAAKkW,EAAElL,GACP7I,SAAU4D,EAAM5D,SAChBD,OAAQ6D,EAAM7D,e,SC5BtCH,GAAWsU,cATiB,SAAAzQ,GACrC,OAAQA,EAAM0Q,UAAUhE,SAQuC,SAACA,GAGhE,OAFQA,EAAMxH,KAAI,SAAAoL,GAAC,kCAASA,GAAT,IAAYtC,OAAQrM,GAAc2O,EAAEtC,gBAK9C2C,GAAW,SAAA3Q,GACpB,OAAOA,EAAM0Q,UAAUrU,OAGduU,GAAc,SAAA5Q,GACvB,OAAQA,EAAM0Q,UAAU/D,UAGfkE,GAAqB,SAAA7Q,GAC9B,OAAQA,EAAM0Q,UAAU9D,iBAIfkE,GAAiB,SAAA9Q,GAC1B,OAAQA,EAAM0Q,UAAUtU,aAIf2U,GAAgB,SAAA/Q,GACzB,OAAQA,EAAM0Q,UAAUtO,YAIf4O,GAAyB,SAAAhR,GAClC,OAAQA,EAAM0Q,UAAU7D,qBCZtBoE,GAAuBC,aAAU,CAACC,KAAK,eAAhBD,EArBL,SAAA/Q,GAAU,IACtBiR,EAA4DjR,EAA5DiR,aAAc/F,EAA8ClL,EAA9CkL,SAAUC,EAAoCnL,EAApCmL,MAAOC,EAA6BpL,EAA7BoL,WAAYnQ,EAAiB+E,EAAjB/E,MAAOiB,EAAU8D,EAAV9D,MAC1D,OACI,0BAAMgV,SAAUD,GACXvG,GAAYxO,EAAO,SAAUqN,GAAO,CAACsC,IAAc,CAACsF,aAAcjV,IAEnEjB,GACA,yBAAKgF,UAAWiJ,KAAOoC,kBAClBrQ,GAGL,yBAAKgF,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,GAA5C,QAEJ,yBAAKnL,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,EAAY9K,QAAS6K,GAAjE,qBA4BDvK,gBANS,SAACf,GAAD,MAAY,CAChC5D,YAAa0U,GAAe9Q,GAC5B3D,MAAOsU,GAAS3Q,MAIoB,CAACsN,eAAaiE,SLgB9B,SAAClV,GAAD,MAAY,CAACoD,KAzDnB,YAyDoCpD,WKhBvC0E,EApBK,SAACZ,GAOjB,OAAQ,oCACJ,yBAAKC,UAAU,IACX,2BAAOoR,QAAQ,IAAf,YAAkC,kBAACP,GAAD,CAAsBI,SAR/C,SAACI,GACdtR,EAAMoR,SAASE,EAASC,QACxBvR,EAAMmN,YAAYnN,EAAM/D,YAAaqV,EAASC,SAMkCrV,MAAO8D,EAAM9D,aCqEtFsV,eACX5Q,aAdkB,SAACf,GACnB,MAAO,CACH0M,MAAOvQ,GAAS6D,GAChB2M,SAAUiE,GAAY5Q,GACtB4M,gBAAiBiE,GAAmB7Q,GACpC5D,YAAa0U,GAAe9Q,GAC5BoC,WAAY2O,GAAc/Q,GAC1B6M,oBAAqBmE,GAAuBhR,GAC5C3D,MAAOsU,GAAS3Q,MAMK,CAAE1D,ONgBT,SAACR,GACnB,OAAO,SAACgE,GACJ0N,GAAmB1N,EAAUhE,EAAQI,EAASI,OAAO8K,KAAKlL,GAAW4Q,MMlBtCvQ,SNqBf,SAACT,GACrB,OAAO,SAACgE,GACJ0N,GAAmB1N,EAAUhE,EAAQI,EAASK,SAAS6K,KAAKlL,GAAW4Q,MMvB9BG,kBAAgBI,2BAAyBlR,SN7B9D,SAACe,EAAMyP,GAE/B,8CAAO,WAAM7M,GAAN,eAAA5E,EAAA,6DACH4E,EAASsN,IAAiB,IAC1BtN,EAASmN,GAAe/P,IAFrB,SAImBhB,EAASC,SAASe,GAJrC,OAIC2H,EAJD,OAOH/E,EAASsN,IAAiB,IAC1BtN,EAASkN,GAASnI,EAASjF,KAAK8M,MAAM1G,QACtClG,EAASoN,GAAmBrI,EAASjF,KAAK8M,MAAMa,aAT7C,2CAAP,uDM2B8GD,iBADnGqE,EA3EQ,SAACxR,GAAU,MClCH,SAAChE,EAAUmR,EAAajR,EAAOD,EAAauQ,GACvEiF,qBAAU,WACE,KAARvV,EAAaF,EAASC,EAAauQ,GAAYW,EAAYlR,EAAaC,KACzE,CAACD,IAKJ,MAAO,CAHe,SAAC8T,GACX,KAAR7T,EAAaF,EAAS+T,EAAYvD,GAAYW,EAAY4C,EAAY7T,KDgClDwV,CAAgB1R,EAAMhE,SAAUgE,EAAMmN,YAAanN,EAAM9D,MAAO8D,EAAM/D,YAAa+D,EAAMwM,UAA1GqC,EAJuB,oBAS9B,OAAQ,yBAAK5O,UAAWD,EAAMkQ,cAAgBlQ,EAAMkQ,cAAe,IAC9DlQ,EAAMiC,WAAa,kBAAC,GAAD,MAAgB,KACpC,6BACI,kBAAC,GAAD,OAEgB,IAAlBjC,EAAM2R,QAOR,uBAAGrR,QAAU,kBAAON,EAAMqQ,0BAA0BrQ,EAAM2R,WAA1D,iBAGE,KAEF,kBAAC,GAAD,CAEIlF,gBAAiBzM,EAAMyM,gBACvBD,SAAUxM,EAAMwM,SAChBvQ,YAAa+D,EAAM/D,YACnB4S,cAAeA,EACftC,MAAOvM,EAAMuM,MACbpQ,OAAQ6D,EAAM7D,OACdC,SAAU4D,EAAM5D,SAChBsQ,oBAAqB1M,EAAM0M,oBAG3BuD,QAAWjQ,EAAMiQ,QAGjB/B,wBAA2BlO,EAAMkO,wBACjCC,uBAA0BnO,EAAMmO,uBAChCE,aAAgBrO,EAAMqO,aAOtB+B,OAAQpQ,EAAMoQ,OACdC,0BAA2BrQ,EAAMqQ,0BAGjCjC,qBAAsBpO,EAAMoO,qBAC5B8B,cAAgBlQ,EAAMkQ,cACtB5B,aAActO,EAAMsO,mBEvC1BsD,GAA2Bb,aAAU,CAACC,KAAM,kBAAjBD,EAVL,SAAC/Q,GAAW,IAC5BiR,EAA+DjR,EAA/DiR,aAAc/F,EAAiDlL,EAAjDkL,SAAUC,EAAuCnL,EAAvCmL,MAAOC,EAAgCpL,EAAhCoL,WAAYnQ,EAAoB+E,EAApB/E,MAAO4W,EAAa7R,EAAb6R,SAC1D,OACI,0BAAMX,SAAUD,EAAchR,UAAS,UAAK4R,EAAL,YAAiB3R,KAAE4R,YACrDpH,GAAY,QAAS,QAASnB,GAAO,CAACwC,KACvC,kBAAC,GAAD,CAAmBb,SAAUA,EAAUC,MAAOA,EAAOC,WAAYA,EAAYnQ,MAAOA,EAAOoQ,iBAAkB,qBAQ5G0G,GAAkB,SAAC,GAA4D,IAA3D7K,EAA0D,EAA1DA,oBAAqB1K,EAAqC,EAArCA,WAAYC,EAAyB,EAAzBA,OAAyB,IAAjBoV,gBAAiB,MAAR,GAAQ,EAKvF,OAAQ,kBAACD,GAAD,CAA0BV,SAJjB,SAACI,GACd,IAAIU,EAAiBhG,GAAa,CAAC,MAAS,KAAM,MAASsF,EAAQ,QACnEpK,EAAoB1K,EAAYC,EAAQuV,IAEUH,SAAUA,KAgB9DI,GAAsBlB,aAAU,CAACC,KAAM,cAAjBD,EAXL,SAAC/Q,GAAW,IACvBiR,EAA+DjR,EAA/DiR,aAAc/F,EAAiDlL,EAAjDkL,SAAUC,EAAuCnL,EAAvCmL,MAAOC,EAAgCpL,EAAhCoL,WAAYnQ,EAAoB+E,EAApB/E,MAAO4W,EAAa7R,EAAb6R,SAE1D,OACI,0BAAMX,SAAUD,EAAchR,UAAS,UAAK4R,EAAL,YAAiB3R,KAAE4R,YACrDpH,GAAY,OAAQ,OAAQnB,GAAO,CAACuC,KACrC,kBAAC,GAAD,CAAmBZ,SAAUA,EAAUC,MAAOA,EAAOC,WAAYA,EAAYnQ,MAAOA,EAAOoQ,iBAAkB,oBAO5G6G,GAAa,SAAC,GAA0D,IAAzDrL,EAAwD,EAAxDA,kBAAmBrK,EAAqC,EAArCA,WAAYC,EAAyB,EAAzBA,OAAyB,IAAjBoV,gBAAiB,MAAR,GAAQ,EAIhF,OAAQ,kBAACI,GAAD,CAAqBf,SAHZ,SAACI,GACdzK,EAAkBrK,EAAYC,EAAQ6U,EAAQ,OAEDO,SAAUA,KAKlDM,GAAS,SAAC,GAAsG,IAApGC,EAAmG,EAAnGA,OAAQC,EAA2F,EAA3FA,YAA2F,IAA9EC,0BAA8E,MAA3D,KAA2D,MAArDC,yBAAqD,MAAnC,KAAmC,MAA7BC,yBAA6B,MAAX,KAAW,EACxH,OACI,oCACA,yBAAKvS,UAAWoS,GACZ,kBAAC,IAAD,CAAS7R,GAAI,YAAc4R,EAAOnN,IAC9B,yBAAKhF,UAAWC,KAAEuS,YAAaL,EAAOlV,MACtC,yBAAK+C,UAAWC,KAAEwS,aAAa,yBAAKtS,IAAKgS,EAAOvE,OAAOC,MAAOU,IAAI,UAErE8D,EAAqB,uBAAGrS,UAAWqS,EAAoBhS,QAAS,SAACqS,GAAWH,EAAkBJ,EAAOnN,IAAKsN,EAAkBI,KAAvG,cAAgI,QASrJC,GAAU,SAAC,GAAyE,IAAxEjQ,EAAuE,EAAvEA,QAASkQ,EAA8D,EAA9DA,YAAaC,EAAiD,EAAjDA,eAAgBC,EAAiC,EAAjCA,eAAgBC,EAAiB,EAAjBA,YAE3E,OACI,oCAEA,yBAAK/S,UAAW4S,EAAcI,KAAcC,mBAAqBD,KAAcE,cAC3E,yBAAKlT,UAAW4S,EAAcI,KAAcC,mBAAqBD,KAAcE,cAAexQ,IAGlG,yBAAK1C,UAAyB,UAAd6S,EAAoBG,KAAcG,mBAAyBlT,KAAEmT,eAExEL,EAAYjO,KAAI,SAAAuO,GAAU,OACvB,yBAAKrT,UAAS,UAAKgT,KAAcM,YAAnB,YAAkCN,KAAcO,eAC1D,uBAAGvT,UAAS,UAAKgT,KAAcQ,cAAgBnT,QAASgT,EAAWjP,OAAO0O,IAAkBO,EAAWpW,aAS9GwW,GAAqB,SAAC1T,GAO/B,OACI,yBAAMC,UAAWC,KAAEyT,cAAerT,QAAS,SAACqS,GAASA,EAAMiB,oBAC3D,kBAAC,GAAD,CACAzF,uBARa,SAAC0F,GACdtY,QAAQC,IAAI,WACZwE,EAAM+G,UAAU/G,EAAMxD,WAAYwD,EAAMvD,OAAQoX,IAOhD5D,SAAS,EACTC,cAAe+C,KAAca,mBAC7BxF,aAAc2E,KAAcc,YAC5B3D,OAAQpQ,EAAMoQ,OACdC,0BAA2BrQ,EAAMqQ,0BAGjChC,aAAcrO,EAAMqO,iBAOtB2F,GAAc,SAAC,GAAkC,IAAhCC,EAA+B,EAA/BA,OAAQtM,EAAuB,EAAvBA,KAAMuM,EAAiB,EAAjBA,WACjC,OACI,oCACI,yBAAKjU,UAAWC,KAAEiU,kBAAmBD,EAArC,KACA,yBAAKjU,UAAWC,KAAEkU,wBAAlB,KAGI,yBAAKnU,UAAWC,KAAEmU,YAAa1M,GACnC,yBAAK1H,UAAWC,KAAEoU,cAAepM,GAAY+L,MA6H1CM,GAvHE,SAAC,GAIK,IAJHC,EAIE,EAJFA,YAAaC,EAIX,EAJWA,wBAAyB9R,EAIpC,EAJoCA,QAAS+R,EAI7C,EAJ6CA,SAAUxX,EAIvD,EAJuDA,KAAMyX,EAI7D,EAJ6DA,mBAAoBnY,EAIjF,EAJiFA,WAAYC,EAI7F,EAJ6FA,OAAQmY,EAIrG,EAJqGA,eAAgB3S,EAIrH,EAJqHA,WACvHsE,EAGE,EAHFA,iBAAkBC,EAGhB,EAHgBA,kBAAmBC,EAGnC,EAHmCA,kBAAmBC,EAGtD,EAHsDA,mBACxDG,EAEE,EAFFA,kBAAmBgO,EAEjB,EAFiBA,kBAAmB9N,EAEpC,EAFoCA,UAAWG,EAE/C,EAF+CA,oBAC9ClH,EACD,yTAOZ8U,EAAoB,SAACzQ,GAEvBA,EAAO7H,EAAYC,IAOnBsY,EAAI,iBAAaL,EAAb,YAAyBxX,EAAzB,KACJmR,EAAe1L,EAAQoC,KAAI,SAAAqN,GAAM,OAAIA,EAAOnN,MAEhD,OADAtC,EAAUA,EAAQoC,KAAI,SAAAqN,GAAM,OAAI,kBAAC,GAAD,CAAQA,OAAQA,EAAQnY,IAAKmY,EAAOnN,GAAIoN,YAAW,UAAKnS,KAAEkS,OAAP,YAAiBlS,KAAE8U,eACnG/S,EAAmB,kBAAC,GAAD,MAIlB,oCAGsB,OAAtBjC,EAAMoQ,OAAO3Q,MAAiBO,EAAMoQ,OAAO3Q,KAAK,KAAOhD,GAAUuD,EAAMoQ,OAAO3Q,KAAK,KAAOjD,GACtF,yBAAKyD,UAAWC,KAAE6G,WACd,yBAAK9G,UAAWC,KAAE+U,iBAClB,kBAAC,GAAD,CAAoBlO,UAAWA,EAAWvK,WAAYA,EAAYC,OAAQA,EAAQ4R,aAAcA,EAC5FgC,0BAA2BrQ,EAAMqQ,0BACjCD,OAAQpQ,EAAMoQ,WAQ1B,yBAAKnQ,UAAWC,KAAEgV,UACd,kBAAC,IAAD,CAAS1U,GAAIuU,EAAM9U,UAAWC,KAAEiV,aAAc7U,QArCvC,WACXqU,EAAmBnY,EAAYC,KAqCvB,yBAAKwD,UAAWC,KAAEkV,eAEM,OAAnBR,EAA0B,yBAAKxU,IAAKwU,IAAqB,yBAAK3U,UAAU,IAAf,mBAGzDoV,OAAOC,KAAKd,GAAaxO,OAAS,EAAI,kBAAC,GAAD,CAAaiO,OAAQO,EAAYP,OAAQtM,KAAM6M,EAAY7M,KAAM1N,IAAKua,EAAYvP,GAAIiP,WAAYM,EAAYN,aAAiB,KAC1K,yBAAKjU,UAAWC,KAAEqV,oBAAqBd,GAEvC,yBAAKxU,UAAWC,KAAEsV,cACbtY,IAGL,yBAAK+C,UAAWC,KAAEuV,cAAlB,YAEI,yBAAKxV,UAAWC,KAAEwV,oBACd,yBAAKzV,UAAWC,KAAEyV,+BAAlB,WAEI,yBAAK1V,UAAWC,KAAE0V,yBACbjT,IAGT,yBAAK1C,UAAWC,KAAE2V,gBAAlB,cAEQ,yBAAK5V,UAAWC,KAAEmT,cACV,yBAAKpT,UAAS,UAAKC,KAAE4V,QAAP,YAAkB5V,KAAE6V,WAAY,4BAAQzV,QAAS,kBAAMwU,EAAkBvO,KAAzC,8BAC9C,yBAAKtG,UAAS,UAAKC,KAAE4V,QAAP,YAAkB5V,KAAE6V,WAAY,4BAAQzV,QAAS,kBAAMwU,EAAkBtO,KAAzC,+BAC9C,yBAAKvG,UAAS,UAAKC,KAAE4V,QAAP,YAAkB5V,KAAE6V,WAAY,4BAAQzV,QAAS,kBAAMwU,EAAkBrO,KAAzC,+BAC9C,yBAAKxG,UAAS,UAAKC,KAAE4V,QAAP,YAAkB5V,KAAE6V,WAAY,4BAAQzV,QAAS,kBAAMwU,EAAkBpO,KAAzC,kCAG9D,yBAAKzG,UAAWC,KAAE8V,kBAAlB,SAEqB,IAAfxZ,GAAoB,yBAAKyD,UAAWC,KAAE+V,gBACpC,kBAAC,GAAD,CAAYpP,kBAAmBA,EAAmBrK,WAAYA,EAAYC,OAAQA,MAI1F,yBAAKwD,UAAWC,KAAE2V,gBAAlB,mBAEI,yBAAK5V,UAAWC,KAAEmT,cACV,yBAAKpT,UAAS,UAAKC,KAAE4V,QAAP,YAAkB5V,KAAE6V,WAAlC,YAEqB,IAAfvZ,GAAoB,yBAAKyD,UAAWC,KAAEgW,iBACpC,kBAAC,GAAD,CAAiBhP,oBAAqBA,EAAqB1K,WAAYA,EAAYC,OAAQA,MAInG,yBAAKwD,UAAS,UAAKC,KAAE4V,QAAP,YAAkB5V,KAAE6V,WAIjB,IAAfvZ,GACF,yBAAKyD,UAAWC,KAAEiW,eACM,OAAtBnW,EAAMoQ,OAAO3Q,MACX,uBACAa,QACI,SAACqS,GAAD,OAAYA,EAAMiB,kBAAmB5T,EAAMoW,iBAAiBpW,EAAMoQ,OAAOnL,GAAI,CAACzI,EAAYC,MAF9F,gBAWJ,yBAAKwD,UAAS,UAAKC,KAAE9C,WAAP,YAAqB8C,KAAE4V,QAAvB,YAAkC5V,KAAE6V,WAAY,4BAAQzV,QAAS,kBAAMwU,EAAkBD,KAAzC,uBC5QrFwB,GAAc/F,cAHiB,SAAAzQ,GACxC,OAAQA,EAAMyW,UAAUvU,SAE6C,SAACA,GAClE,OAAOA,EAAMgD,KAAI,SAAAC,GAAI,kCAASA,GAAT,IAAerC,QAASqC,EAAKrC,QAAQoC,KAAI,SAAAqN,GAAM,kCAASA,GAAT,IAAiBvE,OAAQrM,GAAc4Q,EAAOvE,aAAY/K,UAAWtB,GAAcwD,EAAKlC,mBAIvJyT,GAAqB,SAAA1W,GAC9B,OAAQA,EAAMyW,UAAUxU,UAIf0U,GAAc,SAAA3W,GACvB,OAAOA,EAAMyW,UAAU9Z,YAEdia,GAAa,SAAA5W,GACtB,OAAOA,EAAMyW,UAAU7Z,QAOdia,GAAoBpG,cAJE,SAAAzQ,GAC/B,OAAQA,EAAMyW,UAAUtU,eAG0C,SAACgD,GACnE,OAAc,OAAPA,EAAA,2BAAkBA,GAAlB,IAAwBrC,QAASqC,EAAKrC,QAAQoC,KAAI,SAAAqN,GAAM,kCAASA,GAAT,IAAiBvE,OAAQrM,GAAc4Q,EAAOvE,aAAY/K,UAAWtB,GAAcwD,EAAKlC,aAAc,QAM5J6T,GAAyB,SAAA9W,GAClC,OAAQA,EAAM+W,IAAIC,gBAETC,GAA4B,SAAAjX,GACrC,OAAQA,EAAM+W,IAAIG,mBAGTC,GAAsB,SAACC,GAAD,OAAiB3G,aAAgBqG,GAAwBG,IAA4B,SAACD,EAAgBE,GAErI,OAAOF,EAAeK,MAAK,SAAAC,GAAM,OAAIA,EAAOlS,KAAO8R,EAAkBE,OAAiB,CAAC,GAAMF,EAAkBE,GAAc,KAAQ,UAG5HG,GAAkCJ,GAAoB,eACtDK,GAAoCL,GAAoB,iBACxDM,GAAoCN,GAAoB,eACxDO,GAA6CP,GAAoB,wBC1C1E9X,I,OAAe,CACfsY,aAAa,EACbX,eAAgB,GAChBE,kBAAmB,CAACU,YAAa,EAAGC,cAAe,EAAGC,YAAa,EAAGC,qBAAsB,KAwCnFxB,GAAmB,SAACnR,EAAIxF,GAAL,MAAe,CAACH,KA/CrB,sBA+C+CuY,iBAAkB,CAAC5S,GAAIA,EAAIxF,KAAMA,KAE9F4Q,GAA4B,SAACyH,GAAD,MAAsB,CAACxY,KA/C3B,+BA+C+DwY,oBAuCrFC,GA9EI,WAAmC,IAAlClY,EAAiC,uDAAzBX,GAAcY,EAAW,uCACjD,OAAQA,EAAOR,MACX,IAboB,sBAehB,OAAO,2BACAO,GADP,IAEI2X,aAAa,IAGrB,IAnBmB,sBAqBf,OAAO,2BACA3X,GADP,IAEIgX,eAAe,GAAD,mBAAMhX,EAAMgX,gBAAZ,CAA4B/W,EAAO+X,qBAGzD,IAzBsB,wBA2Bd,OAAO,2BACAhY,GADP,IAEIgX,eAAgB,KAG5B,IA/B6B,+BAiCzB,OAAO,2BACAhX,GADP,IAEIgX,eAAgBhX,EAAMgX,eAAenJ,QAAO,SAAAyJ,GAAM,OAAGA,EAAOlS,KAAOnF,EAAOgY,qBAGlF,QACI,OAAOjY,ICqDbmY,GAAsBjH,aAAU,CAACC,KAAK,cAAhBD,EA3BL,SAAC/Q,GAAW,IACvBiR,EAAoDjR,EAApDiR,aAAc/F,EAAsClL,EAAtCkL,SAAUC,EAA4BnL,EAA5BmL,MAAOC,EAAqBpL,EAArBoL,WAAYnQ,EAAS+E,EAAT/E,MAQnD,OACI,0BAAMiW,SAAUD,EAAchR,UAAWgY,KAAYC,gBAUhDxN,GAAY,OAAQ,OAAQnB,GAAO,CAACuC,KACrC,kBAAC,GAAD,CAAmBZ,SAAUA,EAAUC,MAAOA,EAAOC,WAAYA,EAAYnQ,MAAOA,EAAOoQ,iBAAkB,oBA2M1GmG,eACXnQ,EACAT,aArBkB,SAACf,GAAD,MAAY,CAC9BkC,MAAOsU,GAAYxW,GACnBT,OAAQS,EAAMgB,KAAKzB,OACnB6C,WAAYpC,EAAMyW,UAAUrU,WAC5BC,UAAWrC,EAAMyW,UAAUpU,UAC3BiW,SAAUtY,EAAMgB,KAAKlF,OACrByc,WAAYvY,EAAMyW,UAAU+B,cAK5BC,MAAOlB,GAAgCvX,GACvCuQ,OAAQiH,GAAkCxX,GAC1C0Y,MAAOjB,GAAkCzX,GACzC2Y,OAAQjB,GAA2C1X,MAO1B,CAAC/C,SlB+NN,eAACC,EAAD,uDAAM,EAAGb,EAAT,uDAAe,KAAf,8CAAwB,WAAMyD,GAAN,iBAAA5E,EAAA,sEAEvBuB,EAASQ,SAASC,EAAMb,GAFD,UAGZ,KAD5BwI,EAFwC,QAGhCjF,KAAKkF,WAH2B,iCAQtBC,GAAcF,EAASjF,KAAKA,KAAKsC,MAAM8D,OARjB,OAQpC9D,EARoC,OASxCpC,EAASkE,GAAS9B,IATsB,wBAWxCxG,QAAQC,IAAI,kBAAmBkJ,EAASjF,KAAKqC,SAAS,IAXd,4CAAxB,uDkB/NgB6S,mBlB8FN,SAACnY,EAAYC,GAAb,OAAwB,SAACkD,GACvDA,EAASqD,IAAwB,IACjCwB,aAAaiU,QAAQ,aAAcjc,GACnCgI,aAAaiU,QAAQ,SAAUhc,GAC/BkD,EAASqD,IAAwB,MkBlGuB0V,qBlBqGxB,kBAAM,SAAC/Y,UAChC6E,aAAY,cACZA,aAAY,WACnB7E,EAASoD,GAAyB,KAAM,KAAM,SkBvG1CwD,oBAAkBC,qBAAmBC,qBAAmBC,sBACxDiS,alByboB,SAAC1b,GAAD,OAAa0J,GAAkB1J,EAAS,OkBzb9C2b,mBlBwbY,SAAC3b,EAASC,GAAV,OAAmByJ,GAAkB1J,EAASC,IkBtbxE2J,qBAAmBE,aAAWG,uBAAqB2N,kBlB2b1B,SAACrY,EAAYC,GAAb,8CAAwB,WAAMkD,GAAN,iBAAA5E,EAAA,sEAChCuB,EAASc,WAAWZ,EAAYC,GADA,OAGhC,MAFjBiI,EADiD,QAGzCjF,KACRlE,QAAQC,IAAI,sBAER0K,EAAUxB,EAASjF,KAAKqC,SAASkE,OAAUtB,EAASjF,KAAKqC,SAAS,GAAK,aAC3EvG,QAAQC,IAAI,4BAA8B0K,IAPO,2CAAxB,uDkBzbzBkQ,oBAAkB/F,+BAEtBwI,IAVWrH,EA9JQ,SAACxR,GAAW,IAAD,EACXsP,oBAAS,GADE,mBACvBwJ,EADuB,KACnBC,EADmB,OAlCF,SAACC,GAA6B,IAAb1D,EAAY,uDAAP,GAAO,EACDhG,mBAAS,IADR,mBAClDlB,EADkD,KAC5BF,EAD4B,KAGnDgD,EAAW,SAACI,GAId0H,EAAc,WAAd,GAAe5K,GAAf,mBAAwCkH,EAAKvQ,KAAI,SAAA9K,GAAG,OAAEqX,EAASrX,UAEnE,MAAO,CAACmU,EAAsBF,EAAyBgD,GA4BW+H,CAAiBjZ,EAAM4Y,mBAAoB,CAAC,SAHhF,mBAGvBxK,EAHuB,KAGDF,EAHC,KAGwBgD,EAHxB,KAmC9B,GAtBAO,qBAAU,YACS,uCAAG,sBAAA1W,EAAA,0DACX+d,EADW,uBAEV9Y,EAAM0Y,uBAFI,SAGJ1Y,EAAMlD,WAHF,OAIVic,GAAM,GAJI,2CAAH,qDAWfG,KACD,CAAClZ,EAAO8Y,IAEXrH,qBAAU,WArBNlW,QAAQC,IAAI,iBACZ2d,WAAU,sBAAC,sBAAApe,EAAA,sEAAiBiF,EAAMlD,WAAvB,2CAAoC,KAC/CvB,QAAQC,IAAI,eAqBZD,QAAQC,IAAI,uCACb,CAACwE,IAID8Y,EAAI,OAAO,kBAAC,GAAD,MAKd,IAAIM,EAAgBpZ,EAAM+B,MACjBgD,KAAI,SAAAC,GAAI,OAAI,kBAAC,GAAD,CAAUwP,YAAaxP,EAAKwP,YACrCC,wBAAyBzP,EAAKyP,wBAC9B9R,QAASqC,EAAKrC,QAASzF,KAAM8H,EAAK9H,KAClCwX,SAAU1P,EAAK0P,SAAUjY,OAAQuI,EAAKvI,OACtCD,WAAYwI,EAAKxI,WAAYvC,IAAK+K,EAAKC,GACvC0P,mBAAoB3U,EAAM2U,mBAC1BC,eAAkB5P,EAAKlC,UAAUgL,MACjC7L,WAAYjC,EAAMiC,WAElBsE,iBAAkBvG,EAAMuG,iBAAkBC,kBAAmBxG,EAAMwG,kBAAmBC,kBAAmBzG,EAAMyG,kBAAmBC,mBAAoB1G,EAAM0G,mBAC5JG,kBAAmB7G,EAAM6G,kBACzBK,oBAAqBlH,EAAMkH,oBAC3BH,UAAW/G,EAAM+G,UAEjB8N,kBAAmB7U,EAAM6U,kBAEzBzE,OAAQpQ,EAAMoQ,OACdC,0BAA2BrQ,EAAMqQ,0BACjC+F,iBAAkBpW,EAAMoW,sBAKpC,OACI,oCACA,yBAAKnW,UAAWgY,KAAYlW,OACxB,yBAAK9B,UAAWgY,KAAYoB,cAA5B,SACA,yBAAKpZ,UAAWgY,KAAYjb,YAC5B,yBAAKiD,UAAWgY,KAAYqB,kBAA5B,sBACKlL,EAAqBpI,OAAS,GAAK,kBAACgS,GAAD,CAAqB9G,SAAUA,EAAUjU,QAAS+C,EAAM/C,QAASkb,SAAUnY,EAAMmY,WAE/F,OAArBnY,EAAMsY,MAAM7Y,KAET,yBAAMQ,UAAWgY,KAAYtE,cAAerT,QAAS,SAACqS,GAASA,EAAMiB,oBACjE,kBAAC,GAAD,CAEA1F,wBAAyBA,EAAyB+B,SAAS,EAC3D7B,qBAAsBA,EACtB8B,cAAe+C,KAAca,mBAAoBxF,aAAc2E,KAAcc,YAC7E1D,0BAA2BrQ,EAAMqQ,0BACjCsB,QAAW3R,EAAMsY,MAAMrT,GACvBsU,iBAAkBvZ,EAAMuZ,mBAIS,IAAhCnL,EAAqBpI,QAClB,uBAAG1F,QAAS,WAAON,EAAM2Y,aAAavK,EAAqB,IAAKpO,EAAMqQ,0BAA0BrQ,EAAMsY,MAAMrT,MAA5G,kBAKR,uBAAGhF,UAAWgY,KAAYtE,cAC1BrT,QACI,SAACqS,GAASA,EAAMiB,kBAChB5T,EAAMoW,iBAAiBpW,EAAMsY,MAAMrT,IAAI,KAH3C,2BAoCJ,yBAAKhF,UAAWgY,KAAYuB,YACvBJ,QCnPjBla,GAAe,CACfua,MAAO,CACH,CAACxU,GAAI,EAAGiB,QAAS,mBAAoBwT,WAAY,IACjD,CAACzU,GAAI,EAAGiB,QAAS,qBAAuBwT,WAAY,IACpD,CAACzU,GAAI,EAAGiB,QAAS,SAAUwT,WAAY,IACvC,CAACzU,GAAI,EAAGiB,QAAS,OAAQwT,WAAY,KAGzCC,QAAS,KACT9d,OAAQ,IA0DC+d,GAAiB,SAACD,GAAD,MAAc,CAACra,KA1EpB,mBA0E4Cqa,YACxDE,GAAY,SAAChe,GAAD,MAAa,CAACyD,KAvEpB,aAuEsCzD,WAE5Cie,GAAuB,SAACle,GAAD,MAAkB,CAAC0D,KA5EhC,sBA4EsD1D,gBAGhEme,GAAiB,SAACpe,GAAD,8CAAY,WAAMgE,GAAN,iBAAA5E,EAAA,sEAEjBW,EAAsBC,GAFL,OAGL,KAD7B+I,EAFkC,QAGzBjF,KAAKkF,cACVgV,EAAUjV,EAASjF,KAAKA,MACpBoO,OAASrM,GAAcmY,EAAQ9L,QACvC8L,EAAQK,SAAWxY,GAAcmY,EAAQK,UACzCra,EAASia,GAAeD,KAPU,2CAAZ,uDAYjBM,GAAoB,SAACre,GAAD,8CAAiB,WAAM+D,GAAN,mBAAA5E,EAAA,sEAGzBW,EAAyBE,GAHA,OAId,KAD5B8I,EAH0C,QAIlCjF,KAAKkF,YAEV,WADCgV,EAAUjV,EAASjF,KAAKA,QAExBka,EAAQ9L,OAASrM,GAAcmY,EAAQ9L,SAEvC,aAAc8L,IACdA,EAAQK,SAAWxY,GAAcmY,EAAQK,WAE7Cra,EAASma,GAAqBH,MAE1BzT,EAAUxB,EAASjF,KAAKqC,SAASkE,OAAUtB,EAASjF,KAAKqC,SAAS,GAAK,aAC3EnC,EAASwG,YAAW,gBAAiB,CAACC,OAAQF,MAfJ,2CAAjB,uDAoFlBgU,GA5JQ,WAAmC,IAAlCra,EAAiC,uDAAzBX,GAAcY,EAAW,uCAErD,OAAOA,EAAOR,MACV,IA1BS,WA2BL,IAAI6a,EAAU,CACVlV,GAAI,EACJiB,QAASpG,EAAOsa,YAChBV,WAAY,GAEhB,OAAO,2BACA7Z,GADP,IAEI4Z,MAAM,GAAD,mBAAM5Z,EAAM4Z,OAAZ,CAAmBU,MAGhC,IApCY,cAqCR,OAAO,2BAAIta,GAAX,IAAkB4Z,MAAO5Z,EAAM4Z,MAAM/L,QAAO,SAAAkC,GAAC,OAAIA,EAAE3K,KAAOnF,EAAOua,YAGrE,IAtCiB,mBAuCb,OAAO,2BAAIxa,GAAX,IAAkB8Z,QAAS7Z,EAAO6Z,UAGtC,IAzCe,sBA0CX,OAAO,2BAAI9Z,GAAX,IACQ8Z,QAAQ,uCACJ9Z,EAAM8Z,SACP7Z,EAAOlE,aAFH,IAGPiS,OAAO,2BAAKhO,EAAM8Z,QAAQ9L,QAAW/N,EAAOlE,YAAYiS,QACxDmM,SAAS,2BAAKna,EAAM8Z,QAAQK,UAAala,EAAOlE,YAAYoe,cAQxE,IApDW,aAsDP,OAAO,2BAAIna,GAAX,IAAkB8Z,QAAQ,2BAAM9Z,EAAM8Z,SAAb,IAAsB9d,OAAQiE,EAAOjE,WAElE,IAvDU,YAwDN,OAAO,2BAAIgE,GAAX,IAAkB8Z,QAAQ,2BAAK9Z,EAAM8Z,SAAZ,IAAqB9L,OAAQ/N,EAAO+N,WAEjE,QACI,OAAOhO,I,yCC/ENya,GAAgB,SAACC,EAAiBC,GAA6C,IAAhC3P,EAA+B,uDAApB,GAAIY,EAAgB,uDAAN,EAAM,EACzD6D,oBAAS,GADgD,mBAClFmL,EADkF,KACxEC,EADwE,OAErDpL,mBAASiL,GAF4C,mBAElFI,EAFkF,KAEtEC,EAFsE,OAGvDtL,oBAAS,GAH8C,mBAGlFuL,EAHkF,KAGvEC,EAHuE,OAKvDxL,mBAAS,GAAD,OAAIiL,EAAgBvU,OAApB,YAA8ByF,IALiB,mBAKlFsP,EALkF,KAKvEC,EALuE,KAOvFvJ,qBAAU,WACNmJ,EAAcL,KACf,CAACA,IACJ,IAAMU,EAAmB,WACrBP,GAAY,IAEVQ,EAAqB,WACvBR,GAAY,IACXG,GAAaL,EAAYG,IAExBQ,EAAqB,SAAChR,GACrBU,EAAWuQ,OAAM,SAAAC,GAAK,YAAmC1P,IAA/B0P,EAAMlR,EAAEmR,cAAc7Q,WAC/CqQ,GAAa,GACbF,EAAczQ,EAAEmR,cAAc7Q,OAC9B8Q,EAAMpR,EAAEmR,cAAc7Q,MAAMzE,OAAQyF,IAExCqP,GAAa,IAIXS,EAAQ,SAACC,EAAS/P,GACpBuP,EAAa,GAAD,OAAIQ,EAAJ,YAAe/P,KAI/B,MAAO,CAACwP,EAAkBC,EAAoBC,EAAoBV,EAAUE,EAAYE,EAAWE,ICIxFU,GA/BgB,SAACzb,GAAW,IAAD,EACiEsa,GAActa,EAAMnE,OAAQmE,EAAM0b,aAAc,CAAC9P,IAAc,IADhI,mBAC/BqP,EAD+B,KACbC,EADa,KACOS,EADP,KACuBlB,EADvB,KACiC5e,EADjC,eAGtC,OACI,yBAAKoE,UAAU,IACTD,EAAM4b,KAeJ,6BACI,6BACI,yCAAe5b,EAAMnE,QAAU,aAhBvC,8BACM4e,GACE,6BACI,0BAAMoB,cAAeZ,GAArB,WAAgDjb,EAAMnE,QAAU,YAGvE4e,GACG,6BACI,2BAAOlQ,SAAUoR,EAAgBG,WAAW,EAAMC,OAAQb,EACtDzQ,MAAO5O,QC6CxBmgB,GAhCK,SAAC,GAAkD,IAAhDrC,EAA+C,EAA/CA,QAAS+B,EAAsC,EAAtCA,aAA2BE,GAAW,EAAxBK,YAAwB,EAAXL,MAEvD,OAAKjC,GAGLpe,QAAQC,IAAIme,EAAQ9L,OAAOqO,OAEvB,yBAAKjc,UAAWC,KAAEic,cACd,yBAAKlc,UAAWC,KAAEkc,aACd,yBACIhc,IAAI,sGAEZ,yBAAKH,UAAWC,KAAEmc,kBACd,yBAAKpc,UAAWC,KAAEoc,WACd,yBAAKlc,IAAKuZ,EAAQ9L,OAAOqO,MAAO1N,IAAI,kBAExC,yBAAKvO,UAAWC,KAAEqc,UAAlB,aAAuC5C,EAAQzc,MAC/C,yBAAK+C,UAAWC,KAAEsc,UACd,gEAGA,kBAAC,GAAD,CAAwB3gB,OAAQ8d,EAAQ9d,OAAQ6f,aAAcA,EAAcE,KAAMA,IAJtF,YAKa,uBAAGvR,OAAO,SAASoS,KAAM9C,EAAQ9L,OAAOqO,OAAxC,iBAnBd,kBAAC,GAAD,O,yCCtBAQ,GAZF,SAAC1c,GACZ,OACE,yBAAKC,UAAWC,KAAEc,MAChB,yBAAKZ,IAAI,4FACLJ,EAAMkG,QACN,6BACF,sCADE,IACkBlG,EAAM0Z,cCa5BiD,GAAsB5L,aAAU,CAAEC,KAAM,yBAAlBD,EAbL,SAAC/Q,GACpB,OACI,0BAAMkR,SAAUlR,EAAMiR,cAAtB,IACI,yBAAKhR,UAAU,IACVyK,GAAY,kBAAmB,cAAetB,GAAU,CAACoC,GAAeI,MAE7E,yBAAK3L,UAAU,IACX,iDAqCDW,gBANS,SAACf,GACrB,MAAO,CACH4Z,MAAO5Z,EAAM+c,YAAYnD,SAIO,CAACoD,QLiClB,SAACzC,GAAD,MAAkB,CAAC9a,KAzEzB,WAyEyC8a,iBKjC3CxZ,EA7BC,SAACZ,GAEb,IAKI8c,EACA9c,EAAMyZ,MAAM1U,KAAI,SAAA6K,GAAC,OAAI,kBAAC,GAAD,CAAM1J,QAAS0J,EAAE1J,QAASwT,WAAY9J,EAAE8J,gBAEjE,OACI,yBAAKzZ,UAAWC,KAAE6c,YACd,yBAAK9c,UAAWC,KAAE8c,eAAlB,YACA,yBAAK/c,UAAWC,KAAE+c,YACd,kBAACN,GAAD,CAAqBzL,SAZf,SAACI,GAEftR,EAAM6c,QAAQvL,EAAS8I,iBAYnB,yBAAKna,UAAWC,KAAEuZ,OACbqD,OC6BFtL,eACXnQ,EACAT,aAPkB,SAACf,GAAD,MAAY,CAC9B8Z,QAAS9Z,EAAM+c,YAAYjD,QAC3Bhe,OAAQkE,EAAMgB,KAAKlF,OACnByD,OAAQS,EAAMgB,KAAKzB,UAIM,CAAC2a,kBAAgB2B,aN8FlB,SAAC7f,GAAD,8CAAY,WAAM8D,GAAN,eAAA5E,EAAA,sEACdW,EAAwBG,GADV,OAChC6I,EADgC,OAEpCnJ,QAAQC,IAAIkJ,GACqB,IAA7BA,EAASjF,KAAKkF,YACdhF,EAASka,GAAUhe,IAJa,2CAAZ,uDM9FgCogB,YNsGjC,SAACngB,GAAD,8CAAW,WAAM6D,GAAN,iBAAA5E,EAAA,sEACZW,EAAuBI,GADX,OAED,KAD7B4I,EAD8B,QAErBjF,KAAKkF,WACdhF,EArF6B,CAACL,KAvEpB,YAuEqCuO,OAqF7B/R,KAEdoK,EAAUxB,EAASjF,KAAKqC,SAASkE,OAAUtB,EAASjF,KAAKqC,SAAS,GAAK,aAC3EnC,EAASwG,YAAW,cAAe,CAACC,OAAQF,MANd,2CAAX,uDMtG8CgX,kBNiExC,yDAAM,WAAMvd,GAAN,SAAA5E,EAAA,yDAEH,IADjBW,IACH+D,KAAKkF,WAFkB,gBAG/BhF,EAASia,GAAe,OACxBha,EAAYW,SAJmB,uCAYNnF,IAZM,OAaK,IAbL,OAafqE,KAAKkF,aACjBhF,EAASia,GAAe,OACxBha,EAAYW,UAfe,4CAAN,uDMjE2D0Z,uBACxFpB,IAHWrH,EApDU,SAACxR,GAAW,IAAD,ECjBE,WAAO,IAAD,EACoBsP,oBAAS,GAD7B,mBACjC6N,EADiC,KACTC,EADS,OAEd9N,oBAAS,GAFK,mBAEjC+N,EAFiC,KAE1BC,EAF0B,KAMxC,MAAO,CAACH,EAAwBC,EAA2BC,EAAOC,EAF5C,SAACjZ,GAAD,IAASkZ,EAAT,uDAAmB,KAAnB,OAAyC,OAAZA,GAAoBA,EAAYJ,GAA0B,aAAS9Y,IDe1BmZ,GAF5D,mBAEzBL,EAFyB,KAEDC,EAFC,KAE0BC,EAF1B,KAEiCC,EAFjC,KAE2CG,EAF3C,KAiChC,OA7BAhM,qBAAU,YACS,uCAAG,4BAAA1W,EAAA,6DAEdY,EAASqE,EAAM0d,MAAMC,OAAOhiB,QAUxBqE,EAAMrE,SAAW4I,SAAS5I,IAEzBwhB,GAA0BC,GAA0B,GAErDD,GAA0BC,GAA0B,KAZxDzhB,EAASqE,EAAMrE,SAGXqE,EAAM4d,QAAQxO,KAAK,UAEvB+N,GAA0BC,GAA0B,IATtC,SAoBZpd,EAAM+Z,eAAepe,GApBT,OAsBlB2hB,GAAS,GAtBS,2CAAH,qDAwBfpE,KACD,CAAClZ,EAAM0d,MAAMC,OAAOhiB,SAGnB0hB,EAGA,yBAAKpd,UAAWC,KAAE2d,iBACd,kBAAC,GAAD,CAAalE,QAAS3Z,EAAM2Z,QAAS+B,aAAc+B,EAAczd,EAAM0b,cAAeO,YAAawB,EAAczd,EAAMic,aAAcL,KAAMuB,KACzIA,GAA0B,yBAAKld,UAAU,IAAG,kBAAC,GAAD,MAAlB,IAA6B,kBAAC,IAAD,CAASO,GAAI,mBAAb,qBAA2D,4BAAQF,QAASN,EAAMkd,mBAAvB,qBAAxF,MALlB,kBAAC,GAAD,SElBhBY,GAAiB/M,aAAU,CAACC,KAAK,SAAhBD,EAtBL,SAAA/Q,GAAU,IAChBiR,EAAqDjR,EAArDiR,aAAc/F,EAAuClL,EAAvCkL,SAAUC,EAA6BnL,EAA7BmL,MAAOC,EAAsBpL,EAAtBoL,WAAYnQ,EAAU+E,EAAV/E,MACnD,OACI,0BAAMiW,SAAUD,GACXvG,GAAY,QAAS,QAASnB,GAAO,CAACiC,KACtCd,GAAY,WAAY,WAAYnB,GAAO,CAACiC,IAAgB,CAAClM,KAAM,aAEpErE,GACA,yBAAKgF,UAAWiJ,KAAOoC,kBAClBrQ,GAGL,yBAAKgF,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,GAA5C,UAEJ,yBAAKnL,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,EAAY9K,QAAS6K,GAAjE,qBA6BDvK,gBALS,SAACf,GAAD,MAAY,CAChCT,OAAQS,EAAMgB,KAAKzB,UAIiB,CAAC/D,MhCoOpB,SAACA,EAAOC,GAAR,8CAAqB,WAAMqE,GAAN,iBAAA5E,EAAA,sEAIhCf,EAAiB,SAJe,uBAKjBoB,EAAcC,EAAOC,GALJ,UAML,KAD7BoJ,EALkC,QAMzBjF,KAAKkF,WANoB,iCAS5B3K,EAAc,QAAS0K,EAASjF,KAAKA,KAAKzE,OATd,OAYlC0E,EAAaC,EAAU+E,EAASjF,KAAKA,MAZH,wBAe9ByG,EAAUxB,EAASjF,KAAKqC,SAASkE,OAAUtB,EAASjF,KAAKqC,SAAS,GAAK,aAC3EnC,EAASwG,YAAW,QAAS,CAACC,OAAQF,KAhBJ,4CAArB,wDgCpONtF,EApBD,SAACZ,GAKX,OAAGA,EAAMZ,OAAgB,kBAAC,IAAD,CAAUoB,GAAG,aAE9B,oCACJ,yBAAKP,UAAU,IACX,qCACA,kBAAC6d,GAAD,CAAgB5M,SARP,SAACI,GACdtR,EAAM3E,MAAMiW,EAASjW,MAAOiW,EAAShW,kBC2BvCyiB,GAAyBhN,aAAU,CAACC,KAAM,iBAAjBD,EArDL,SAAA/Q,GAAU,IAAD,EACPsP,mBAAStP,EAAM2Z,QAAQqE,gBADhB,mBACxBC,EADwB,KAClBC,EADkB,KAKvBjN,EAA8DjR,EAA9DiR,aAAc/F,EAAgDlL,EAAhDkL,SAAUC,EAAsCnL,EAAtCmL,MAAOC,EAA+BpL,EAA/BoL,WAAYnQ,EAAmB+E,EAAnB/E,MAAO0e,EAAY3Z,EAAZ2Z,QAC1D,OACI,0BAAMzI,SAAUD,GACZ,2BAAOI,QAAQ,IAAf,QACC3G,GAAYiP,EAAQzc,KAAM,OAAQqM,GAAO,CAACqC,IAAc,CAACuF,aAAcwI,EAAQzc,OAChF,2BAAOmU,QAAQ,IAAf,UACC3G,GAAYiP,EAAQ9d,OAAQ,SAAUuN,GAAU,CAAC0C,IAAe,CAACqF,aAAcwI,EAAQ9d,SAExF,sCACA,qCACC6O,GAAYiP,EAAQ9L,OAAOqO,MAAO,eAAgB3S,GAAO,KAAM,CAAC4H,aAAcwI,EAAQ9L,OAAOqO,QARlG,IASI,2BAAO7K,QAAQ,IAAf,SACC3G,GAAYiP,EAAQ9L,OAAOC,MAAO,eAAgBvE,GAAO,KAAM,CAAC4H,aAAcwI,EAAQ9L,OAAOC,QAC9F,2BAAOuD,QAAQ,IAAf,8BACC3G,GAAYiP,EAAQqE,eAAiB,iBAAkBzU,GAAO,KAAM,CAACjK,KAAM,WAAY6e,QAASF,EAAM3d,QAjB5F,kBAAa4d,GAAPD,MAKrB,IAaI,2BAAO5M,QAAQ,IAAf,0DACC3G,GAAYiP,EAAQyE,0BAA2B,4BAA6BhV,GAAU,CAAC0C,IAAe,CAACqF,aAAcwI,EAAQyE,4BAC9H,2BAAO/M,QAAQ,IAAf,YACC3G,GAAYiP,EAAQ0E,SAAU,WAAYjV,GAAU,CAAC0C,IAAe,CAACqF,aAAcwI,EAAQ0E,WAE5F,wCACA,sCACC3T,GAAYiP,EAAQK,SAASsE,OAAQ,kBAAmB/U,GAAO,CAACsC,IAAc,CAACsF,aAAcwI,EAAQK,SAASsE,SAC9G5T,GAAY,KAAM,cAAenB,GAAO,CAACsC,IAAc,CAACsF,aAAcwI,EAAQK,SAASuE,KACvF7T,GAAY,WAAY,oBAAqBnB,GAAO,CAACsC,IAAc,CAACsF,aAAcwI,EAAQK,SAASwE,WACnG9T,GAAY,YAAa,qBAAsBnB,GAAO,CAACsC,IAAc,CAACsF,aAAcwI,EAAQK,SAASyE,YACrG/T,GAAY,UAAW,mBAAoBnB,GAAO,CAACsC,IAAc,CAACsF,aAAcwI,EAAQK,SAAS0E,UACjGhU,GAAY,UAAW,mBAAoBnB,GAAO,CAACsC,IAAc,CAACsF,aAAcwI,EAAQK,SAAS2E,UACjGjU,GAAY,UAAW,mBAAoBnB,GAAO,CAACsC,IAAc,CAACsF,aAAcwI,EAAQK,SAAS4E,UACjGlU,GAAY,WAAY,oBAAqBnB,GAAO,CAACsC,IAAc,CAACsF,aAAcwI,EAAQK,SAAS6E,WAGpG5jB,GACA,yBAAKgF,UAAWiJ,KAAOoC,kBAClBrQ,GAIL,yBAAKgF,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,GAA5C,WAEJ,yBAAKnL,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,EAAY9K,QAAS6K,GAAjE,qBAkEDqG,eACXnQ,EACAT,aAPkB,SAACf,GAAD,MAAY,CAC9B8Z,QAAS9Z,EAAM+c,YAAYjD,QAC3Bhe,OAAQkE,EAAMgB,KAAKlF,OACnByD,OAAQS,EAAMgB,KAAKzB,UAIM,CAAC6a,qBAAmBF,oBAFlCvI,EA1DO,SAAAxR,GAElByR,qBAAU,WAAKzR,EAAM+Z,eAAe/Z,EAAMrE,UAAU,IAFzB,MAIiB2T,oBAAS,GAJ1B,mBAItBwP,EAJsB,KAILC,EAJK,KASvBC,EAA0B,SAACC,EAAKhlB,EAAKilB,GACrC,IAAIC,EAAa,CAAC,WAAY,UAC3BA,EAAW/D,OAAM,SAAAgE,GAAK,OAAKnlB,EAAIolB,WAAWD,MACzCH,EAAIhlB,GAAOilB,EAGXC,EAAWpa,KAAI,SAAAqa,GAKP,OAJAnlB,EAAIolB,WAAWD,KACfH,EAAIG,GAAS,GACbH,EAAIG,GAAOnlB,EAAIqlB,MAAM,KAAK,IAAMJ,IAEzB,MAsBvB,OAAIJ,EAAwB,kBAAC,IAAD,CAAUte,GAAG,aACpCR,EAAM2Z,QAGP,yBAAK1Z,UAAU,IACX,wBAAIA,UAAU,IAAd,yBACA,kBAAC8d,GAAD,CAAwB7M,SAxBf,SAACI,GAEd,IAAI1V,EAAc,GAClB,IAAI,IAAI2jB,KAAYjO,EAChB0N,EAAwBpjB,EAAa2jB,EAAUjO,EAASiO,IAE5DlK,OAAOC,KAAK1Z,GAAamJ,KAAI,SAAAtF,GACtB,CAAC,WAAY,UAAUsG,SAAStG,KAC/B7D,EAAW,2BAAOA,GAAP,mBAAqB6D,EAAOuM,GAAaqJ,OAAOC,KAAKtV,EAAM2Z,QAAQla,IACzE+f,QAAO,SAAC/b,EAAKxJ,GAAN,OAAewJ,EAAIxJ,GAAQA,KAAO2B,EAAY6D,GAAQ7D,EAAY6D,GAAMxF,GAAM+F,EAAM2Z,QAAQla,GAAMxF,GAAOwJ,IAAO,WAGpIzD,EAAMia,kBAAkBre,GACxBmjB,GAAmB,IAW6BpF,QAAS3Z,EAAM2Z,WALxC,kBAAC,GAAD,SCpGzB8F,GAAoB,SAAC,GAA2E,IAA1E5E,EAAyE,EAAzEA,UAAW6E,EAA8D,EAA9DA,WAAYxE,EAAkD,EAAlDA,mBAAoByE,EAA8B,EAA9BA,cAAe5E,EAAe,EAAfA,UAClF,OAAQ,yBAAK9a,UAAWgT,KAAcnU,aAClC,8BAAUmB,UAAW4a,EAAS,UAAM5H,KAAc2M,UAApB,YAAiC3M,KAAchY,OAA/C,UAA2DgY,KAAc2M,WAAarV,SAAUmV,EAAY5D,WAAW,EAAMC,OAAQb,EAC/JzQ,MAAOkV,IAEP9E,GAAa,yBAAK5a,UAAWgT,KAAc4M,YAA9B,gBAEjB,yBAAK5f,UAAWgT,KAAc6M,YAAa/E,KAM7CgF,GAAsB,SAAC,GAA4E,IAA3EthB,EAA0E,EAA1EA,OAAQwc,EAAkE,EAAlEA,iBAAkBzc,EAAgD,EAAhDA,YAAawhB,EAAmC,EAAnCA,aAAcC,EAAqB,EAArBA,SAAUrE,EAAW,EAAXA,KACzF,OAAInd,EACS,yBAAKwB,UAAWgT,KAAczU,YAAaqd,cAAgBD,OAAwBjQ,EAAlBsP,GAAjE,IAAgGzc,EACrG,yBAAKyB,UAAS,UAAKgT,KAAciN,YAAnB,YAAiD,OAAfF,EAAsB/M,KAAckN,oBAAsBlN,KAAcmN,oBAC3GH,GAAY,oCACT,4CAAkBxhB,GAClB,4BAAQ6B,QAAS,kBAAI2f,EAASxhB,KAA9B,YAIJ,yBAAK2B,IAAK4f,MAKlB,yBAAK/f,UAAWgT,KAAczU,YAAaqd,cAAgBD,OAAwBjQ,EAAlBsP,GAA8Bzc,IAQlG6hB,GAAc,SAAC,GAGO,IAHN7hB,EAGK,EAHLA,YAAaM,EAGR,EAHQA,YAAa8c,EAGrB,EAHqBA,KACnDnd,EAE8B,EAF9BA,OAAQ6hB,EAEsB,EAFtBA,WAAaC,EAES,EAFTA,iBACrB7hB,EAC8B,EAD9BA,QAC8B,EAC4E4b,GAAc9b,EAAaM,EAAa,CAACiN,IAAgB,KADrI,mBACvBkP,EADuB,KACLC,EADK,KACewE,EADf,KAC2BjF,EAD3B,KACqCkF,EADrC,KACoD9E,EADpD,KAC+DE,EAD/D,OAIFzL,oBAAS,GAJP,mBAIvBrN,EAJuB,KAIX8W,EAJW,OAMCzJ,mBAAS,MANV,mBAMvB0Q,EANuB,KAMTQ,EANS,KA6B9B,OArBA/O,qBAAU,WACN,IAAIxP,IACA1G,QAAQC,IAAI8kB,GACRA,IAAeN,GAAa,CAAC,IAGdS,EAHa,uCAG5B,WAA2BH,GAA3B,eAAAvlB,EAAA,6DACIQ,QAAQC,IAAI,eADhB,SAE6B+kB,EAAiBD,GAF9C,OAEQI,EAFR,OAGInlB,QAAQC,IAAI,kCAAoC8kB,GAChD/kB,QAAQC,IAAIklB,GACZF,EAAOE,GACP3H,GAAM,GANV,2CAH4B,sDAC5Bxd,QAAQC,IAAI8kB,GACZvH,GAAM,GASN0H,EAAYH,MAItB,CAACA,EAAYC,EAAkBP,EAAc/d,IAG5Cqe,GAA6B,OAAfN,EAA4B,kBAAC,GAAD,MAGrC,qCACMvF,GACF,kBAAC,GAAD,CAAqBhc,OAAQA,EAAQwc,iBAAkBA,EAAkBzc,YAAaA,EACtFwhB,aAAcA,EAGdC,SAAWD,OAAwBrU,EAATjN,EAC1Bkd,KAAMA,IAMLnB,GACD,kBAAC,GAAD,CAAmBI,UAAWA,EAAW6E,WAAYA,EAAYxE,mBAAoBA,EAAoByE,cAAeA,EAAe5E,UAAWA,MC5CnJ4F,yBA5CC,SAAC3gB,EAAO4gB,GACpB,IAAMC,EAAWC,mBACjBC,8BAAoBH,GAAK,SAACI,GAOtB,OAAOH,EAASI,WATQ,IAYpB/a,EAAsGlG,EAAtGkG,QAASgb,EAA6FlhB,EAA7FkhB,mBAAoBC,EAAyEnhB,EAAzEmhB,qBAAsBvF,EAAmD5b,EAAnD4b,KAAMpf,EAA6CwD,EAA7CxD,WAAYC,EAAiCuD,EAAjCvD,OAAQiC,EAAyBsB,EAAzBtB,QAAS0iB,EAAgBphB,EAAhBohB,aAU9F,OAAO,yBAAKnhB,UAAS,UAAKgT,KAAc/M,SAAW0a,IAAKC,GACpD,yBAAK5gB,UAAWgT,KAAcoO,mBAC1B,kBAAC,IAAD,CAAS7gB,GAAE,mBAAc0F,EAAQob,WAAapb,EAAQgO,aAE1D,kBAAC,GAAD,CAAa0H,KAAMA,EAAM9c,YAZT,SAACtC,EAAYC,EAASyJ,GAAtB,OAAkC,SAAC1H,GAAD,OAAiB0iB,EAAmB1kB,EAAYC,EAAQyJ,EAAQjB,GAAIzG,IAYhFM,CAAYtC,EAAYC,EAAQyJ,GAAU1H,YAAa0H,EAAQyB,KAAMjJ,QAASA,EAAS0iB,aAAcA,EAAc3iB,OAAQyH,EAAQzH,OAGzK8hB,iBAAkBvgB,EAAMugB,iBAExBD,WAAYpa,EAAQoa,aAKpB,yBAAKrgB,UAAWgT,KAAcsO,qBAC1B,yBAAKthB,UAAWgT,KAAcuO,eAA9B,WAAsDtZ,GAAYhC,EAAQ+N,SAC1E,yBAAKhU,UAAWgT,KAAcwO,eAA9B,WAAsDvZ,GAAYhC,EAAQwb,UAE9E,yBAAKzhB,UAAWgT,KAAchU,gBAAiB2c,GAAQ,uBAAGtb,QAxB1C,WAChB6gB,EAAqB3kB,EAAYC,EAAQyJ,EAAQjB,GAAIiB,EAAQzH,UAuBN,uBCSzDkjB,GAAuB,CACzBjT,MAAO,SAGLkT,GAAyB7Q,aAAU,CAACC,KAAM,iBAAjBD,EAnDL,SAAA/Q,GAAU,IACxBiR,EAAqDjR,EAArDiR,aAAc/F,EAAuClL,EAAvCkL,SAAUC,EAA6BnL,EAA7BmL,MAAOC,EAAsBpL,EAAtBoL,WAAYnQ,EAAU+E,EAAV/E,MAyBnD,OACI,0BAAMiW,SAAUD,GACXvG,GAAY,qBAAsB,cAAetB,GAAU,CAAC2C,KAC5DrB,GAAY,mBAAoB,eAAgBlB,GAAW,KAAM,CAAClK,KAAM,SAEzErE,GACA,yBAAKgF,UAAWiJ,KAAOoC,kBAClBrQ,GAGL,yBAAKgF,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,GAA5C,SAEJ,yBAAKnL,UAAU,IACX,4BAAQX,KAAK,SAASiM,SAAUL,GAAYE,EAAY9K,QAAS6K,GAAjE,cA+BDqG,eACXnQ,EACAT,YAAQ,KAAM,CAACihB,qB/BkiBiB,SAACrlB,EAAYC,EAAQ+B,GAArB,IAAkCkL,EAAlC,uDAAuC,KAAvC,8CAAgD,WAAM/J,GAAN,eAAA5E,EAAA,yDAChF4E,EAASuE,IAAmB,IAG5BvE,EAASwL,YAAM,kBAEf5P,QAAQC,IAAI,2BACZD,QAAQC,IAAIkO,GACD,OAAPA,EAR4E,iCAU7CpN,EAASqC,WAAW+K,EAAI,QAAaA,EAAI,UAVI,OAUxEoY,EAVwE,OAW5EvmB,QAAQC,IAAR,2BACAD,QAAQC,IAAIsmB,EAAmBriB,KAAKA,MACjCqiB,EAAmBriB,KAAKA,KAAxB,OAECwG,GAAsBzJ,EAAYC,EAAQ+B,EAAasjB,EAAmBriB,KAAKA,KAAxB,OAAwCE,IAE/FpE,QAAQC,IAAI,4BACZD,QAAQC,IAAI6Z,OAAOC,KAAKwM,EAAmBriB,KAAKA,QAlBwB,wBAqB5EwG,GAAsBzJ,EAAYC,EAAQ+B,EAAa,KAAMmB,GArBe,QAuBhFA,EAASuE,IAAmB,IAvBoD,4CAAhD,yD+BpiBrBsN,EAlBO,SAACxR,GASnB,OACI,yBAAKC,UAAU,IACX,yBAAK4H,MAAO8Z,IAAZ,YACA,kBAACC,GAAD,CAAwB1Q,SAXf,SAACI,IACVA,EAAQ,aAAmBA,EAAQ,eACnCA,EAAQ,YAAkB,KAE9BA,EAAQ,aACJtR,EAAM6hB,qBAAqB7hB,EAAMxD,WAAYwD,EAAMvD,OAAQ6U,EAAQ,YAAiBA,EAAQ,cAC5FtR,EAAM6hB,qBAAqB7hB,EAAMxD,WAAYwD,EAAMvD,OAAQ6U,EAAQ,oBClCzEyQ,GAAuB,SAACtiB,EAAMuiB,GAA8D,IAAhDC,EAA+C,wDAAzBC,EAAyB,uDAAT,KACpF,OAAID,EAQG,CACH,yBAAKhiB,UAAS,UAAKgT,KAAckP,iBACjCvB,IAAKsB,GADL,uCAGA,kBAAC,GAAD,CAAShc,QAASzG,EAAKgG,IAAKxL,IAAKwF,EAAKgG,IAAIR,GAC1C2b,IAAKoB,EACGb,qBAAsB1hB,EAAK0hB,qBAC3BD,mBAAoBzhB,EAAKyhB,mBAAoBtF,MAAOnc,EAAKgG,IAAI2c,MAC7D5lB,WAAYiD,EAAK4iB,YAAa5lB,OAAQgD,EAAK6iB,QAAS5jB,QAASe,EAAKf,QAElE6hB,iBAAkB9gB,EAAK8gB,oBAlBP,kBAAC,GAAD,CAASra,QAASzG,EAAKgG,IAAKxL,IAAKwF,EAAKgG,IAAIR,GAC1C2b,IAAKoB,EACLb,qBAAsB1hB,EAAK0hB,qBAC3BD,mBAAoBzhB,EAAKyhB,mBAAoBtF,MAAOnc,EAAKgG,IAAI2c,MAC7D5lB,WAAYiD,EAAK4iB,YAAa5lB,OAAQgD,EAAK6iB,QAAS5jB,QAASe,EAAKf,QAElE6hB,iBAAkB9gB,EAAK8gB,oBAwYxC/O,eACXnQ,EACAT,aAzBkB,SAACf,GAAD,MAAY,CAC9BiC,SAAUyU,GAAmB1W,GAC7BT,OAAQS,EAAMgB,KAAKzB,OACnB5C,WAAYga,GAAY3W,GACxBpD,OAAQga,GAAW5W,GACnBmC,YAAa0U,GAAkB7W,GAE/BuQ,OAAQiH,GAAkCxX,GAC1C0Y,MAAOjB,GAAkCzX,GACzC2Y,OAAQjB,GAA2C1X,GAGnDuC,kBAAmBvC,EAAMyW,UAAUlU,kBACnChE,cAAeyB,EAAMyW,UAAUlY,cAC/BC,oBAAqBwB,EAAMyW,UAAUjY,oBACrCgE,eAAgBxC,EAAMyW,UAAUjU,eAEhCE,wBAAyB1C,EAAMyW,UAAU/T,wBACzCC,kBAAmB3C,EAAMyW,UAAU9T,kBACnCC,mBAAoB5C,EAAMyW,UAAU7T,mBACpCnE,iBAAkBuB,EAAMyW,UAAUhY,oBAKT,CAAEH,eAAa+iB,mBhC2NV,SAAC1kB,EAAYC,EAAQsC,EAAWC,GAAhC,8CAAmD,WAAMW,GAAN,eAAA5E,EAAA,sEAE5DuB,EAASwC,YAAYtC,EAAYC,EAAQsC,EAAWC,GAFQ,OAGjD,KAD5B0F,EAF6E,QAGrEjF,KAAKkF,WACbpJ,QAAQC,IAAI,gBAEZD,QAAQC,IAAI,4BAA6BkJ,EAASjF,KAAKqC,SAAS,IANa,2CAAnD,uDgC3N8Bqf,qBhCsO5B,SAAC3kB,EAAYC,EAAQsC,EAAWN,GAAhC,8CAA4C,WAAMkB,GAAN,eAAA5E,EAAA,yDAG5E4E,EAASqE,IAAoB,KAE1BvF,EALyE,gCAMlEzE,EAAA,gBAA0ByE,IANwC,uBASvDnC,EAAS2C,cAAczC,EAAYC,EAAQsC,GATY,OAUlD,QADtB2F,EATwE,QAUhEjF,KAAKA,MACblE,QAAQC,IAAI,iBAEZmE,EAlUkC,CAACL,KA3TX,6BA+nBxB/D,QAAQC,IAAI,gCAAiCkJ,EAASjF,KAAKqC,SAAS,IAExEnC,EAASqE,IAAoB,IAjB+C,2CAA5C,uDgCrOJue,mBhCtBE,yDAAM,WAAM5iB,GAAN,uBAAA5E,EAAA,6DACpC4E,EAASqE,IAAoB,IAGzBvH,EAAS8H,SAASC,aAAaC,QAAQ,WACvCjI,EAAa+H,SAASC,aAAaC,QAAQ,eALX,SAQfnI,EAASa,QAAQX,EAAYC,GARd,UASJ,KAD5BiI,EARgC,QASxBjF,KAAKkF,WATmB,oBAY5B6d,EAAY,QAEX,UAAW9d,EAASjF,KAAKA,KAAK+U,YAdH,iBAe5BjZ,QAAQC,IAAI,+CAfgB,2BAiBtBkJ,EAASjF,KAAKA,KAAK+U,YAAY4N,MAjBT,kCAmBVziB,EAASjC,GAAiBlB,EAAYC,EAAQiI,EAASjF,KAAKA,KAAK+U,YAAYvP,KAnBnE,QAmB5Bud,EAnB4B,kBAsBjB,UAAZA,GAAqD,IAA9BA,EAAU/iB,KAAKkF,WAtBT,wBAuBxB+P,EAAwB,IAAblY,EAAgB,SAAU,eACzCkI,EAASjF,KAAKA,KAAd,WAAiCjD,EACjCkI,EAASjF,KAAKA,KAAd,SAA+BiV,EAC/BhQ,EAASjF,KAAKA,KAAd,OAA6BhD,EAC7BkD,EAASoD,GAAyBvG,EAAYC,EAAQiI,EAASjF,KAAKA,OA3BxC,UA4BtBE,EAASxB,GAAY3B,EAAYC,EAAQiI,EAASjF,KAAKA,KAAKrB,cAAesG,EAASjF,KAAKA,KAAKpB,sBA5BxE,gCA8B5B9C,QAAQC,IAAI,+CAAgDgnB,EAAU/iB,KAAKqC,SAAS,IA9BxD,gCAiChCvG,QAAQC,IAAI,sCAAuCkJ,EAASjF,KAAKqC,SAAS,IAjC1C,QAwCpCnC,EAASqE,IAAoB,IAxCO,4CAAN,uDgCuBFuC,oBAAkBC,qBAAmBC,qBAAmBC,sBACxD+b,mBhC8UE,SAACjmB,EAAYC,EAAQd,GAArB,IAA6Be,EAA7B,uDAAqC,qBAArC,8CAA8D,WAAMiD,GAAN,SAAA5E,EAAA,sEAQtFiM,GAAaxK,EAAYC,EAAQd,EAAQe,EAASJ,EAASsB,kCAAkCqJ,KAAK3K,GAAW,0BAA2B,UAAW,4CAA6CqD,EAAU+C,GAAuB,WAR3I,2CAA9D,uDgC9UkBggB,iBhCwXpB,SAAClmB,EAAYC,EAAQd,GAArB,IAA6Be,EAA7B,uDAAqC,mBAArC,8CAA4D,WAAMiD,GAAN,SAAA5E,EAAA,sEAQlFiM,GAAaxK,EAAYC,EAAQd,EAAQe,EAASJ,EAASyB,gCAAgCkJ,KAAK3K,GAAW,wBAAyB,oBAAqB,4BARvE,2CAA5D,uDgCxXsCqmB,mBhCmYpC,SAACnmB,EAAYC,EAAQd,GAArB,IAA6Be,EAA7B,uDAAqC,qBAArC,8CAA8D,WAAMiD,GAAN,SAAA5E,EAAA,sEAQtFiM,GAAaxK,EAAYC,EAAQd,EAAQe,EAASJ,EAAS0B,kCAAkCiJ,KAAK3K,GAAW,uBAAwB,mBAAoB,8BARnE,2CAA9D,uDgCnYwDsmB,ahCuW9D,SAACpmB,EAAYC,EAAQd,GAArB,IAA6Be,EAA7B,uDAAqC,eAArC,8CAAwD,WAAMiD,GAAN,SAAA5E,EAAA,sEAY3DiM,GAAaxK,EAAYC,EAAQd,EAAQe,EAASJ,EAASwB,6BAA6BmJ,KAAK3K,GAAW,mBAAoB,gBAAiB,uBAAwBqD,EAAU+C,GAAuB,WAZ3I,yDAAxD,uDgCtWIwE,uBAAqBH,aAAWF,qBAEhCuP,oBAAkB/F,6BAElB3R,QhC7LT,SAACD,GAAD,8CAAY,WAAMkB,GAAN,iBAAA5E,EAAA,sEACJuB,EAASoC,QAAQD,GADb,OAC3BokB,EAD2B,OAM3BnZ,EAAOmZ,EAAepjB,KAC1BlE,QAAQC,IAAIkO,GACTA,EAAKxM,KACJiG,GAAUuG,EAAKA,KAAMA,EAAKxM,KAAMwM,EAAKoZ,QAChCtf,MAAK,SAASuf,GACP,GAAGrZ,EAAKsZ,QAAQ,CACZznB,QAAQC,IAAI,gBAEZ,IAAIoO,EAAS,IAAIC,WACjBD,EAAOG,OAAS,SAASkZ,GACrB1nB,QAAQC,IAAI,YACZmE,EAASsD,GAAeggB,EAAO5Y,OAAOL,OAAQvL,KAElDmL,EAAOE,cAAciZ,OAElB,CACH,IAAIG,EAAOC,IAAIC,gBAAgBL,GAC/BM,kBAAON,GACPI,IAAIG,gBAAgBJ,OAKpC3nB,QAAQC,IAAI,kCA7Be,2CAAZ,uDgC8LS2I,6BAGAoc,iBhChNA,SAACgD,GAAD,8CAAa,WAAM5jB,GAAN,SAAA5E,EAAA,sEAC5Bf,EAAcupB,GADc,mFAAb,yDgCoN5B1K,IAlBWrH,EAlXI,SAAC,GAUD,IAVE+Q,EAUH,EAVGA,mBAAoBpkB,EAUvB,EAVuBA,YAAakE,EAUpC,EAVoCA,eAClD8B,EASc,EATdA,0BAEWke,EAOG,EAPd7lB,WAA+B8lB,EAOjB,EAPU7lB,OAAkC+mB,EAO5C,EAP0BphB,kBAAoDqhB,EAO9E,EAPgErlB,cAC9EmE,EAMc,EANdA,wBAAyBC,EAMX,EANWA,kBAAmBC,EAM9B,EAN8BA,mBAC5CnE,EAKc,EALdA,iBAGAiiB,EAEc,EAFdA,iBAEGvgB,EAAW,uQAEgCsP,oBAAS,EAAO,mBAFhD,mBAEPoU,EAFO,KAEUC,EAFV,OAGkBrU,oBAAS,EAAO,YAHlC,mBAGPsU,EAHO,KAGGC,EAHH,OAI8BvU,mBAAS,KAAM,kBAJ7C,mBAIPyD,EAJO,KAISP,EAJT,OAKsBlD,oBAAS,EAAO,mBALtC,mBAKPwU,EALO,KAKUC,EALV,OAMgCzU,oBAAS,EAAO,8BANhD,mBAMP0U,EANO,KAMqBC,EANrB,KASRC,EAAYpD,iBAAO,MACnBqD,EAAarD,iBAAO,MACpBsD,EAAetD,iBAAO,MAXd,EAaqBxR,oBAAS,GAb9B,mBAaP+U,EAbO,KAaWC,EAbX,KA4BRC,EAAazD,iBAAO,MAM1BrP,qBAAU,WACHmS,GACCY,EAAmBV,EAAkB,QAAU,WAC3BA,EAAkBK,EAAWlD,QAAUiD,EAAUjD,QACjD6C,EAAuD,OAApC9jB,EAAMgC,YAAYyiB,cAAyBT,IAA+BN,EAC7FU,EAAanD,YAOzCxP,qBAAU,WAEHhP,IACI8hB,EAAWtD,QACVsD,EAAWtD,QAAQyD,iBAEnBnpB,QAAQC,IAAI,gEAEhBiH,GAAsB0B,GAA0B,MAItD,CAACA,EAA2B1B,IAE9BgP,qBAAU,WAEN,IAEuBkT,EAFnB3D,EAAO,KAsBL4D,EAAW,IAAIC,sBAhBG,SAACC,EAASF,GAC9BE,EAAQC,SAAQ,SAAAC,GACZ,IAAMC,EAAiBD,EAAMC,eAC7B1pB,QAAQC,IAAI,6BACTypB,IAEC1pB,QAAQC,IAAI,2CACZD,QAAQC,IAAI,mBAAqBwpB,EAAM3a,OAAO6a,WAE9CN,EAASO,UAAUH,EAAM3a,QAEzBsZ,GAAmB,SAK4B,CAACyB,WApBrCT,EAoB+D,EApBtDU,MAAMV,EAAQ,GACzCW,KAAK,GACLvgB,KAAI,SAACwgB,EAAGC,GAAJ,OAAcA,EAAQb,GAAS,QA4BxC,OANGP,EAAanD,SAAW2C,KAAeI,IAA+BN,GAAqBI,KAC1F9C,EAAOoD,EAAanD,QACpB2D,EAASa,QAAQzE,IAId,kBAAc,OAARA,GAAgB4D,EAASO,UAAUnE,MACjD,CAACgD,EAA4BN,EAAiBI,EAAiBF,IAIlE,IAAMY,EAAoB,SAACkB,EAAkBC,EAAcC,EAAcC,GACnD,MAAfF,IACuB,UAAnBD,GAEIE,EACCD,EAAaG,UAAYH,EAAaI,aAEtCJ,EAAajB,iBAGjBX,GAAS,IAEN6B,IAECD,EAAajB,iBACbT,GAAQ,MAwExB,GAlEAxS,qBAAU,YACNlW,QAAQC,IAAI,sCACPooB,IACyB,uCAAG,sBAAA7oB,EAAA,sEACnBwnB,IADmB,OAEzBsB,GAAY,GAFa,2CAAH,oDAI1BmC,KAEL,CAACpC,EAAUrB,IAEd9Q,qBAAU,WAEF,IAAIwU,EAAQ,KAsBZ,OAnBI5B,IACJ4B,EAAQ9M,WAAU,sBAAE,sBAAApe,EAAA,yDAEX2oB,IAAmBE,GAAavhB,GAAmB2hB,EAFxC,uBAIZM,GAAO,GAJK,SAaNnmB,EAAYkkB,EAAaC,EAASmB,EAAgBzjB,EAAM3B,oBAAqB,KAAOkE,IAA4BC,EAAoBlE,GAb9H,OAcZgmB,GAAO,GAdK,2CAiBlB,OACK,WAAkB,OAAV2B,GAAkBC,aAAaD,MAG/C,CAACrC,EAAUF,EAAiBrhB,EAAgB2hB,EAC3C3B,EAAaC,EAASmB,EAAgBzjB,EAAM3B,oBAAqBF,EACjEoE,EAAyBC,EAAmBlE,EAAkB+lB,IAItE5S,qBAAU,WAEN,IAAIuS,GAA8BN,IAAoBrhB,EAAe,CACjE,IAAM8jB,EAAY,uCAAG,sBAAAprB,EAAA,sEACXoD,EAAYkkB,EAAaC,EAASkB,EAAoBC,GAD3C,OAGjBE,GAAmB,GAHF,2CAAH,qDASlBM,GAAQ,GAERkC,OAIL,CAAC9jB,EAAgB2hB,EAA4BN,EAAiBC,EAAoBM,EACjF5B,EAAaC,EAASkB,EAAoBC,EAAgBtlB,IAGzDylB,EAAsC,CACpCtlB,EAAmB,IAClB/C,QAAQC,IAAI,oBACZD,QAAQC,IAAI8C,IAGpB,IAAI8nB,EAAiB5C,IAAuBC,EAAmB,yBAAKxjB,UAAS,UAAKgT,KAAcoT,gBAAkBzF,IAAKwD,IAC1E,yBAAKnkB,UAAS,UAAKgT,KAAcqT,eAAjC,kCAIzCxkB,EAAW9B,EAAM8B,SAASiD,KAAI,SAACU,EAAK+f,GAEA,IAAIe,EAAY,CAAC9gB,IAAIA,EAAK/G,QAAQsB,EAAMtB,QAAS4jB,QAAQA,EAASD,YAAYA,EAC1EnB,mBAAmBlhB,EAAMkhB,mBAAoBC,qBAAqBnhB,EAAMmhB,qBAExEZ,iBAAiBA,GAErB,OAAqC,OAAlCvgB,EAAMgC,YAAYyiB,eAAwBzkB,EAAMgC,YAAYyiB,eAAiBhf,EAAIR,KACrE,IAAVugB,GAAexlB,EAAM8B,SAAS0jB,EAAM,GAAGvgB,GAAKjF,EAAMgC,YAAYyiB,eAExD1C,GAAqBwE,EAAY9gB,EAAIR,KAAOjF,EAAM3B,qBAAuB2lB,EAA6BE,OAAYvY,GACzH,EAA4C,OAApC3L,EAAMgC,YAAYyiB,eAA0BX,EAAkBK,OAAaxY,GAEhF6Z,IAAUxlB,EAAM8B,SAASkE,OAAS,EAE1B+b,GAAqBwE,EAAY9jB,EAAsB8hB,OAAa5Y,GAEpEoW,GAAqBwE,EAAY9gB,EAAIR,KAAOjF,EAAM3B,qBAAuB2lB,EAA6BE,OAAYvY,MAG9H6a,OAC3C1kB,EAAS2kB,QAAQL,GAIjB,IACIpT,EAAc,CAAC,CAAC3O,OAAQrE,EAAMyiB,mBAAoBvlB,KAAM,iBAAkB,CAACmH,OAAQrE,EAAM0iB,iBAAkBxlB,KAAM,8BAA+B,CAACmH,OAAQrE,EAAM4iB,aAAc1lB,KAAM,kBACnLmR,EAAerO,EAAMgC,YAAYW,QAAQoC,KAAI,SAAAqN,GAAM,OAAIA,EAAOnN,MAG9DtC,GAA0B,IAAhB0f,EAEEriB,EAAMgC,YAAYW,QAAQoC,KAAI,SAAAqN,GAAM,OAAI,kBAAC,GAAD,CAAQA,OAAQA,EAAQnY,IAAKmY,EAAOnN,GAAIoN,YAAW,UAAKY,KAAcyT,YAC1GpU,mBAAkB,UAAKW,KAAcX,oBACrCC,kBAAmB,SAACI,GAAD,OAAYA,EAAMiB,kBAAmB5T,EAAMoW,iBAAiBpW,EAAMwY,OAAOvT,IAAI,IAChGmR,iBAAkBpW,EAAMoW,iBACxBoC,OAAQxY,EAAMwY,OACdhG,kBAAmBA,OAEvBxS,EAAMgC,YAAYW,QAAQoC,KAAI,SAAAqN,GAAM,OAAI,kBAAC,GAAD,CAAQA,OAAQA,EAAQnY,IAAKmY,EAAOnN,QAG5F,OACI,oCAEsB,OAAtBjF,EAAMoQ,OAAO3Q,MACb,yBAAKQ,UAAW0mB,KAAW5f,WACvB,kBAAC,GAAD,CAAoBA,UAAW/G,EAAM+G,UAAWvK,WAAY6lB,EAAa5lB,OAAQ6lB,EAASjU,aAAcA,EACxG+B,OAAQpQ,EAAMoQ,OAAQC,0BAA2BrQ,EAAMqQ,6BAG3D,yBAAKpQ,UAAWgT,KAAcjR,aAEtB,kBAAC,GAAD,CAASW,QAASA,GAClBkQ,YAAa7S,EAAMuY,MAAM9Y,KACzBqT,eAAgB9S,EAAMwY,OAAO/Y,KAC7BsT,eAAgBA,EAChBC,YAAaA,EACRjO,KAAI,SAAAuO,GAAU,kCAASA,GAAT,IACXjP,QAlCEA,EAkCmBiP,EAAWjP,OAlCtB7H,EAkC8B6lB,EAlClB5lB,EAkC+B6lB,EAlCpB,SAACsE,GAAD,OAAuB,kBAAMviB,EAAO7H,EAAYC,EAAQmqB,QAAxF,IAACviB,EAAQ7H,EAAYC,OAoClC,yBAAKwD,UAAWgT,KAAc4T,aAC1B,yBAAK5mB,UAAWgT,KAAc6T,kBAA9B,IAAwF,OAAtC9mB,EAAMgC,YAAYc,UAAUgL,MAAiB,yBAAK1N,IAAKJ,EAAMgC,YAAYc,UAAUgL,QAAY,yBAAK7N,UAAWgT,KAAc8T,qBAA9B,mBACjJ,yBAAK9mB,UAAWgT,KAAc+T,iBAAkBhnB,EAAMgC,YAAY9E,MAClE,yBAAK+C,UAAWgT,KAAcgU,qBAA9B,WAEI,yBAAKhnB,UAAWgT,KAAciU,eACZ,IAAhB7E,GACE,oCACI,yBAAKpiB,UAAWgT,KAAckU,mBACH,OAAtBnnB,EAAMoQ,OAAO3Q,MACV,uBAAGQ,UAAW0mB,KAAWhT,cACrBrT,QACI,SAACqS,GAAD,OAAYA,EAAMiB,kBAAmB5T,EAAMoW,iBAAiBpW,EAAMoQ,OAAOnL,GAAI,CAACod,EAAaC,MAFnG,eASR,yBAAKriB,UAAWgT,KAAckU,mBAC1B,yBAAKlnB,UAAWgT,KAAcmU,oBAA9B,gBACA,kBAAC,GAAD,CAAiBvV,SAAUoB,KAAcoU,sBAAuBngB,oBAAqBlH,EAAMkH,oBAAqB1K,WAAY6lB,EAAa5lB,OAAQ6lB,KAErJ,yBAAKriB,UAAWgT,KAAckU,mBAC9B,yBAAKlnB,UAAWgT,KAAcmU,oBAA9B,eACI,kBAAC,GAAD,CAAYvV,SAAUoB,KAAcoU,sBAAuBxgB,kBAAmB7G,EAAM6G,kBAAmBrK,WAAY6lB,EAAa5lB,OAAQ6lB,MAIhJ,yBAAKriB,UAAWgT,KAAckU,mBAC1B,yBAAKlnB,UAAWgT,KAAcqU,oBAEL,OAArBtnB,EAAMuY,MAAM9Y,MACZ,uBAAGa,QAAS,SAACqS,GAAD,OAAUA,EAAMiB,kBAAmB5T,EAAMoW,iBAAiBpW,EAAMuY,MAAMtT,IAAI,KAAtF,qBAcxB,yBAAKhF,UAAWgT,KAAcnR,SAAU8e,IAGA,OAApC5gB,EAAMgC,YAAYyiB,eAA0BX,EAAkBK,OAAaxY,GACtE7J,GAiBT,yBAAK7B,UAAWgT,KAAcsU,mBAAmB,kBAAC,GAAD,CAAe/qB,WAAY6lB,EAAa5lB,OAAQ6lB,EAASljB,OAAQY,EAAMZ,YA5I5G,OAAO,kBAAC,GAAD,SCnPrBooB,GAAM9mB,IAAM+mB,MAAK,SAACznB,GAMhB,OAHAzE,QAAQC,IAAI,YACZD,QAAQC,IAAIwE,EAAMwX,aAClB/F,qBAAU,WAAOzR,EAAM0nB,kBAAkB,IACpC1nB,EAAMwX,YAEH,yBAAKvX,UAAU,yBAAyBK,QAAS,WAAMN,EAAM2nB,2BAC7D,yBAAK1nB,UAAU,eACP,kBAAC,EAAD,MACA,kBAAC,EAAD,MACA,yBAAKA,UAAU,uBACf,kBAAC,IAAD,CAAO8U,KAAK,oBACI6S,OAAQ,kBAAM,kBAACC,GAAD,SAC9B,kBAAC,IAAD,CAAO9S,KAAK,kBACJ6S,OAAQ,kBAAM,kBAAC,GAAD,SACtB,kBAAC,IAAD,CAAO7S,KAAK,SAAS6S,OAAQ,kBAAM,kBAAC,GAAD,SACnC,kBAAC,IAAD,CAAO7S,KAAK,SACJ6S,OAAQ,kBAAM,kBAAC,GAAD,SACtB,kBAAC,IAAD,CAAOE,OAAK,EAAC/S,KAAK,SACV6S,OAAQ,kBAAM,kBAAC,GAAD,SACtB,kBAAC,IAAD,CAAO7S,KAAK,0BACJ6S,OAAQ,kBAAM,kBAAC,GAAD,YAjBN,kBAAC,GAAD,SA6BzBpW,eACPqH,IACAjY,aANgB,SAACf,GAAD,MAAY,CAC5B2X,YAAa3X,EAAM+W,IAAIY,eAKE,CAACkQ,chBCL,kBAAM,SAAC/nB,GAEhCzE,QAAQ4J,IAAI,CAACnF,EtBgNc,uCAAM,WAAMA,GAAN,eAAA5E,EAAA,sEACZK,IADY,aAG9B,WAFCsJ,EAD6B,QAGTjF,KACjB,CAAC,yBAA0B,4BAA6B,0DAA0DsG,SAASrB,EAASjF,KAAKsoB,QACxIxsB,QAAQC,IAAIkJ,EAASjF,KAAKsoB,QAG1BxsB,QAAQC,IAAI,qCAGgB,IAA7BkJ,EAASjF,KAAKkF,YACbjF,EAAaC,EAAU+E,EAASjF,KAAKA,MAZZ,kBAe1BiF,GAf0B,2CAAN,yDsB/M1BlB,MAAM,SAAAmG,GAGHhK,EAbiC,CAACL,KA9Cd,2BA4DrB0oB,OAAM,SAAA/sB,GAGE,CAAC,yBAA0B,4BAA6B,0DAA0D8K,SAAS9K,EAAMyJ,SAASjF,KAAKsoB,SAK9IxsB,QAAQC,IAAI,qCAEhBmE,EAxB6B,CAACL,KA9Cd,2BA0ElB0oB,OAAM,SAAA/sB,GACJM,QAAQC,IAAI,iBACZmE,EA9B6B,CAACL,KA9Cd,6BgBqDZqoB,uBhBJsB,iBAAO,CAACroB,KA/ChB,4BgBgDfkS,CAKZgW,IC9CiBS,QACW,cAA7B9Q,OAAO+Q,SAASC,UAEe,UAA7BhR,OAAO+Q,SAASC,UAEhBhR,OAAO+Q,SAASC,SAASzK,MACvB,2D,cClBFxe,GAAe,GAMJkpB,GAJQ,WAAmC,IAAlCvoB,EAAiC,uDAAzBX,GAC5B,OAAOW,G,UCQPwoB,GAAWC,YAAgB,CAC3B1L,YAAa1C,GACb5D,UAAW9O,GACX+gB,QAASH,GACT7X,UAAW/C,GACX3M,KAAMjB,EACNoR,KAAMwX,KACN5R,IAAKmB,KAGH0Q,GAAmBtR,OAAOuR,sCAAwClX,IAClEmX,GAAQC,YAAYP,GAAUI,GAAiBI,YAAgBC,QAErE3R,OAAO4R,UAAYJ,GACJA,U,iBCdfK,GAAgBtoB,KAMhBuoB,IAASrB,OACP,kBAAC,IAAMsB,WAAP,KACE,kBAAC,IAAD,KAEA,kBAAC,IAAD,CAAUP,MAAOA,IACf,kBAAC,GAAD,SAIJQ,SAASC,eAAe,SHyGpB,kBAAmBC,WACrBA,UAAUC,cAAcC,MACrB/lB,MAAK,SAAAgmB,GACJA,EAAaC,gBAEdzB,OAAM,SAAA/sB,GACLM,QAAQN,MAAMA,EAAMiL,a,mBIxI5BzM,EAAOC,QAAU,CAAC,aAAe,kCAAkC,YAAc,iCAAiC,iBAAmB,sCAAsC,UAAY,+BAA+B,SAAW,8BAA8B,SAAW,gC,kBCA1QD,EAAOC,QAAU,CAAC,MAAQ,qBAAqB,aAAe,4BAA4B,WAAa,0BAA0B,WAAa,0BAA0B,UAAY,yBAAyB,cAAgB,6BAA6B,gBAAkB,+BAA+B,iBAAmB,gCAAgC,eAAiB,8BAA8B,SAAW,wBAAwB,aAAe,4BAA4B,cAAgB,6BAA6B,WAAa,0BAA0B,aAAe,4BAA4B,iBAAmB,gCAAgC,uBAAyB,sCAAsC,mBAAqB,kCAAkC,aAAe,4BAA4B,OAAS,sBAAsB,WAAa,0BAA0B,YAAc,2BAA2B,aAAe,4BAA4B,wBAA0B,uCAAuC,aAAe,4BAA4B,QAAU,uBAAuB,SAAW,wBAAwB,SAAW,wBAAwB,WAAa,0BAA0B,eAAiB,8BAA8B,UAAY,2B,mBCA7vCD,EAAOC,QAAU,CAAC,WAAa,4BAA4B,cAAgB,+BAA+B,WAAa,4BAA4B,MAAQ,yB,kBCA3JD,EAAOC,QAAU,CAAC,kBAAoB,mCAAmC,oBAAsB,qCAAqC,YAAc,6BAA6B,YAAc,6BAA6B,MAAQ,uBAAuB,YAAc,6BAA6B,oBAAsB,qCAAqC,cAAgB,+BAA+B,kBAAoB,mCAAmC,sBAAwB,uCAAuC,mBAAqB,oCAAoC,aAAe,8BAA8B,mBAAqB,oCAAoC,YAAc,6BAA6B,mBAAqB,oCAAoC,WAAa,4BAA4B,mBAAqB,oCAAoC,gBAAkB,iCAAiC,iBAAmB,kCAAkC,oBAAsB,qCAAqC,SAAW,0BAA0B,eAAiB,gCAAgC,aAAe,8BAA8B,gBAAkB,iCAAiC,QAAU,yBAAyB,YAAc,6BAA6B,oBAAsB,qCAAqC,cAAgB,+BAA+B,cAAgB,+BAA+B,kBAAoB,mCAAmC,kBAAoB,mCAAmC,YAAc,6BAA6B,cAAgB,+BAA+B,UAAY,2BAA2B,MAAQ,uBAAuB,WAAa,4BAA4B,WAAa,4BAA4B,mBAAqB,oCAAoC,YAAc,6BAA6B,aAAe,8BAA8B,aAAe,gC,mBCAz6DD,EAAOC,QAAU,CAAC,OAAS,uBAAuB,WAAa,6B,mBCA/DD,EAAOC,QAAU,CAAC,UAAY,6BAA6B,WAAa,8BAA8B,aAAe,kC,mBCArHD,EAAOC,QAAU,CAAC,UAAY,yBAAyB,gBAAkB,+BAA+B,OAAS,sBAAsB,aAAe,+B","file":"static/js/main.01167ce3.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/preloader1.d5c02aa6.gif\";","module.exports = __webpack_public_path__ + \"static/media/user.8b1dbb1f.png\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"profile_wrapper\":\"Profile_profile_wrapper__1lJ4_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"item\":\"Post_item__3_OiR\",\"posts\":\"Post_posts__wEapD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"formControl\":\"FormsControls_formControl__1Wssk\",\"error\":\"FormsControls_error__Lr8A7\",\"warning\":\"FormsControls_warning__1ik2A\",\"formSummaryError\":\"FormsControls_formSummaryError__1vavX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"nav\":\"Navbar_nav__2Na0t\",\"item\":\"Navbar_item__1bENr\",\"activeLink\":\"Navbar_activeLink__1wupa\"};","// let db;\r\n// // let indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB\r\n// let dbReq = indexedDB.open('myDB', 1);\r\n// dbReq.onupgradeneeded = (event) => {\r\n//     //   db    \r\n//     db = event.target.result;\r\n//     //      notes.\r\n//     let authorization = db.createObjectStore('authorization', { autoIncrement: true });\r\n// }\r\n// dbReq.onsuccess = (event) => {\r\n//     db = event.target.result;\r\n// }\r\n// dbReq.onerror = (event) => {\r\n//     console.log('error opening database ' + event.target.errorCode);\r\n// }\r\n\r\n\r\n// async function putSomeData() {\r\n//     let db = await idb.open('db-name', 1, upgradeDB => upgradeDB.createObjectStore('objectStoreName', { autoIncrement: true }))\r\n\r\n//     let tx = db.transaction('objectStoreName', 'readwrite')\r\n//     let store = tx.objectStore('objectStoreName')\r\n\r\n//     await store.put({ firstname: 'John', lastname: 'Doe', age: 33 })\r\n\r\n//     await tx.complete\r\n//     db.close()\r\n// }\r\n\r\n\r\n// async function getAllData() {\r\n//     let db = await idb.open('db-name', 1)\r\n\r\n//     let tx = db.transaction('objectStoreName', 'readonly')\r\n//     let store = tx.objectStore('objectStoreName')\r\n\r\n//     // add, clear, count, delete, get, getAll, getAllKeys, getKey, put\r\n//     let allSavedItems = await store.getAll()\r\n\r\n//     console.log(allSavedItems)\r\n\r\n//     db.close()\r\n// }\r\n\r\n\r\n// const setToken = (db, token) => {\r\n//     let tx = db.transaction(['authorization'], 'readwrite');\r\n//     let store = tx.objectStore('authorization');\r\n//     let tokenNote = { token: token };\r\n//     store.add(tokenNote);\r\n//     tx.oncomplete = () => {\r\n//         console.log('stored token!')\r\n//     }\r\n//     tx.onerror = (event) => {\r\n//         console.log('error storing token ' + event.target.errorCode);\r\n//     }\r\n// }\r\n\r\n// const getToken = (db) => {\r\n//     let tx = db.transaction(['authorization'], 'readonly');\r\n//     let store = tx.objectStore('authorization');\r\n//     let req = store.get('token');\r\n//     req.onsuccess = (event) => {\r\n//         let token = event.target.result;\r\n//         if (token) {\r\n//             return token\r\n//         } else {\r\n//         //   console.log(`token not found`)\r\n//         return null\r\n//         }\r\n//       }\r\n//       req.onerror = (event) => { // if user blocked to store in indexDB in browser\r\n//         console.log('error getting note' + event.target.errorCode);\r\n//       }\r\n// }\r\n\r\n// const clearToken = (db) => {\r\n//     let tx = db.transaction(['authorization'], 'readwrite');\r\n//     let store = tx.objectStore('authorization');\r\n//     const req = store.getKey('token');\r\n//     req.onsuccess = (event) => {  \r\n//         const key = req.result;\r\n//         //         \r\n//         let deleteRequest = store.delete(key);\r\n//         deleteRequest.onsuccess = (event) => {\r\n//         //      \r\n//         console.log('Delete request for token successful')\r\n//         };\r\n//     }\r\n// }\r\n\r\n// export const setAuthToken = (token) => {\r\n//     let oldToken = getToken(db)\r\n//     if(oldToken!==null){\r\n//         clearToken(db)\r\n//     }\r\n//     setToken(db, token)\r\n// }\r\n\r\n\r\n\r\n\r\n\r\nimport { openDB } from 'idb';\r\n \r\nconst dbPromise = openDB('keyval-store', 1, {\r\n  upgrade(db) {\r\n    db.createObjectStore('keyval');\r\n  },\r\n});\r\n \r\nexport const idbKeyval = {\r\n  async get(key) {\r\n    return (await dbPromise).get('keyval', key);\r\n  },\r\n  async set(key, val) {\r\n    return (await dbPromise).put('keyval', val, key);\r\n  },\r\n  async delete(key) {\r\n    return (await dbPromise).delete('keyval', key);\r\n  },\r\n  async clear() {\r\n    return (await dbPromise).clear('keyval');\r\n  },\r\n  async keys() {\r\n    return (await dbPromise).getAllKeys('keyval');\r\n  },\r\n};\r\n\r\n// idbKeyval.set('token', token)\r\n// let token = idbKeyval.get('token')","import * as axios from 'axios'\r\nimport { idbKeyval } from '../components/common/utils/indexedDB';\r\n\r\n\r\nconst instance = axios.create({\r\n    // baseURL: 'http://127.0.0.1:8000/',\r\n    baseURL: 'https://socnet97.herokuapp.com/',\r\n    headers: {\r\n        \"Content-type\": \"application/json\"\r\n      }\r\n})\r\n\r\ninstance.interceptors.request.use(\r\n    async (config) => {\r\n        // Do something before request is sent\r\n        let token = await idbKeyval.get('token')\r\n        // let token = localStorage.getItem('token') // if expired -> delete too\r\n        if (token){\r\n            config.headers[\"Authorization\"] = \"Bearer \" + token;\r\n        } else {\r\n            delete config.headers[\"Authorization\"]\r\n            // debugger\r\n        }\r\n        // console.log(config)\r\n        // debugger\r\n        return config;\r\n    },\r\n    error => {\r\n        Promise.reject(error);\r\n    }\r\n);\r\n\r\n\r\nexport const authAPI = {\r\n    me(){\r\n        return instance.get('api/auth/me/')\r\n    },\r\n    login(login, password){\r\n        console.log(login, '    ' , password)\r\n        return instance.post('api/auth/login/', {\"username\": login, \"password\": password})\r\n    },\r\n    signup(login, email, email2, password){\r\n        return instance.post('api/auth/register/', {\r\n        \"username\": login,\r\n        \"email\": email,\r\n        \"email2\": email2,\r\n        \"password\": password\r\n    })\r\n    }\r\n} \r\n\r\n\r\nexport const profileAPI = {\r\n    getProfile(userId){\r\n        return instance.get(`api/profile/${userId}/`)\r\n    },\r\n    //           \r\n    updateProfile(profileData){ // send here an object ( auto-sized update )\r\n        // let {name=null, slug=null, status=null, photos=null, lookingForAJob=null, lookingForAJobDescription=null, fullname=null, contacts=null} = profileData\r\n        return instance.put('api/profile/', profileData)\r\n    },\r\n    deleteProfile(){ // delete self profile -> so user too\r\n        return instance.delete('api/profile/')\r\n    },\r\n    // getStatus(userId){\r\n    //     return instance.get(`api/profile/status/${userId}`)\r\n    // },\r\n    updateStatus(status){\r\n        return instance.put('api/profile/status/', {'status': status}) // like {status:status}\r\n    },\r\n    // getPhoto(userId){\r\n    //     return instance.get(`api/profile/photo/${userId}`)\r\n    // },\r\n    updatePhoto(photo){\r\n        // getHeaders()\r\n        return instance.put('api/profile/photo/', {\"photos\": photo})\r\n    }\r\n}\r\n\r\n\r\nexport const usersAPI = {\r\n    getUsers(currentPage = 1, query=null){\r\n        // debugger // i dont know why i get query str -> then query==null /??????\r\n        console.log(`api/users?page=${currentPage}&q=${query}`) // dont use &count=${pageSize}\r\n        return query===null ? instance.get(`api/users?page=${currentPage}`) : instance.get(`api/users?page=${currentPage}&q=${query}`) \r\n    },\r\n    // getUser(userId){\r\n    //     return instance.get(`api/users/${userId}`)\r\n    // },\r\n    follow(userId){\r\n        // debugger\r\n        return instance.post(`api/follow/${userId}/`)\r\n    },\r\n    unfollow(userId){\r\n        return instance.delete(`api/follow/${userId}/`)\r\n    },\r\n    getfollow(userId){\r\n        return instance.get(`api/follow/${userId}/`)\r\n    }\r\n}\r\n\r\nexport const chatsAPI = {\r\n\r\n    chatPut(chatTypeId, chatId, putType, secondArgName, secondArg){\r\n        // debugger\r\n        let putData = {\"putType\": putType}\r\n        putData[secondArgName] = secondArg\r\n        return instance.put(`api/chats/${chatTypeId}/${chatId}/`, putData)\r\n    },\r\n\r\n\r\n    getChats(page, query){\r\n        return query===null ? \r\n            instance.get(`api/chats/?page=${page}`) :\r\n            instance.get(`api/chats/?page=${page}&query=${query}`)\r\n    },\r\n    createChat(snusers, name=null){ // snusers can be list of integers or integer\r\n        return name!==null ? \r\n                            instance.post('api/chats/create/', {snusers, name}) : \r\n                            instance.post('api/chats/create/', {snusers})\r\n    },\r\n    getChat(chatTypeId, chatId){ // chatTypeId = 0 - dialogs\r\n        return instance.get(`api/chats/${chatTypeId}/${chatId}/`)\r\n    },\r\n    deleteChat(chatTypeId, chatId){\r\n        return instance.delete(`api/chats/${chatTypeId}/${chatId}/`)\r\n    },\r\n    // TODO try to unify all calls below\r\n    clearChat(chatTypeId, chatId, putType, clearType){ \r\n        return this.chatPut(chatTypeId, chatId, putType, 'clearType', clearType) // 'clear'     clearType -> 'myLocal' 'myGlobal' 'allLocal' 'allGlobal' \r\n    },\r\n    renameChat(chatTypeId, chatId, putType, newChatName){ \r\n        return this.chatPut(chatTypeId, chatId, putType, 'newChatName', newChatName) // 'rename'\r\n    },\r\n    updateUnreadMsgs(chatTypeId, chatId, putType, lastGlobalReadMsgId){ // ---------------------------------------------------------------------------------------------\r\n        return this.chatPut(chatTypeId, chatId, putType, 'lastGlobalReadMsgId', lastGlobalReadMsgId) // 'updateUnreadMsgs'\r\n    },\r\n    // for conv only\r\n    toogleMemberStatusForConversation(chatTypeId, chatId, putType, userId){  // 'toogleMemberStatus'\r\n        return this.chatPut(chatTypeId, chatId, putType, 'userId', userId)\r\n    },\r\n    addMemberForConversation(chatTypeId, chatId, putType, userId){  // 'addMember'\r\n        return this.chatPut(chatTypeId, chatId, putType, 'userId', userId)\r\n    },\r\n    removeMemberFromConversation(chatTypeId, chatId, putType, userId){  // 'removeMember'\r\n        return this.chatPut(chatTypeId, chatId, putType, 'userId', userId)\r\n    },\r\n    removeMemberMsgsForConversation(chatTypeId, chatId, putType, userId){  // 'removeMemberMsgs'\r\n        return this.chatPut(chatTypeId, chatId, putType, 'userId', userId)\r\n    },\r\n    removeOneMemberMsgForConversation(chatTypeId, chatId, putType, userId){  // 'removeOneMemberMsg'\r\n        return this.chatPut(chatTypeId, chatId, putType, 'userId', userId)\r\n    },\r\n\r\n    setChatPhoto(chatTypeId, chatId, putType, newChatPhoto){ // putType = setChatPhoto // 'setChatPhoto'\r\n        return this.chatPut(chatTypeId, chatId, putType, 'newChatPhoto', newChatPhoto)\r\n    },\r\n\r\n    //messages\r\n    getMessages(chatTypeId, chatId, readFromIndex, readFromIndexBefore, query, numOfDeletedMsgs){\r\n        // console.log(query)\r\n        return  numOfDeletedMsgs === null ?\r\n            query===null ?\r\n            instance.get(`api/chats/${chatTypeId}/${chatId}/messages/?readFromIndex=${readFromIndex}&readFromIndexBefore=${readFromIndexBefore}`) :\r\n            instance.get(`api/chats/${chatTypeId}/${chatId}/messages/?readFromIndex=${readFromIndex}&readFromIndexBefore=${readFromIndexBefore}&query=${query}`) \r\n            :\r\n            query===null ?\r\n            instance.get(`api/chats/${chatTypeId}/${chatId}/messages/?readFromIndex=${readFromIndex}&readFromIndexBefore=${readFromIndexBefore}&numOfDeletedMsgs=${numOfDeletedMsgs}`) :\r\n            instance.get(`api/chats/${chatTypeId}/${chatId}/messages/?readFromIndex=${readFromIndex}&readFromIndexBefore=${readFromIndexBefore}&query=${query}&numOfDeletedMsgs=${numOfDeletedMsgs}`) \r\n            // instance.get(`api/chats/${chatTypeId}/${chatId}/messages/?page=${page}`) :\r\n            // instance.get(`api/chats/${chatTypeId}/${chatId}/messages/?page=${page}&query=${query}`)\r\n    },\r\n    createMessage(chatTypeId, chatId, messageBody, fileId=null){\r\n        // console.log({messageBody, fileId})\r\n        return instance.post(`api/chats/${chatTypeId}/${chatId}/messages/create/`, {messageBody, fileId})\r\n    },\r\n\r\n\r\n    // uploadFile(file){\r\n    //     let formData = new FormData();\r\n    //     formData.append(\"file\", file);\r\n    //     return instance.post(`api/file/`, formData, {\r\n    //         headers: {\r\n    //             \"Content-Type\": \"multipart/form-data\",\r\n    //           }\r\n    //         //   ,\r\n    //         //   onUploadProgress,\r\n    //     })\r\n    // },\r\n\r\n    // can ask for files only from current chat to load \r\n    getFile( fileId ) {\r\n        return instance.get(`api/files/${fileId}`);\r\n    },\r\n    // downloadFile(filePath) {\r\n    //     return instance.get(`media/${filePath}`);\r\n    // },\r\n\r\n\r\n    // may just change it to json file:blob\r\n    // uploadFile( file ){\r\n    //     let formData = new FormData();\r\n    //     formData.append(\"file\", file);\r\n    //     return instance.post(`api/files/`, formData, {\r\n    //         headers: {\r\n    //             \"Content-Type\": \"multipart/form-data\",\r\n    //           }\r\n    //     })\r\n    // },\r\n    uploadFile( fileURL, fileName ){\r\n        return instance.post(`api/files/`, {fileURL, fileName})\r\n    },\r\n    // TIP there is problems\r\n    // uploadFile( file, onUploadProgress ){\r\n    //         let formData = new FormData();\r\n    //         formData.append(\"file\", file);\r\n    //         return instance.post(`api/files/`, formData, {\r\n    //             headers: {\r\n    //                 \"Content-Type\": \"multipart/form-data\",\r\n    //               }\r\n    //               ,\r\n    //               onUploadProgress,\r\n    //         })\r\n    //     },\r\n\r\n\r\n    editMessage(chatTypeId, chatId, messageId, newMessageBody){\r\n        // debugger\r\n        console.log(`api/chats/${chatTypeId}/${chatId}/messages/${messageId}/`)\r\n        console.log({newMessageBody})\r\n        return instance.put(`api/chats/${chatTypeId}/${chatId}/messages/${messageId}/`, {newMessageBody})\r\n    },\r\n    deleteMessage(chatTypeId, chatId, messageId){\r\n        return instance.delete(`api/chats/${chatTypeId}/${chatId}/messages/${messageId}/`)\r\n    },\r\n}\r\n\r\n// if there is no yet msgs\r\n// looks like there is no messages in chat yet\r\n// MyConversationMessage has no globalMsg.\r\n// looks like there is no messages in chat yet\r\n// MyConversationMessage has no globalMsg.","// // import Axios from 'axios';\r\n\r\nimport { usersAPI } from \"../api/api\";\r\n\r\n// // let sendSignUpRequest = (username, email, email2, password) => {\r\n// //     // no obtained tokens ( cause only register // not login )\r\n// //     let signup_data =\r\n// //     {\r\n// //         \"username\": username,\r\n// //         \"email\": email,\r\n// //         \"email2\": email2,\r\n// //         \"password\": password\r\n// //     }\r\n// //     // link // data // config {headers} == 0\r\n// //     Axios.post(`http://127.0.0.1:8000/api/auth/register/`, signup_data).then(response => {\r\n// //         console.log(response.data);\r\n// //         return response.data;\r\n// //         // return { \"username\": response.data.username, \"email\": response.data.email};\r\n\r\n// //     }).catch(function (error) { // errror impossible // cause always positive answers with status_code 200_ok\r\n// //         console.log(error);\r\n// //         return {};\r\n// //     });\r\n// //     // we always can handle email and username from response.data and error.data from \r\n// //     }\r\n\r\n// // let sendIsLoginRequest = (token) => {\r\n// //     let config = {\r\n// //         headers: {\r\n// //             'Authorization': 'Bearer ' + token\r\n// //           }\r\n// //         }\r\n// //     // link // data // config {headers} == 0\r\n// //     Axios.post(`http://127.0.0.1:8000/api/auth/me/`, config).then(response => {\r\n// //         console.log(response.data);\r\n// //         return response.data;\r\n\r\n// //     }).catch(function (error) {\r\n// //         console.log(error);\r\n// //         return {};\r\n// //     });\r\n// //     }\r\n\r\n// // let sendLoginRequest = (username,  password) => {\r\n// //     let login_data =\r\n// //     {\r\n// //         \"username\": username,\r\n// //         \"password\": password\r\n// //     }\r\n// //     // link // data // config {headers} == 0\r\n// //     return Axios.post(`http://127.0.0.1:8000/api/auth/login/`, login_data);\r\n// //     }\r\n\r\n// import Cookies from 'js-cookie';\r\n\r\n// const SIGNUP = 'SIGNUP';\r\n// const LOGIN = 'LOGIN';\r\n// // const IS_LOGIN = 'IS_LOGIN';\r\n\r\n// const SET_USERNAME = 'SET_USERNAME';\r\n// const SET_EMAIL = 'SET_EMAIL';\r\n// const SET_EMAIL2 = 'SET_EMAIL2';\r\n// const SET_PASSWORD = 'SET_PASSWORD';\r\n\r\n// const TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING';\r\n// const SET_REDIRECT_LOGIN = 'SET_REDIRECT';\r\n// const SET_REDIRECT_SIGNUP = 'SET_REDIRECT_SIGNUP';\r\n// const SET_REDIRECT_LOGOUT = 'SET_REDIRECT_LOGOUT'; \r\n\r\n// const DROP_STATE = 'DROP_STATE';\r\n\r\n// // const SET_COOKIES = 'SET_COOKIES';\r\n\r\n// let initialState = {\r\n//     // auth data ( that will be nulled after operation )\r\n//     username: '',\r\n//     email: '',\r\n//     email2: '',\r\n//     password: '',\r\n//     // resident data \r\n//     token: Cookies.get('token') || null,\r\n//     userId: Cookies.get('userId') || null,\r\n\r\n//     // invalidSignUpData: false, // signup // not appropriate data (or not all data)\r\n//     // invalidLoginData: false, // login // not appropriate data (or not all data)\r\n\r\n//     // userAlreadyExists: false, // signup //  unique field email or username wasnt passed\r\n//     // mailAlreadyRegistered: false, // signup //  unique field email or username wasnt passed\r\n//     // // isFetching: true,\r\n//     // fatalError: false\r\n//     errorMessage: null,\r\n\r\n//     isFetching: false,\r\n//     redirect_login: null,\r\n//     redirect_signup: null,\r\n//     redirect_logout: null\r\n// };\r\n\r\n\r\n// const authReducer = (state = initialState, action) => {\r\n\r\n//     switch(action.type) {\r\n//         case DROP_STATE:\r\n//             return {\r\n//                 ...state,\r\n//                 username: '',\r\n//                 email: '',\r\n//                 email2: '',\r\n//                 password: '',\r\n//                 token: null,\r\n//                 userId: null,\r\n//                 errorMessage: null,\r\n//                 isFetching: false,\r\n//                 redirect_login: null,\r\n//                 redirect_signup: null,\r\n//                 redirect_logout: null\r\n//             }\r\n\r\n//         case SET_USERNAME:\r\n//             return { ...state, username: action.username}\r\n//         case SET_EMAIL:\r\n//             return { ...state, email: action.email}\r\n//         case SET_EMAIL2:\r\n//             return { ...state, email2: action.email2}\r\n//         case SET_PASSWORD:\r\n//             return { ...state, password: action.password}\r\n\r\n\r\n\r\n//         // case SIGNUP:\r\n//         //     {\r\n//         //     let response = sendSignUpRequest(state.username, state.email, state.email2, state.password);\r\n//         //     if ('username' in response && 'email' in response){\r\n//         //         if (!Array.isArray(response.username) && !Array.isArray(response.email)){\r\n//         //             return { ...state, username: '', email: '', email2: '', password: '', errorMessage: null}; //           (  )\r\n//         //         }\r\n//         //     }\r\n//         //     // can contain username and email or both\r\n//         //     //    ?.\r\n//         //     return { ...state, errorMessage: {username: response.username?.[0], email: response.email?.[0]}}; // it will just undef if there is no email or no username\r\n//         //     }\r\n\r\n\r\n//             // if ('username' in response && 'email' in response){\r\n//             //     if (!Array.isArray(response.username) && !Array.isArray(response.email)){\r\n//             //         return { ...state, invalidSignUpData: false, userAlreadyExists: false, mailAlreadyRegistered: false, fatalError: false }; //         \r\n//             //     } else if (Array.isArray(response.username) && Array.isArray(response.email)){\r\n//             //         return { ...state, userAlreadyExists: true, mailAlreadyRegistered: true };\r\n//             //     } else {\r\n//             //         return { ...state, fatalError: true }; // cannot be one field str and another list\r\n//             //     }\r\n//             // } else if ('username' in response){\r\n//             //     if (Array.isArray(response.username)){\r\n//             //         // that means that this is an error message only in username\r\n//             //         return { ...state, userAlreadyExists: true };\r\n//             //     } else {\r\n//             //         return { ...state, fatalError: true }; // cannot be only username in positive signup return\r\n//             //     }\r\n//             // } else if ('email' in response){\r\n//             //     if (Array.isArray(response.email)){\r\n//             //         // that means that this is an error message only in email\r\n//             //         return { ...state, mailAlreadyRegistered: true };\r\n//             //     } else {\r\n//             //         return { ...state, fatalError: true }; // cannot be only email in positive signup return\r\n//             //     }\r\n//             // } else {\r\n//             //     return { ...state, fatalError: true };\r\n//             // }\r\n//         case SIGNUP:\r\n//             {\r\n//                 // if \r\n//                 // let send = sendLoginRequest(state.username, state.password);\r\n//                 if (action.errorMessage === null){\r\n//                     return { ...state, email: '', email2: '', errorMessage: action.errorMessage, username: '', password: '' }; //     \r\n//                 } else {\r\n//                     return { ...state, errorMessage: action.errorMessage }; //      \r\n//                 }\r\n//             }\r\n//         case LOGIN:\r\n//             {\r\n//                 if (action.errorMessage === null){\r\n//                     return { ...state, token: action.token, userId: action.userId, errorMessage: action.errorMessage, username: '', password: '' }; //     \r\n//                 } else {\r\n//                     return { ...state, token: action.token, userId: action.userId, errorMessage: action.errorMessage }; //      \r\n//                 }\r\n//             }\r\n//         case TOGGLE_IS_FETCHING:\r\n//             return {...state, isFetching: action.isFetching}\r\n//         case SET_REDIRECT_LOGIN:\r\n//             return {...state, redirect_login: action.redirect_login}\r\n//         case SET_REDIRECT_SIGNUP:\r\n//                 return {...state, redirect_signup: action.redirect_signup}\r\n//         case SET_REDIRECT_LOGOUT:\r\n//                     return {...state, redirect_logout: action.redirect_logout}\r\n//         default:\r\n//             return state;\r\n//     }\r\n// }\r\n\r\n\r\n// export const signup = (errorMessage) => ({type: SIGNUP, errorMessage});\r\n// export const login = (token, userId, errorMessage) => ({type: LOGIN, token, userId, errorMessage});\r\n\r\n\r\n\r\n// export const setUsername = (username) => ({type: SET_USERNAME, username});\r\n// export const setEmail = (email) => ({type: SET_EMAIL, email});\r\n// export const setEmail2 = (email2) => ({type: SET_EMAIL2, email2});\r\n// export const setPassword = (password) => ({type: SET_PASSWORD, password});\r\n\r\n// export const toggleIsFetching = (isFetching) => ({type: TOGGLE_IS_FETCHING, isFetching});\r\n\r\n// export const setRedirectLogin = (redirect_login) => ({type: SET_REDIRECT_LOGIN, redirect_login});\r\n// export const setRedirectSignUp = (redirect_signup) => ({type: SET_REDIRECT_SIGNUP, redirect_signup});\r\n\r\n// export const setRedirectLogout = (redirect_logout) => ({type: SET_REDIRECT_LOGOUT, redirect_logout});\r\n\r\n\r\n// export const dropState = () => ({type: DROP_STATE});\r\n\r\n\r\n// export default authReducer;\r\n\r\n\r\n// // email // email2 // password\r\n\r\n\r\nimport {authAPI} from \"../api/api\";\r\nimport { stopSubmit } from \"redux-form\";\r\nimport { idbKeyval } from \"../components/common/utils/indexedDB\";\r\n\r\nconst SET_USER_DATA = 'my-app/auth/SET_USER_DATA';\r\n\r\n\r\nlet initialState = {\r\n    userId: null,\r\n    email: null,\r\n    login: null,\r\n    isAuth: false,\r\n    // tokenError: false\r\n};\r\n\r\nconst authReducer = (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case SET_USER_DATA:\r\n            return {\r\n                ...state,\r\n                ...action.payload\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\n\r\nexport const setAuthUserData = (userId, email, login, isAuth) => ({type: SET_USER_DATA, payload:{userId, email, login, isAuth}})\r\n\r\nlet destructAUD = (data) => {\r\n    // debugger\r\n    return [data.userId, data.email, data.login]\r\n}\r\nlet dispatchSAUD = (dispatch, data, isAuth=true) => {\r\n    return dispatch(setAuthUserData(...destructAUD(data), isAuth))\r\n}\r\n\r\n\r\nexport const getAuthUserData = () => async(dispatch) => {\r\n    let response = await authAPI.me()\r\n    // debugger\r\n    if(\"detail\" in response.data){\r\n        if([\"Signature has expired.\", \"Error decoding signature.\", \"Invalid Authorization header. No credentials provided.\"].includes(response.data.detail)){\r\n            console.log(response.data.detail)\r\n            // dispatch(setAuthUserData(null, null, null, false, true))\r\n        } else {\r\n            console.log('its amaizing error - server error')\r\n        }\r\n    } else {\r\n        if(response.data.resultCode === 0){\r\n            dispatchSAUD(dispatch, response.data.data)\r\n        }\r\n    }\r\n    return response\r\n}\r\n\r\nexport const login = (login, password) => async(dispatch) => {\r\n    // console.log(login)\r\n    // console.log(password)\r\n    // delete localStorage['token']\r\n    await idbKeyval.delete('token')\r\n    let response = await authAPI.login(login, password)\r\n    if (response.data.resultCode === 0){\r\n        // console.log('3')\r\n        // localStorage.setItem('token', response.data.data.token)\r\n        await idbKeyval.set('token', response.data.data.token)\r\n        // localStorage.setItem('userId', response.data.data.userId)\r\n        // console.log('4')\r\n        dispatchSAUD(dispatch, response.data.data) // here we set user auth data ( but we dont call any api calls with token yet)\r\n        // console.log('5')\r\n    } else {\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        dispatch(stopSubmit(\"login\", {_error: message}));\r\n    }\r\n}\r\n\r\n// or async type????\r\nexport const logout = () => async(dispatch) => {\r\n    // we just cant logout from API server ( we can do this on frontend by deleting our localStorage TOKEN  - thats all folks)\r\n    // localStorage.setItem('token', null)\r\n    // delete localStorage['token']\r\n    await idbKeyval.delete('token')\r\n    // delete localStorage['userId']\r\n    // localStorage.setItem('userId', null)\r\n    dispatch(setAuthUserData(null, null, null, false, false))\r\n}\r\n\r\nexport const signup = (login, password) => async(dispatch) => {\r\n    let response = await authAPI.signup(login, password)\r\n    if (response.data.resultCode !== 0){\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        dispatch(stopSubmit(\"signup\", {_error: message}));\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default authReducer","import React from 'react';\r\n// import Header from \"./Header\";\r\nimport {connect} from \"react-redux\";\r\nimport {logout} from \"../../redux/auth-reducer\";\r\n\r\nimport s from './Header.module.css';\r\nimport {NavLink} from \"react-router-dom\";\r\n\r\nconst Header = (props) => {\r\n    return <header className={s.header}>\r\n        <img src='https://www.freelogodesign.org/Content/img/logo-ex-7.png' />\r\n\r\n        { props.isAuth ? \r\n        <div className={s.loginBlock}>{props.login} - <a onClick={props.logout}>Logout</a></div>\r\n                        : \r\n        <div className={s.loginBlock}><NavLink to={'/login'}>Login</NavLink></div> \r\n        }\r\n    \r\n\r\n    </header>\r\n}\r\n\r\n// export default Header;\r\n\r\n\r\nclass HeaderContainer extends React.Component {\r\n    // componentDidMount() {\r\n    //   this.props.getAuthUserData();\r\n    // }\r\n\r\n    render() {\r\n        return <Header {...this.props} />\r\n    }\r\n}\r\nconst mapStateToProps = (state) => ({\r\n    login: state.auth.login,\r\n    isAuth: state.auth.isAuth,\r\n});\r\n\r\nexport default connect(mapStateToProps, {logout})(HeaderContainer);","import React from 'react';\r\nimport s from './Navbar.module.css';\r\nimport {NavLink} from \"react-router-dom\";\r\n\r\nconst Navbar = () => {\r\n    return (\r\n        <nav className={s.nav}>\r\n            <div className={s.item}>\r\n                <NavLink to=\"/profile\" activeClassName={s.activeLink}>Profile</NavLink>\r\n            </div>\r\n            <div className={`${s.item} ${s.active}`}>\r\n                <NavLink to=\"/users\" activeClassName={s.activeLink}>Users</NavLink>\r\n            </div>\r\n            <div className={`${s.item} ${s.active}`}>\r\n                <NavLink to=\"/chats\" activeClassName={s.activeLink}>Chats</NavLink>\r\n            </div>\r\n            {/* <div className={`${s.item} ${s.active}`}>\r\n                <NavLink to=\"/dialogs\" activeClassName={s.activeLink}>Messages</NavLink>\r\n            </div>\r\n            <div className={`${s.item} ${s.active}`}>\r\n                <NavLink to=\"/users\" activeClassName={s.activeLink}>Users</NavLink>\r\n            </div>\r\n            <div className={s.item}>\r\n                <a>News</a>\r\n            </div>\r\n            <div className={s.item}>\r\n                <a>Music</a>\r\n            </div>\r\n            <div className={s.item}>\r\n                <a>Settings</a>\r\n            </div> */}\r\n\r\n            <div className={`${s.item} ${s.active}`}>\r\n                <NavLink to=\"/login\" activeClassName={s.activeLink}>Login</NavLink>\r\n            </div>\r\n            {/* <div className={`${s.item} ${s.active}`}>\r\n                <NavLink to=\"/logout\" activeClassName={s.activeLink}>Logout</NavLink>\r\n            </div> */}\r\n\r\n        </nav>\r\n    )\r\n}\r\n\r\nexport default Navbar;","import React from 'react';\r\nimport {connect} from \"react-redux\";\r\nimport {Redirect} from \"react-router-dom\";\r\n\r\nlet mapStateToPropsForRedirect = (state) => ({\r\n    isAuth: state.auth.isAuth,\r\n    userId: state.auth.userId\r\n});\r\n\r\nconst withAuthRedirect = (WrappedComponent) =>  {\r\n\r\n    class RedirectComponent extends React.Component{\r\n        // constructor(props){\r\n        //     super(props);\r\n        // }\r\n        render() {\r\n            // debugger\r\n            if (!this.props.isAuth) return <Redirect to='/login' />\r\n            return <WrappedComponent {...this.props} />\r\n        }\r\n    }\r\n    return connect(mapStateToPropsForRedirect)(RedirectComponent);\r\n}\r\n\r\nexport default withAuthRedirect;\r\n\r\n// export default connect(mapStateToPropsForRedirect)(withAuthRedirect);","const replaceQuotes = (string) => {\r\n    // debugger\r\n    string = JSON.parse(string.replace(/'/g, '\"'));\r\n    return string;\r\n};\r\nexport default replaceQuotes","import { chatsAPI, usersAPI } from \"../api/api\";\r\nimport { stopSubmit, reset } from \"redux-form\";\r\nimport replaceQuotes from \"../components/common/utils/quotes\";\r\nimport { idbKeyval } from \"../components/common/utils/indexedDB\";\r\nimport {saveAs} from \"file-saver\";\r\n\r\nconst SET_CHATS = 'SET_CHATS';\r\nconst SET_CHATS_ALIAS_MAP = 'SET_CHATS_ALIAS_MAP';\r\nconst SET_MESSAGES = 'SET_MESSAGES';\r\nconst SET_CURRENT_CHAT_DATA = 'SET_CURRENT_CHAT_DATA';\r\nconst EDIT_MESSAGE = 'EDIT_MESSAGE';\r\n\r\nconst CURRENT_CHAT_DATA_FETCHING = 'CURRENT_CHAT_DATA_FETCHING';\r\nconst TOOGLE_IS_UNMOUNT = 'TOOGLE_IS_UNMOUNT';\r\n\r\n// const ADD_USERS_TO_SELECT = 'ADD_USERS_TO_SELECT'\r\nconst SET_CURRENT_CHAT_MEMBERS ='SET_CURRENT_CHAT_MEMBERS'\r\nconst SET_CURRENT_CHAT_PHOTO = 'SET_CURRENT_CHAT_PHOTO'\r\nconst SET_CURRENT_CHAT_NAME = 'SET_CURRENT_CHAT_NAME'\r\n\r\n\r\n// const SET_READ_FROM_INDEX = 'SET_READ_FROM_INDEX'\r\n// const SET_READ_FROM_INDEX_NEXT = 'SET_READ_FROM_INDEX_NEXT'\r\nconst SET_READ_FROM_INDEXES = 'SET_READ_FROM_INDEXES'\r\n// const SET_LOADING_ON_SCROLL = 'SET_LOADING_ON_SCROLL'\r\nconst SET_FETCHING_MSGS = 'SET_FETCHING_MSGS'\r\n\r\n// const SET_OLD_MSGS_DOWNLOAD = 'SET_OLD_MSGS_DOWNLOAD'\r\n\r\n// const SET_FIRST_OF_LAST_SET_MSGS_ID = 'SET_FIRST_OF_LAST_SET_MSGS_ID'\r\n// const SET_FIRST_OF_SET_MSGS_ID = 'SET_FIRST_OF_SET_MSGS_ID'\r\n\r\n// const SET_FIRST_AND_LAST_OF_SET_MSGS_ID = 'SET_FIRST_AND_LAST_OF_SET_MSGS_ID'\r\n// const SET_PREFETCH_CC = 'SET_PREFETCH_CC'\r\n// const ADD_FILE_AS_LOADING = 'ADD_FILE_AS_LOADING'\r\n// const REMOVE_FILE_AS_LOADING = 'REMOVE_FILE_AS_LOADING'\r\n\r\nconst SHOULD_WINDOW_SCROLL_DOWN = 'SHOULD_WINDOW_SCROLL_DOWN'\r\nconst SET_MESSAGE_CREATING = 'SET_MESSAGE_CREATING'\r\nconst SET_REFRESH_AFTER_MESSAGE_CREATING = 'SET_REFRESH_AFTER_MESSAGE_CREATING'\r\n\r\n\r\n// // const SET_REFRESH_AFTER_DM = 'SET_REFRESH_AFTER_DM' \r\nconst INC_NUM_OF_DELETED_MSGS = 'INC_NUM_OF_DELETED_MSGS'\r\nconst NULL_NUM_OF_DELETED_MSGS = 'NULL_NUM_OF_DELETED_MSGS'\r\n\r\nconst SET_IDB_KEY_IN_MESSAGE = 'SET_IDB_KEY_IN_MESSAGE'\r\n\r\nlet initialState = {\r\n    chatId: null,\r\n    chatTypeId: null,\r\n    chatsAliases: [],\r\n    messages: [],\r\n    chats: [], //  \"dialogs\": [{\"id\": 1,\"name\": \"Mexus_1\"}],\"conversations\": [{ \"id\": 1,\"name\": \"HERE WE GO AGAIN\" }]\r\n    // messages: [], \r\n    // newMessageBody: \"\"\r\n    currentChat: null, // + 'readFromIndex'\r\n    isFetching: false,\r\n    isUnmount: false,\r\n\r\n    // usersToSelect: [],\r\n\r\n    membersToSelect: [],\r\n\r\n    readFromIndex: null,\r\n    readFromIndexNext: null,\r\n    readFromIndexBefore: null,\r\n    // loadingOnScroll: true,\r\n    IsFetchingMsgs: false,\r\n    loadingFilesIds: [],\r\n\r\n    // oldMsgsDonwload: false,\r\n\r\n    // firstOfLastSetOfMsgsId: null,\r\n    // firstOfSetOfMsgsId: null,\r\n\r\n\r\n    windowScrollOnMsgCreate: false,\r\n    // preFetchCC: false,\r\n    isMessageCreating: false,\r\n\r\n    isRefreshedAfterMC: false,\r\n\r\n    // isRefreshedAfterDM: false,\r\n    numOfDeletedMsgs: 0,\r\n};\r\n\r\n\r\nconst chatsReducer = (state = initialState, action) => {\r\n    switch (action.type) {\r\n\r\n        case INC_NUM_OF_DELETED_MSGS: {\r\n            let nodm = state.numOfDeletedMsgs + 1\r\n            return {...state, numOfDeletedMsgs: nodm} // SET_NUM_OF_DELETED_MSGS\r\n        }\r\n        case NULL_NUM_OF_DELETED_MSGS: {\r\n            let nodm = 0\r\n            return {...state, numOfDeletedMsgs: nodm} // SET_NUM_OF_DELETED_MSGS\r\n        }\r\n\r\n\r\n\r\n        case SET_CHATS: {\r\n            return {...state, chats: action.chats} //\r\n        }\r\n        case SET_CHATS_ALIAS_MAP: {\r\n            return {...state, chatsAliases: action.chatsAliases}\r\n        }\r\n        case SET_MESSAGES: {\r\n            return {...state, messages: action.messages}\r\n        }\r\n        case SET_CURRENT_CHAT_DATA: {\r\n            return {...state, chatId: action.chatId, chatTypeId: action.chatTypeId, currentChat: action.currentChat}\r\n        }\r\n        case TOOGLE_IS_UNMOUNT: {\r\n            return {...state, isUnmount: action.isUnmount}\r\n        }\r\n\r\n        case CURRENT_CHAT_DATA_FETCHING: {\r\n            return {...state, isFetching: action.isFetching}\r\n        }\r\n\r\n        case SET_CURRENT_CHAT_MEMBERS: {\r\n            return {...state, currentChat: {...state.currentChat, members: action.members}}\r\n        }\r\n        case SET_CURRENT_CHAT_NAME: {\r\n            return {...state, currentChat: {...state.currentChat, name: action.name}}\r\n        }\r\n        case SET_CURRENT_CHAT_PHOTO: {\r\n            return {...state, currentChat: {...state.currentChat, chatPhoto: action.chatPhoto}}\r\n        }\r\n\r\n        // case SET_READ_FROM_INDEX: {\r\n        //     return {...state, readFromIndex: action.readFromIndex}\r\n        // }\r\n        // case SET_READ_FROM_INDEX_NEXT: {\r\n        //     return {...state, readFromIndexNext: action.readFromIndexNext}\r\n        // }\r\n\r\n        case SET_READ_FROM_INDEXES: {\r\n            return {...state, readFromIndex: action.readFromIndex, readFromIndexNext: action.readFromIndexNext, readFromIndexBefore: action.readFromIndexBefore}  \r\n        }\r\n        // case SET_LOADING_ON_SCROLL: {\r\n        //     return {...state, loadingOnScroll: action.loadingOnScroll}\r\n        // }\r\n        case SET_FETCHING_MSGS : {\r\n            return {...state, IsFetchingMsgs: action.IsFetchingMsgs} \r\n        }\r\n\r\n        // case SET_OLD_MSGS_DOWNLOAD: {\r\n        //     return {...state, oldMsgsDonwload: action.oldMsgsDonwload}\r\n        // }\r\n\r\n\r\n        // case SET_FIRST_AND_LAST_OF_SET_MSGS_ID: {\r\n        //     return {...state, firstOfSetOfMsgsId: action.firstOfSetOfMsgsId, firstOfLastSetOfMsgsId: action.firstOfLastSetOfMsgsId}\r\n        // }\r\n\r\n        case SHOULD_WINDOW_SCROLL_DOWN : {\r\n            return {...state, windowScrollOnMsgCreate: action.windowScrollOnMsgCreate} \r\n        }\r\n\r\n        // case SET_FIRST_OF_SET_MSGS_ID: {\r\n        //     return {...state, firstOfSetOfMsgsId: action.firstOfSetOfMsgsId}\r\n        // }\r\n\r\n        // case SET_FIRST_OF_LAST_SET_MSGS_ID: {\r\n        //     return {...state, firstOfLastSetOfMsgsId: action.firstOfLastSetOfMsgsId}\r\n        // }\r\n\r\n        case SET_MESSAGE_CREATING : {\r\n            return {...state, isMessageCreating: action.isMessageCreating} \r\n        }\r\n        case SET_REFRESH_AFTER_MESSAGE_CREATING: {\r\n            return {...state, isRefreshedAfterMC: action.isRefreshedAfterMC} \r\n        }\r\n\r\n        case SET_IDB_KEY_IN_MESSAGE: {\r\n            return {...state, messages: action.idbFileMessageKey} \r\n        }\r\n        // case SET_REFRESH_AFTER_DM: {\r\n        //     return {...state, isRefreshedAfterDM: action.isRefreshedAfterDM} \r\n        // }\r\n        // case SET_PREFETCH_CC : {\r\n        //     return {...state, preFetchCC: action.preFetchCC}\r\n        // }\r\n        // case ADD_USERS_TO_SELECT: {\r\n        //     return {...state, usersToSelect: action.usersToSelect}\r\n        // }\r\n\r\n        // case ADD_FILE_AS_LOADING: {\r\n        //     return {...state, loadingFilesIds: action.fileId}\r\n        // }\r\n        // case REMOVE_FILE_AS_LOADING: {\r\n        //     return {...state, loadingFilesIds: action.fileId} // delete from list of loading and then add url of file to download ( if photo to <img src='api/file/{fileId}'> else only url <a href='api/file/{fileId}')\r\n        // }\r\n\r\n        case EDIT_MESSAGE: {\r\n            return {...state, messages: state.messages.map(msg => (msg.id === action.messageId ? { ...msg, body: action.newMessageBody} : msg) ) }\r\n        }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\n\r\n\r\nexport const setCurrentChatMembers = (members) => ({type: SET_CURRENT_CHAT_MEMBERS, members})\r\nexport const setCurrentChatName = (name) => ({type: SET_CURRENT_CHAT_NAME, name})\r\nexport const setCurrentChatPhoto = (chatPhoto) => ({type: SET_CURRENT_CHAT_PHOTO, chatPhoto})\r\n\r\n\r\n\r\nexport const setCurrentChatIdsToStore = (chatTypeId, chatId, currentChat) => ({type: SET_CURRENT_CHAT_DATA, chatId, chatTypeId, currentChat})\r\n\r\nexport const currentChatDataFetching = (isFetching) => ({type: CURRENT_CHAT_DATA_FETCHING, isFetching})\r\n\r\nexport const toogleIsUnmount = (isUnmount) => ({type: TOOGLE_IS_UNMOUNT, isUnmount})\r\n\r\n\r\n\r\nexport const setIDBKeyInMessage = (idbFileMessageKey, message) => ({type: SET_IDB_KEY_IN_MESSAGE, idbFileMessageKey})\r\n\r\n//         \r\n\r\n// const createKeyFor = (str) => {\r\n//     let timestamp = + new Date()\r\n//     return `${str}-${timestamp}`\r\n// }\r\n\r\nexport const saveImageToIDB = (blobObj, fileId) =>  async(dispatch) => { // add message.id and chatid and cahtTypeid for that key\r\n    // let imgKey = createKeyFor('image')\r\n    \r\n    // let chatId = parseInt(localStorage.getItem('chatId') )\r\n    // let chatTypeId = parseInt(localStorage.getItem('chatTypeId') )\r\n \r\n    // await idbKeyval.set(`image-${chatTypeId}-${chatId}-${fileId}`, blobObj)\r\n    await idbKeyval.set(`image-${fileId}`, blobObj)\r\n    // dispatch(setImg)\r\n}\r\n\r\nexport const loadImageFromIDB = (ImgKey) =>  async(dispatch) => { // get that blob add it to the img: src\r\n    return await idbKeyval.get(ImgKey)\r\n} \r\n\r\n\r\nfunction urltoFile(url, filename, mimeType){\r\n    console.log(\"url to file\" + url)\r\n    console.log(url)\r\n    return (fetch(url)\r\n        .then(function(res){return res.arrayBuffer();})\r\n        .then(function(buf){return new File([buf], filename,{type:mimeType});})\r\n    );\r\n}\r\n\r\n\r\nexport const getFile = (fileId) => async(dispatch) => {\r\n    let downloadedFile = await chatsAPI.getFile(fileId)\r\n    // console.log(\"downloadedFile\")\r\n    // console.log(downloadedFile)\r\n    // return downloadedFile.data\r\n    // return downloadedFile\r\n    let file = downloadedFile.data\r\n    console.log(file);\r\n    if(file.name){ \r\n        urltoFile(file.file, file.name, file.format)\r\n            .then(function(fileConv){   \r\n                    if(file.isImage){\r\n                        console.log('file.isImage');  \r\n                        \r\n                        let reader = new FileReader();\r\n                        reader.onload = function(upload) { \r\n                            console.log(\"Uploaded\");\r\n                            dispatch(saveImageToIDB(upload.target.result, fileId))   //  dispatch(loadImageFromIDB())\r\n                        }\r\n                        reader.readAsDataURL(fileConv); //   - .          \r\n\r\n                    } else {\r\n                        let blob = URL.createObjectURL(fileConv); //    Blob,  /. (      )\r\n                        saveAs(fileConv);\r\n                        URL.revokeObjectURL(blob)\r\n                    } \r\n                    \r\n                 })\r\n    } else {\r\n        console.log('error in getting file from api')\r\n    }\r\n}\r\n \r\n\r\n\r\n\r\n// export const addUsersToSelect = (usersToSelect) => ({type: ADD_USERS_TO_SELECT, usersToSelect})\r\n\r\n\r\n\r\n// export const requestUsersForChat = () => async(dispatch) => {\r\n//     // let result = []\r\n//     // let error = false//{data:{resultCode:0}}\r\n//     // let page = 1 \r\n//     // debugger\r\n//     // do\r\n//     // {\r\n//     //     let response = await usersAPI.getUsers(page);\r\n//     //     debugger\r\n//     //     console.log(response)\r\n//     //     if(response.data.resultCode!==0){\r\n//     //         debugger\r\n//     //         // result.push({'photos': (replaceQuotes(response.data.data.photos)).small,  \"userId\": response.data.data.userId,  'name': response.data.data.name})\r\n//     //         result.push({\"userId\": response.data.data.userId,  'name': response.data.data.name})\r\n//     //         page++;\r\n//     //     } else {\r\n//     //         error = true;\r\n//     //     }\r\n//     // } while(!error)\r\n//     // debugger\r\n//     let response = await usersAPI.getUsers(1);\r\n//     let result = []\r\n//     // debugger\r\n//     if(response.data.users.error===null){\r\n//         // debugger\r\n//         // result.push({'photos': (replaceQuotes(response.data.data.photos)).small,  \"userId\": response.data.data.userId,  'name': response.data.data.name})\r\n//         result = response.data.users.items.map(user => ({\"userId\": user.userId,  'name': user.name}))\r\n//         // page++;\r\n//     }\r\n//     dispatch(addUsersToSelect(result))\r\n// }\r\n\r\nexport const setChats = (chats) => ({type: SET_CHATS, chats})\r\nexport const setMessages = (messages) => ({type: SET_MESSAGES, messages})\r\nexport const editMessage = (messageId, newMessageBody) => ({type: EDIT_MESSAGE, messageId, newMessageBody})\r\n\r\n\r\nexport const setChatsAliasMap = (chatsAliases) => ({type: SET_CHATS_ALIAS_MAP, chatsAliases})\r\n\r\n\r\n// export const setReadFromIndexMsgs = (readFromIndex) => ({type: SET_READ_FROM_INDEX, readFromIndex}) \r\n// export const setReadFromIndexNextMsgs = (readFromIndexNext) => ({type: SET_READ_FROM_INDEX_NEXT, readFromIndexNext}) \r\n\r\nexport const setReadFromIndexes = (readFromIndex, readFromIndexNext, readFromIndexBefore) => ({type: SET_READ_FROM_INDEXES, readFromIndex, readFromIndexNext, readFromIndexBefore}) \r\n\r\n\r\n// export const setLoadingOnScroll = (loadingOnScroll) => ({type: SET_LOADING_ON_SCROLL, loadingOnScroll})\r\nexport const setFetchingMoreMsgs = (IsFetchingMsgs) => ({type: SET_FETCHING_MSGS, IsFetchingMsgs})\r\n\r\n// export const setOldMsgsDonwload = (oldMsgsDonwload) =>({type: SET_OLD_MSGS_DOWNLOAD, oldMsgsDonwload})\r\n\r\n\r\n// export const setFirsANDLastSetOfMsgsId = (firstOfSetOfMsgsId, firstOfLastSetOfMsgsId) =>({type: SET_FIRST_AND_LAST_OF_SET_MSGS_ID, firstOfSetOfMsgsId, firstOfLastSetOfMsgsId})\r\n\r\n\r\n\r\nexport const shouldWindowScrollDown =  (windowScrollOnMsgCreate) => ({type: SHOULD_WINDOW_SCROLL_DOWN, windowScrollOnMsgCreate})\r\n// export const setFirstOfSetOfMsgsId = (firstOfSetOfMsgsId) =>({type: SET_FIRST_OF_SET_MSGS_ID, firstOfSetOfMsgsId})\r\n// export const setFirstOfLastSetOfMsgsId = (firstOfLastSetOfMsgsId) =>({type: SET_FIRST_OF_LAST_SET_MSGS_ID, firstOfLastSetOfMsgsId})\r\nexport const setMessageCreating = (isMessageCreating) => ({type: SET_MESSAGE_CREATING, isMessageCreating})\r\nexport const setRefreshMessageCreating = (isRefreshedAfterMC) => ({type: SET_REFRESH_AFTER_MESSAGE_CREATING, isRefreshedAfterMC})\r\n\r\nexport const incNumOfDeletedMsgs = () => ({type: INC_NUM_OF_DELETED_MSGS})\r\nexport const nullNumOfDeletedMsgs = () => ({type: NULL_NUM_OF_DELETED_MSGS})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// export const setRefreshAfterDM = (isRefreshedAfterDM) => ({type: SET_REFRESH_AFTER_DM, isRefreshedAfterDM})\r\n// export const setPreFetchCC = (preFetchCC) => ({type: SET_PREFETCH_CC, preFetchCC})\r\n\r\n// export const addFileAsLoading = (fileId) => ({type: ADD_FILE_AS_LOADING, fileId}) \r\n// export const removeFileAsLoading = (fileId) => ({type: REMOVE_FILE_AS_LOADING, fileId}) \r\n\r\n\r\n\r\n// export const fetchMoreOldMsgs = (chatTypeId, chatId, readFromIndexNext, firstOfSetOfMsgsId ) => async(dispatch) => { \r\n//     await dispatch(getMessages(chatTypeId, chatId, readFromIndexNext, firstOfSetOfMsgsId ))\r\n//     // dispatch(setOldMsgsDonwload(false))\r\n// }\r\n\r\nexport const setCurrentChatData = (chatTypeId, chatId) => (dispatch) =>{\r\n    dispatch(currentChatDataFetching(true))\r\n    localStorage.setItem('chatTypeId', chatTypeId)\r\n    localStorage.setItem('chatId', chatId)\r\n    dispatch(currentChatDataFetching(false))\r\n}\r\n\r\nexport const unSetCurrentChatData = () => (dispatch) =>{\r\n    delete localStorage['chatId']\r\n    delete localStorage['chatTypeId']\r\n    dispatch(setCurrentChatIdsToStore(null, null, null))\r\n}\r\n\r\n\r\n// const checkOnScrollTop = (response, readFromIndex, dispatch) => {\r\n//     if(response.data.resultCode === 0){\r\n//         if(response.data.data.readFromIndexNext === readFromIndex){\r\n//             dispatch(setLoadingOnScroll(false)) // if scrolled to the top - infinity scroll stop\r\n//         }\r\n//         dispatch(setReadFromIndexMsgs(readFromIndex))\r\n//         dispatch(setReadFromIndexNextMsgs(response.data.data.readFromIndexNext))\r\n//     }\r\n// }\r\n\r\n\r\nexport const getCurrentChatData = () => async(dispatch) => {\r\n    dispatch(setFetchingMoreMsgs(true))\r\n    // console.log('getCurrentChatData call')\r\n    // debugger\r\n    let chatId = parseInt(localStorage.getItem('chatId') )\r\n    let chatTypeId = parseInt(localStorage.getItem('chatTypeId') )\r\n    \r\n\r\n    let response = await chatsAPI.getChat(chatTypeId, chatId)\r\n    if(response.data.resultCode === 0){\r\n        // debugger\r\n        // console.log(`firstNewMsgID: ${response.data.data.firstNewMsgID}`)\r\n        let isUpdated = 'local';\r\n        // console.log(response.data.data)\r\n        if(!('local' in response.data.data.lastMessage)){\r\n            console.log('not local lastMessage in getCurrentChatData')\r\n        }\r\n        else if (!response.data.data.lastMessage.local){\r\n            // console.log('not here')\r\n            isUpdated = await dispatch(updateUnreadMsgs(chatTypeId, chatId, response.data.data.lastMessage.id))\r\n        }\r\n        // debugger\r\n        if(isUpdated==='local' || isUpdated.data.resultCode === 0){\r\n            let chatType = chatTypeId===0? 'dialog': 'conversation'\r\n            response.data.data[\"chatTypeId\"]=chatTypeId\r\n            response.data.data[\"chatType\"]=chatType\r\n            response.data.data[\"chatId\"]=chatId\r\n            dispatch(setCurrentChatIdsToStore(chatTypeId, chatId, response.data.data)) \r\n            await dispatch(getMessages(chatTypeId, chatId, response.data.data.readFromIndex, response.data.data.readFromIndexBefore)) //   readFromIndex ( 0   ???) ( rfi   0 (    None))\r\n        }  else {\r\n            console.log('getCurrentChatData Error in updateUnreadMsgs'+ isUpdated.data.messages[0])\r\n        }\r\n    } else {\r\n        console.log('getCurrentChatData Error in getChat'+ response.data.messages[0])\r\n    }\r\n    // debugger\r\n    // console.log('getCurrentChatData end call')\r\n    // dispatch(setPreFetchCC(true))\r\n    // console.log('setPreFetchCC as true')\r\n    // debugger\r\n    dispatch(setFetchingMoreMsgs(false))\r\n}\r\n\r\n\r\n// setCurrentChatMembers\r\n\r\nexport const refreshCurrentChatData = (method, requiredDataKey) => async(dispatch) => {\r\n    let chatId = parseInt(localStorage.getItem('chatId') )\r\n    let chatTypeId = parseInt(localStorage.getItem('chatTypeId') )\r\n    let response = await chatsAPI.getChat(chatTypeId, chatId)\r\n    if(response.data.resultCode === 0){\r\n        dispatch(method(response.data.data[requiredDataKey]))\r\n    } else {\r\n        console.log('refreshCurrentChatData Error in getChat'+ response.data.messages[0])\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n// const getChatHelper = async(chatType, chatTypeId, chatArray) => {\r\n//     let unfilteredArray = await Promise.all(chatArray\r\n//         .map(async (chat) => {\r\n//         let response = await chatsAPI.getChat(chatTypeId, chat.id)\r\n//         if(response.data.resultCode === 0){\r\n//             response.data.data[\"chatTypeId\"]=chatTypeId\r\n//             response.data.data[\"chatType\"]=chatType\r\n//             response.data.data[\"chatId\"]=chat.id\r\n//             return response.data.data\r\n//         } else {\r\n//             console.log('getChat Error '+ response.data.messages[0])\r\n//             return null\r\n//         }\r\n//         } ))\r\n//     return unfilteredArray.filter(chat => chat!==null)\r\n//     }\r\n        \r\n\r\n\r\nconst getChatHelper = async(chatArray) => {\r\n    let unfilteredArray = await Promise.all(chatArray\r\n        .map(async (chat) => {\r\n        let response = await chatsAPI.getChat(chat.chatTypeId, chat.id)\r\n        if(response.data.resultCode === 0){\r\n            response.data.data[\"chatTypeId\"] = chat.chatTypeId\r\n            response.data.data[\"chatId\"]=chat.id\r\n            response.data.data[\"chatTimeStamp\"]=chat.chatTimeStamp\r\n            if(chat.chatTypeId===0){\r\n                response.data.data[\"chatType\"]='dialog'\r\n            } else{\r\n                response.data.data[\"chatType\"]='conversation'\r\n            }\r\n            return response.data.data\r\n        } else {\r\n            console.log('getChat Error '+ response.data.messages[0])\r\n            return null\r\n        }\r\n        } ))\r\n    // return unfilteredArray.filter(chat => chat!==null)\r\n    return unfilteredArray.sort((chat1,chat2)=>chat2.chatTimeStamp - chat1.chatTimeStamp)\r\n    }\r\n\r\nexport const getChats = (page=1, query=null) => async(dispatch) => {\r\n    // debugger\r\n    let response = await chatsAPI.getChats(page, query); // chatTypeId, chatId// =>\r\n    if(response.data.resultCode === 0){\r\n        // let dialogs = await getChatHelper('dialog', 0, response.data.data.dialogs)\r\n        // let conversations = await getChatHelper('conversation', 1, response.data.data.conversations)\r\n        // let chats = [...dialogs, ...conversations]\r\n        // console.log(chats)\r\n        let chats = await getChatHelper(response.data.data.chats.items)\r\n        dispatch(setChats(chats))\r\n    } else {\r\n        console.log('getChats error '+ response.data.messages[0])\r\n    }\r\n}\r\n\r\n//                \r\nconst getMessagesHelper = (array, chatTypeId, chatId) => array.map(msg => (msg[chatTypeId]=chatTypeId, msg[chatId]=chatId, msg))\r\n\r\n\r\n// TODO c set start position of view messages on last readed and then after scroll setting 1 by 1 msgs as viewed\r\n// for first load set firstOfSetOfMsgsId, firstOfLastSetOfMsgsId as null -ed\r\n\r\n// after page reload from chats\\ => by getCCD null-ed firstOfSetOfMsgsId=null, firstOfLastSetOfMsgsId=null -> so we can restart count of that indexes ///// /, numOfDeletedMsgs=0\r\nexport const getMessages = (chatTypeId, chatId, readFromIndex, readFromIndexBefore,\r\n    //   firstOfSetOfMsgsId=null,  \r\n                            query=null, isRefreshAfterMsgCreating=null, numOfDeletedMsgs=0) =>  async(dispatch) => {\r\n\r\n    dispatch(setFetchingMoreMsgs(true))\r\n    if(numOfDeletedMsgs > 0){\r\n        dispatch(nullNumOfDeletedMsgs())\r\n    }\r\n    let response = await chatsAPI.getMessages(chatTypeId, chatId, readFromIndex, readFromIndexBefore, query, numOfDeletedMsgs);\r\n    if(response.data.resultCode === 0){\r\n\r\n        let allKeysForImgs = await idbKeyval.keys() //      \r\n\r\n        let allMsgs = getMessagesHelper(response.data.data.items, chatTypeId, chatId)\r\n                        .map( (msg) => {\r\n                            if(msg.fileId !== null){\r\n                                \r\n                                let tryIdbKey = `image-${msg.fileId}`\r\n                                if(allKeysForImgs.includes(tryIdbKey)){\r\n                                    // console.log(tryIdbKey)\r\n                                    // debugger\r\n                                    msg['fileIDBKey'] = tryIdbKey\r\n                                }\r\n                            }\r\n                            return msg\r\n                        })  \r\n        \r\n\r\n        dispatch(setMessages(allMsgs))\r\n\r\n        if(allMsgs.length > 0){\r\n            dispatch(setReadFromIndexes(allMsgs[0].id, response.data.data.readFromIndexNext, response.data.data.readFromIndexBefore))    \r\n        } else { // can be only after refresh\r\n            dispatch(setReadFromIndexes(readFromIndex, response.data.data.readFromIndexNext, response.data.data.readFromIndexBefore))    \r\n        }\r\n        \r\n        \r\n        if(isRefreshAfterMsgCreating){\r\n            dispatch(shouldWindowScrollDown(false))\r\n            dispatch(setRefreshMessageCreating(true))\r\n        }\r\n\r\n\r\n        \r\n        // checkOnScrollTop(response, readFromIndex, dispatch)\r\n    } else {\r\n        console.log('getMessages error '+ response.data.messages[0])\r\n    }\r\n    \r\n    // if()\r\n    dispatch(setFetchingMoreMsgs(false))\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// export const downloadFile = (filePath) => async(dispatch) => {\r\n//     let file = await chatsAPI.downloadFile(filePath)\r\n//     // return file\r\n// }\r\n\r\n// then TODO download files to idb to use after from idb not from server!!!!!!\r\n// export const downloadFilesToContent = (fileId) => async(dispatch)  => {\r\n//     // dispatch(addFileAsLoading(fileId))\r\n//     let downloadedFile = await chatsAPI.getFile(fileId)\r\n//     console.log(\"downloadedFile\")\r\n//     console.log(downloadedFile)\r\n//     if(downloadedFile.data.resultCode === 0){\r\n//         idbKeyval.set(`fileId_${fileId}`, downloadedFile.data.file) // may use `fileId_${fileId}` ,\r\n//         // dispatch(downloadedFile.data.file) // fileId\r\n//     }\r\n//     // dispatch(removeFileAsLoading(fileId))\r\n// }\r\n\r\nconst createMessageSnippent = async(chatTypeId, chatId, messageBody, fileId, dispatch) => {\r\n    let response = await chatsAPI.createMessage(chatTypeId, chatId, messageBody, fileId);\r\n    if(response.data.resultCode === 0){\r\n        dispatch(shouldWindowScrollDown(true))\r\n        // dispatch(getMessages(chatTypeId, chatId))\r\n    } else {\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        dispatch(stopSubmit(\"CreateMessage\", {_error: message}));\r\n    }\r\n}\r\n \r\nexport const createMessageRequest = (chatTypeId, chatId, messageBody, file=null) => async(dispatch) => {\r\n    dispatch(setMessageCreating(true))\r\n\r\n \r\n    dispatch(reset('CreateMessage'));  // requires form name\r\n\r\n    console.log('in createMessageRequest')\r\n    console.log(file)\r\n    if (file!==null){\r\n        // let fileUploadResponse = await chatsAPI.uploadFile(file) // TIP there is problems\r\n        let fileUploadResponse = await chatsAPI.uploadFile(file['fileURL'], file['fileName'])\r\n        console.log(`fileUploadResponse.data`);\r\n        console.log(fileUploadResponse.data.data)\r\n        if(fileUploadResponse.data.data['fileId']){\r\n            // console.log(fileUploadResponse.data.data['fileId'])\r\n            createMessageSnippent(chatTypeId, chatId, messageBody, fileUploadResponse.data.data['fileId'], dispatch)\r\n        } else {\r\n            console.log('fileUploadResponse error')\r\n            console.log(Object.keys(fileUploadResponse.data.data))\r\n        }\r\n    } else {\r\n        createMessageSnippent(chatTypeId, chatId, messageBody, null, dispatch)\r\n    }\r\n    dispatch(setMessageCreating(false))\r\n    \r\n}\r\n\r\nexport const editMessageRequest = (chatTypeId, chatId, messageId, newMessageBody) => async(dispatch) =>{\r\n\r\n    let response = await chatsAPI.editMessage(chatTypeId, chatId, messageId, newMessageBody);\r\n    if(response.data.resultCode === 0){\r\n        console.log('succs edited')\r\n    } else {\r\n        console.log('editMessageRequest error '+ response.data.messages[0])\r\n    }\r\n}\r\n\r\n\r\nexport const deleteMessageRequest = (chatTypeId, chatId, messageId, fileId) =>  async(dispatch) =>{\r\n    // ref={\r\n    // debugger\r\n    dispatch(setFetchingMoreMsgs(true))\r\n\r\n    if(fileId){\r\n        await idbKeyval.delete(`image-${fileId}`)\r\n    } \r\n    \r\n    let response = await chatsAPI.deleteMessage(chatTypeId, chatId, messageId);\r\n    if(response.data.data === null){\r\n        console.log('succs deleted')\r\n        // dispatch(setRefreshAfterDM(true))\r\n        dispatch(incNumOfDeletedMsgs())\r\n    } else {\r\n        console.log('deleteMessageRequest deleted '+ response.data.messages[0])\r\n    }\r\n    dispatch(setFetchingMoreMsgs(false))\r\n}\r\n\r\n\r\n\r\nconst clearChatTypes = ['myLocal', 'myGlobal', 'allLocal', 'allGlobal'];\r\nexport const clearChat = (chatTypeId, chatId, putType, clearType) => async(dispatch) => {\r\n    // if (!['myLocal', 'myGlobal', 'allLocal', 'allGlobal'].includes(clearType)){\r\n    //     console.log('unsupported clearType')\r\n    //     return null\r\n    // }\r\n    // debugger\r\n    let response = await chatsAPI.clearChat(chatTypeId, chatId,  putType, clearType);\r\n    // debugger\r\n    if(response.data.resultCode === 0){\r\n        return response.data.data.cleared\r\n    } else {\r\n        console.log('clearLocalChat deleted '+ response.data.messages[0])\r\n    }\r\n}\r\nexport const clearChatMyLocal = (chatTypeId, chatId, putType='clear', clearType=clearChatTypes[0])   => clearChat(chatTypeId, chatId, putType, clearType)\r\nexport const clearChatMyGlobal = (chatTypeId, chatId, putType='clear', clearType=clearChatTypes[1])  => clearChat(chatTypeId, chatId, putType, clearType)\r\nexport const clearChatAllLocal = (chatTypeId, chatId, putType='clear', clearType=clearChatTypes[2]) =>  clearChat(chatTypeId, chatId, putType, clearType)\r\nexport const clearChatAllGlobal = (chatTypeId, chatId, putType='clear', clearType=clearChatTypes[3]) =>  clearChat(chatTypeId, chatId, putType, clearType)\r\n\r\n\r\n\r\nexport const updateUnreadMsgs = (chatTypeId, chatId, lastGlobalReadMsgId, putType='updateUnreadMsgs') => async(dispatch) => {\r\n    // console.log('updateUnreadMsgs')\r\n    // console.log(chatTypeId, chatId, lastGlobalReadMsgId, putType='updateUnreadMsgs')\r\n    let response = await chatsAPI.updateUnreadMsgs(chatTypeId, chatId, putType, lastGlobalReadMsgId)\r\n    // console.log(response.data)\r\n    // debugger\r\n    if(response.data.resultCode === 0){\r\n        console.log('updateUnreadMsgs updated')\r\n    } else {\r\n        console.log('updateUnreadMsgs error')\r\n    }\r\n    return response\r\n}\r\n\r\n\r\nexport const createChatRequest = (snusers, name) => async(dispatch) => {\r\n    debugger\r\n    let response = await chatsAPI.createChat(snusers, name)\r\n    debugger\r\n    if(response.data.resultCode === 0){\r\n        console.log('createChatRequest created: ' + response.data.data.created)\r\n    } else {\r\n        console.log('createChatRequest error')\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        dispatch(stopSubmit(\"CreateChat\", {_error: message}));\r\n    }\r\n}\r\n\r\nexport const createConversation = (snusers, name) => createChatRequest(snusers, name)\r\nexport const createDialog = (snusers) => createChatRequest(snusers, null)\r\n\r\n\r\n\r\nexport const deleteChatRequest = (chatTypeId, chatId) => async(dispatch) => {\r\n    let response = await chatsAPI.deleteChat(chatTypeId, chatId)\r\n    // debugger\r\n    if(response.data === ''){\r\n        console.log('chat succ deleted')\r\n    } else {\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        console.log('deleteChatRequest error: ' + message)\r\n    }\r\n}\r\n\r\nexport const renameChatRequest = (chatTypeId, chatId, newChatName, putType='rename') => async(dispatch) => {\r\n    // debugger\r\n    let response = await chatsAPI.renameChat(chatTypeId, chatId, putType, newChatName)\r\n    // debugger\r\n    if(response.data.resultCode === 0){\r\n        console.log('chat renamed:'+ response.data.data.renamed)\r\n        dispatch(refreshCurrentChatData(setCurrentChatName, 'name'))\r\n    } else {\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        dispatch(stopSubmit('renameChat', {_error: message}));\r\n    }\r\n}\r\n\r\n\r\n\r\n// athunku // thunku // athunkrf\r\n\r\n\r\n// all the same\r\nexport const toogleMemberStatus = (chatTypeId, chatId, userId, putType='toogleMemberStatus') => async(dispatch) => {\r\n    // let response = await chatsAPI.toogleMemberStatusForConversation(chatTypeId, chatId, putType, userId)\r\n    // if(response.data.resultCode === 0){\r\n    //     console.log('member status toggled: ' + response.data.data.toggled)\r\n    // } else {\r\n    //     let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n    //     console.log('toogleMemberStatusForConversation error: '+ message)\r\n    // }\r\n    await chatPutParts(chatTypeId, chatId, userId, putType, chatsAPI.toogleMemberStatusForConversation.bind(chatsAPI), 'member status toggled: ', 'toggled', 'toogleMemberStatusForConversation error: ', dispatch, setCurrentChatMembers, 'members')\r\n}\r\n\r\nexport const addMember = (chatTypeId, chatId, userId, putType='addMember') => async(dispatch) => {\r\n    console.log('adding member')\r\n    console.log(chatTypeId, chatId, userId)\r\n    // let response = await chatsAPI.addMemberForConversation(chatTypeId, chatId, putType, userId)\r\n    // if(response.data.resultCode === 0){\r\n    //     console.log('member added: ' + response.data.data.memberAdded)\r\n    // } else {\r\n    //     let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n    //     console.log('addMember error: '+ message)\r\n    // }\r\n    await chatPutParts(chatTypeId, chatId, userId, putType, chatsAPI.addMemberForConversation.bind(chatsAPI), 'member added: ', 'memberAdded', 'addMember error: ', dispatch, setCurrentChatMembers, 'members')\r\n}\r\n\r\n//        Bad Request: /api/chats/1/23/messages/\r\nexport const removeMember = (chatTypeId, chatId, userId, putType='removeMember') => async(dispatch) => {\r\n    // let response = await chatsAPI.removeMemberFromConversation(chatTypeId, chatId, putType, userId)\r\n    // if(response.data.resultCode === 0){\r\n    //     console.log('member removed: ' + response.data.data.memberRemoved)\r\n    // } else {\r\n    //     let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n    //     console.log('removeMember error: '+ message)\r\n    // }\r\n    // debugger \r\n    // if(response.data.resultCode === 0){ storeDispatchMethod\r\n    //     storeDispatchMethod && dispatch(refreshCurrentChatData(storeDispatchMethod)) // chatTypeId, chatId\r\n    // } \r\n    let response = await chatPutParts(chatTypeId, chatId, userId, putType, chatsAPI.removeMemberFromConversation.bind(chatsAPI), 'member removed: ', 'memberRemoved', 'removeMember error: ', dispatch, setCurrentChatMembers, 'members')\r\n\r\n}\r\n\r\n\r\nexport const removeMemberMsgs = (chatTypeId, chatId, userId, putType='removeMemberMsgs') => async(dispatch) => {\r\n    // let response = await chatsAPI.removeMemberMsgsForConversation(chatTypeId, chatId, putType, userId)\r\n    // if(response.data.resultCode === 0){\r\n    //     console.log('member msgs removed: ' + response.data.data.memberMsgsRemoved)\r\n    // } else {\r\n    //     let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n    //     console.log('removeMemberMsgs error: '+ message)\r\n    // }\r\n    await chatPutParts(chatTypeId, chatId, userId, putType, chatsAPI.removeMemberMsgsForConversation.bind(chatsAPI), 'member msgs removed: ', 'memberMsgsRemoved', 'removeMemberMsgs error: ')\r\n}\r\n\r\nexport const removeOneMemberMsg = (chatTypeId, chatId, userId, putType='removeOneMemberMsg') => async(dispatch) => {\r\n    // let response = await chatsAPI.removeOneMemberMsgForConversation(chatTypeId, chatId, putType, userId)\r\n    // if(response.data.resultCode === 0){\r\n    //     console.log('member msg removed: ' + response.data.data.memberMsgRemoved)\r\n    // } else {\r\n    //     let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n    //     console.log('removeOneMemberMsg error: '+ message)\r\n    // }\r\n    await chatPutParts(chatTypeId, chatId, userId, putType, chatsAPI.removeOneMemberMsgForConversation.bind(chatsAPI), 'member msg removed: ', 'memberMsgRemoved', 'removeOneMemberMsg error: ')\r\n}\r\n\r\n\r\nexport const setChatPhotoRequest = (chatTypeId, chatId, newChatPhoto, putType='setChatPhoto') => async(dispatch) => {\r\n    await chatPutParts(chatTypeId, chatId, newChatPhoto, putType, chatsAPI.setChatPhoto.bind(chatsAPI), 'chat photo changed: ', 'isChatPhotoChanged', 'setChatPhotoRequest error: ', dispatch, setCurrentChatPhoto, 'chatPhoto')\r\n}\r\n// all the same\r\n\r\nconst chatPutParts = async(chatTypeId, chatId, putData, putType, apiMethod, onSuccStr, onSuccDataKey, onErrorStr, dispatch=null, storeDispatchMethod=null, requiredDataKey=null) => {\r\n    // debugger\r\n    let response = await apiMethod(chatTypeId, chatId, putType, putData)\r\n    // debugger\r\n    if(response.data.resultCode === 0){\r\n        console.log(onSuccStr + response.data.data[onSuccDataKey])\r\n        storeDispatchMethod && dispatch(refreshCurrentChatData(storeDispatchMethod, requiredDataKey))\r\n    } else {\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        console.log(onErrorStr + message)\r\n    }\r\n    return response;\r\n}\r\nexport default chatsReducer;\r\n\r\n\r\n\r\n// export const getChat = (chatTypeId, chatId) => async(dispatch) => {\r\n//     let response = await chatsAPI.getChat(asyncAPIMethodParams)\r\n//     if(response.data.resultCode === 0){\r\n        \r\n//     } else {\r\n        \r\n//     }\r\n// }\r\n\r\n\r\n\r\n\r\n// startMsgId // lastReadMessageId // msgsType\r\n// 0\r\n// 8\r\n// old\r\n// <QuerySet []>\r\n// <QuerySet []>\r\n// listOfLocalSubs\r\n// []\r\n// returnList\r\n// [<QuerySet []>, <QuerySet [<ConversationMessage: ConversationMessage object (8)>]>]\r\n// <QuerySet []>\r\n// listOfLocalSubs\r\n// []\r\n// returnList\r\n// [[], <QuerySet [<ConversationMessage: ConversationMessage object (8)>]>]\r\n// lastReadMessageId // msgsType\r\n// 8\r\n// new\r\n// [31/Jul/2020 17:50:08] \"GET /api/chats/1/6/messages/ HTTP/1.1\" 200 291\r\n// startMsgId // lastReadMessageId // msgsType\r\n// 0\r\n// 7\r\n// old\r\n// <QuerySet [<MyConversationMessage: MyConversationMessage object (8)>]>\r\n// <QuerySet [<MyConversationMessage: MyConversationMessage object (8)>]>\r\n// listOfLocalSubs\r\n// [8]\r\n// returnList\r\n// [<QuerySet [<MyConversationMessage: MyConversationMessage object (8)>]>, <QuerySet []>]\r\n// <QuerySet [<MyConversationMessage: MyConversationMessage object (8)>]>\r\n// listOfLocalSubs\r\n// [8]\r\n// returnList\r\n// [[], <QuerySet []>]\r\n// lastReadMessageId // msgsType\r\n// 7\r\n// new\r\n\r\n// [local, global]","import React from 'react';\r\nimport preloader from \"../../../assets/images/preloader1.gif\";\r\n\r\nlet Preloader = (props) => {\r\n    return <div  style={ { backgroundColor: 'white' } }>\r\n        <img src={preloader} style={ { width: '8wh', height: '8vh' } }/>\r\n    </div>\r\n}\r\n\r\nexport default Preloader;","// import moment from 'moment-timezone/moment-timezone';\r\nexport const convertTime = (unix_timestamp) => {\r\n    if(!unix_timestamp) return ''\r\n    let time = new Date(unix_timestamp * 1000);\r\n    let hours = time.getHours()< 10 ? `0${time.getHours()}` : time.getHours()\r\n    let mins = time.getMinutes() < 10 ? `0${time.getMinutes()}`: time.getMinutes()\r\n    return `${hours}:${mins}`\r\n}\r\n\r\n// https://overcoder.net/q/25947/%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D1%8F-%D1%87%D0%B0%D1%81%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE-%D0%BF%D0%BE%D1%8F%D1%81%D0%B0-%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0-%D0%B2-javascript","import React, { useEffect, useState } from 'react';\r\nimport styles from './FormsControls.module.css'\r\nimport { Field } from 'redux-form';\r\n\r\nimport PropTypes from 'prop-types';\r\nimport { chatsAPI } from '../../../api/api';\r\n\r\n\r\n// import MultiSelect from \"react-multi-select-component\";\r\n\r\n\r\n// how to show that we dont pass the field validation before submitting ( or after )\r\n// field-level validation\r\nconst FormControl = ({ input, meta: {touched, error, warning}, children }) => { // children = <input {...input} {...restProps} /> or children = <input {...input} {...restProps} />\r\n    const hasError = touched && error;\r\n    const hasWarn = touched && warning;\r\n    return (\r\n        <div className={styles.formControl + ' ' + (hasError ? styles.error: \"\") + ' ' + (hasWarn ? styles.warning: \"\")}>\r\n            <div className=''>\r\n                {children}\r\n            </div>\r\n            <div className=''>\r\n                {\r\n                (hasError && <span>{error}</span>) ||\r\n                (hasWarn && <span>{warning}</span>)\r\n                }\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nexport const TextArea = (props) => {\r\n    const { input, meta, child, ...restProps } = props;\r\n    return (<FormControl {...props}><textarea {...input} {...restProps} /></FormControl>)\r\n}\r\n\r\nexport const Input = (props) => {\r\n    const { input, meta, child, ...restProps } = props;\r\n    // console.log('Input input: ' + input)\r\n    // console.log('Input meta: ' + meta)\r\n    // console.log('Input child: ' + child)\r\n    // console.log('Input restProps: ' + restProps)\r\n    // console.log('Input props: ' + props)\r\n    return (<FormControl {...props}><input {...input} {...restProps}/></FormControl>)\r\n}\r\n\r\n\r\n\r\n// export const UploadFiles = ({fileId}) => {\r\n\r\n//     const [selectedFiles, setSelectedFiles] = useState(undefined);\r\n//     const [currentFile, setCurrentFile] = useState(undefined);\r\n//     const [progress, setProgress] = useState(0);\r\n//     const [message, setMessage] = useState(\"\");\r\n\r\n//     const [fileInfos, setFileInfos] = useState([]);\r\n\r\n\r\n//     const selectFile = (event) => {\r\n//         setSelectedFiles(event.target.files);\r\n//       };\r\n\r\n//     const upload = () => {\r\n//         let currentFile = selectedFiles[0];\r\n    \r\n//         setProgress(0);\r\n//         setCurrentFile(currentFile);\r\n    \r\n//         chatsAPI.uploadFile(currentFile, (event) => {\r\n//           setProgress(Math.round((100 * event.loaded) / event.total));\r\n//         })\r\n//           .then((response) => {\r\n//             setMessage(response.data.message);\r\n//             return chatsAPI.getFile(fileId);\r\n//           })\r\n//           .then((files) => {\r\n//             setFileInfos(files.data);\r\n//           })\r\n//           .catch(() => {\r\n//             setProgress(0);\r\n//             setMessage(\"Could not upload the file!\");\r\n//             setCurrentFile(undefined);\r\n//           });\r\n    \r\n//         setSelectedFiles(undefined);\r\n//       };\r\n\r\n//     useEffect(() => {\r\n//         chatsAPI.getFile(fileId).then((response) => {\r\n//           setFileInfos(response.data);\r\n//         });\r\n//       }, []);\r\n\r\n//     return (\r\n//       <div>\r\n//         {currentFile && (\r\n//           <div className=\"progress\">\r\n//             <div\r\n//               className=\"progress-bar progress-bar-info progress-bar-striped\"\r\n//               role=\"progressbar\"\r\n//               aria-valuenow={progress}\r\n//               aria-valuemin=\"0\"\r\n//               aria-valuemax=\"100\"\r\n//               style={{ width: progress + \"%\" }}\r\n//             >\r\n//               {progress}%\r\n//             </div>\r\n//           </div>\r\n//         )}\r\n  \r\n//         <label className=\"btn btn-default\">\r\n//           <input type=\"file\" onChange={selectFile} />\r\n//         </label>\r\n  \r\n//         <button\r\n//           className=\"btn btn-success\"\r\n//           disabled={!selectedFiles}\r\n//           onClick={upload}\r\n//         >\r\n//           Upload\r\n//         </button>\r\n  \r\n//         <div className=\"alert alert-light\" role=\"alert\">\r\n//           {message}\r\n//         </div>\r\n  \r\n//         <div className=\"card\">\r\n//           <div className=\"card-header\">List of Files</div>\r\n//           <ul className=\"list-group list-group-flush\">\r\n//             {fileInfos &&\r\n//               fileInfos.map((file, index) => (\r\n//                 <li className=\"list-group-item\" key={index}>\r\n//                   <a href={file.url}>{file.name}</a>\r\n//                 </li>\r\n//               ))}\r\n//           </ul>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   };\r\n\r\n  \r\n\r\n\r\n// export const FileInput = (props) => {\r\n//     // TIP there is problems\r\n    \r\n//     const { input, meta, child, ...restProps } = props;\r\n//     return (<FormControl {...props}>  <input {...input} {...restProps}/> </FormControl>)\r\n\r\n// }\r\n// // <input {...input} {...restProps}/> onChange={props.selectFile}\r\n\r\n\r\n// export class FileInput extends React.Component {\r\nexport const FileInput = (props) => {\r\n\r\n    const { input, meta, child, ...restProps } = props;\r\n\r\n    const getBase64 = (file) => {\r\n      return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = () => resolve(reader.result);\r\n        reader.onerror = error => reject(error);\r\n      });\r\n    }\r\n  \r\n    const onFileChange = async (e) => {\r\n      const { input } = props\r\n      const targetFile = e.target.files[0]\r\n      if (targetFile) {\r\n        const val = await getBase64(targetFile) \r\n        input.onChange({'fileURL': val, 'fileName':targetFile.name})\r\n      } else {\r\n        input.onChange(null)\r\n      }\r\n    }\r\n\r\n\r\n    const fileInputKey = input.value ? input.value.name : +new Date();\r\n\r\n    return (\r\n  //   <>\r\n        <input \r\n          key={fileInputKey}\r\n          type=\"file\"\r\n          onChange={onFileChange}\r\n        //   {...input} {...restProps}\r\n        />\r\n        \r\n      )\r\n    // }\r\n  }\r\n  \r\n\r\n// export const MultiSelectWrap = (props) => {\r\n//     debugger\r\n//     // const { meta, child, ...restProps } = props; // input\r\n//     // console.log(...restProps)\r\n//     // debugger\r\n//     // console.log('Input input: ' + input)\r\n//     // console.log('Input meta: ' + meta)\r\n//     // console.log('Input child: ' + child)\r\n//     // console.log('Input restProps: ' + restProps)\r\n//     // console.log('Input props: ' + props)\r\n//     return (<FormControl {...props}><MultiSelect options={props.optionsMS} \r\n//         value={props.valueMS} \r\n//         onChange={props.onChangeMS}\r\n//         labelledBy={props.labelledByMS} /></FormControl>)\r\n// }\r\n\r\n\r\n\r\n\r\n// export const Select = (props) => {\r\n//     const { input, meta, child, ...restProps } = props;\r\n//     return (<FormControl {...props}>\r\n//         <select {...input} {...restProps}>\r\n//         </select>\r\n//         </FormControl>)\r\n// }\r\n///       \r\n// const ForChatUsersList = () => {\r\n//     // const onSubmitMemberList = () => {\r\n\r\n//     // }\r\n//     const [] = useState // selectedMembers\r\n// return (\r\n//     <UsersContainer />\r\n// )\r\n// }\r\n\r\n// export const ForChatUsersListWrap = (props) => {\r\n//     // debugger\r\n//     // return (<FormControl {...props}><ForChatUsersList /></FormControl>)\r\n//     return <ForChatUsersList />\r\n// }\r\n\r\nexport const createField = (placeholder, name, component, validators, props={}, text=\"\") => { \r\n    return <div className=''><Field placeholder={placeholder} name={name} component={component} validate={validators} {...props}/>{text}</div>\r\n};\r\n\r\n\r\nexport class DropDownSelect extends React.Component { // eslint-disable-line react/prefer-stateless-function\r\n\r\n    renderSelectOptions = (person) => (\r\n        <option key={person.userId} value={person.userId}>{person.name}</option>\r\n    )\r\n\r\n    render() {\r\n        const { input, label } = this.props;\r\n        return (\r\n        <div>\r\n            {/* <label htmlFor={label}>{label}</label> */}\r\n            <select {...input}>\r\n            <option value=\"\">Select</option>\r\n            {this.props.people.map(this.renderSelectOptions)}\r\n            </select>\r\n        </div>\r\n        );\r\n    }\r\n}\r\n\r\nDropDownSelect.propTypes = {\r\n    people: PropTypes.array,\r\n    input: PropTypes.object,\r\n    label: PropTypes.string,\r\n};\r\n\r\n\r\n\r\nexport const ReduxFormSnippet = ({ pristine, reset, submitting, error, sumbitButtonName } ) => {\r\n    return (\r\n        <>\r\n        {\r\n            error && \r\n            <div className={styles.formSummaryError}>\r\n                {error}\r\n            </div>\r\n            }\r\n            <div className=''>\r\n                <button type='submit' disabled={pristine || submitting} >{sumbitButtonName}</button>\r\n            </div>\r\n            <div className=''>\r\n                <button type='button' disabled={pristine || submitting} onClick={reset}>Clear</button>\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\n// export const Select = (props) => {\r\n//     const { input, meta, child, ...restProps } = props;\r\n//     // console.log('Input input: ' + input)\r\n//     // console.log('Input meta: ' + meta)\r\n//     // console.log('Input child: ' + child)\r\n//     // console.log('Input restProps: ' + restProps)\r\n//     // console.log('Input props: ' + props)\r\n//     return (<FormControl {...props}><DropDownSelect {...input} {...restProps} /></FormControl>)\r\n// }","export const requiredField = value => {\r\n    if(value) return undefined;\r\n    return \"Field is required\";\r\n}\r\n\r\n\r\nconst maxLength = max => value => \r\n    value && value.length > max ? `Value must be no longer then ${max} symbols`: undefined;\r\n\r\n    \r\nexport const maxLength10 = maxLength(10);\r\nexport const maxLength30 = maxLength(30);\r\nexport const maxLength50 = maxLength(50);\r\nexport const maxLength200 = maxLength(200);\r\nexport const maxLength1000 = maxLength(1000);","const backupQuotes = (string) => {\r\n    // obj = JSON.parse(obj.replace(/'/g, '\"'));\r\n    string = JSON.stringify(string).replace(/\"/g, '\\'')\r\n    // debugger\r\n    return string;\r\n}\r\nexport default backupQuotes;","export const updateObjectInArray = (itmes, itemId, objPropName, newObjProps) => {\r\n    // debugger\r\n    return itmes.map( item =>  {\r\n        if (item[objPropName] === itemId) {\r\n            return {...item, ...newObjProps}\r\n        }\r\n        return item;\r\n    })  \r\n}","import {usersAPI} from \"../api/api\";\r\nimport { updateObjectInArray } from \"../components/common/utils/object-helpers\";\r\n\r\n// const FOLLOW = 'FOLLOW';\r\n// const UNFOLLOW = 'UNFOLLOW';\r\nconst FOLLOW_UNFOLLOW = 'FOLLOW_UNFOLLOW';\r\nconst SET_USERS = 'SET_USERS';\r\nconst SET_CURRENT_PAGE = 'SET_CURRENT_PAGE';\r\nconst SET_TOTAL_USERS_COUNT = 'SET_TOTAL_USERS_COUNT';\r\nconst TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING';\r\nconst TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS';\r\nconst SET_QUERY = 'SET_QUERY';\r\nlet initialState = {\r\n    users: [ ],\r\n    pageSize: 5,\r\n    totalUsersCount: 0,\r\n    currentPage: 1,\r\n    isFetching: true,\r\n    followingInProgress: [],\r\n    query: '',\r\n};\r\n\r\nconst usersReducer = (state = initialState, action) => {\r\n    switch(action.type) {\r\n        case SET_QUERY: {\r\n            return {...state, query:action.query}\r\n        }\r\n        case FOLLOW_UNFOLLOW: { \r\n            // debugger\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, \"userId\", {userRelation: action.userRelation}) //\r\n            }\r\n        }\r\n        // case UNFOLLOW:\r\n        //     return {\r\n        //         ...state,\r\n        //         users: updateObjectInArray(state.users, action.userId, \"userId\", {followed: false})\r\n        //     }\r\n        case SET_USERS: {\r\n            return { ...state, users: action.users }\r\n        }\r\n        case SET_CURRENT_PAGE: {\r\n            return { ...state, currentPage: action.currentPage}\r\n        }\r\n        case SET_TOTAL_USERS_COUNT: {\r\n            return { ...state, totalUsersCount: action.count}\r\n        }\r\n        case TOGGLE_IS_FETCHING: {\r\n            return { ...state, isFetching: action.isFetching}\r\n        }\r\n        case TOGGLE_IS_FOLLOWING_PROGRESS: {\r\n            // console.log(`followingInProgress: ${state.followingInProgress}`);\r\n            // debugger\r\n            let l = {\r\n                ...state,\r\n                followingInProgress: action.isFetching\r\n                    ? [...state.followingInProgress, action.userId]\r\n                    : state.followingInProgress.filter(id => id !== action.userId)\r\n            }\r\n            // debugger\r\n            return l\r\n        }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport const setQuery = (query) => ({type: SET_QUERY, query })\r\nexport const followUnfollowSuccess = (userId, userRelation) => ({type: FOLLOW_UNFOLLOW, userId, userRelation })\r\n// export const unfollowSuccess = (userId, userRelation) => ({type: UNFOLLOW, userId, userRelation })\r\nexport const setUsers = (users) => ({type: SET_USERS, users })\r\nexport const setCurrentPage = (currentPage) => ({type: SET_CURRENT_PAGE, currentPage })\r\nexport const setTotalUsersCount = (totalUsersCount) => ({type: SET_TOTAL_USERS_COUNT, count: totalUsersCount })\r\nexport const toggleIsFetching = (isFetching) => ({type: TOGGLE_IS_FETCHING, isFetching })\r\nexport const toggleFollowingProgress = (isFetching, userId) => ({type: TOGGLE_IS_FOLLOWING_PROGRESS, isFetching, userId })\r\n\r\n\r\n\r\n\r\n\r\n// we dont actually need pageSize\r\nexport const requestUsers = (page, pageSize) => {\r\n    // debugger\r\n    return async(dispatch) => {\r\n        dispatch(toggleIsFetching(true));\r\n        dispatch(setCurrentPage(page));\r\n\r\n        let response =  await usersAPI.getUsers(page);\r\n        // debugger\r\n        \r\n        dispatch(toggleIsFetching(false));\r\n        dispatch(setUsers(response.data.users.items));\r\n        dispatch(setTotalUsersCount(response.data.users.totalCount));\r\n    }\r\n}\r\n\r\n\r\nexport const searchUsers = (page, query) => {\r\n    return async(dispatch) => {\r\n        dispatch(toggleIsFetching(true));\r\n        dispatch(setCurrentPage(page));\r\n\r\n        let response =  await usersAPI.getUsers(page, query);\r\n        // debugger\r\n        \r\n        dispatch(toggleIsFetching(false));\r\n        dispatch(setUsers(response.data.users.items));\r\n        dispatch(setTotalUsersCount(response.data.users.totalCount));\r\n    }\r\n}\r\n\r\nconst followUnfollowFlow = async(dispatch, userId, apiMethod, actionCreator) => {\r\n    dispatch(toggleFollowingProgress(true, userId));\r\n    // debugger\r\n    let response =  await apiMethod(userId);\r\n    // debugger\r\n    if (response.data.resultCode === 0 || response.data === '') {\r\n        let response2 = await usersAPI.getfollow(userId);\r\n        // debugger\r\n        if (response2.data.resultCode === 0) {\r\n            dispatch(actionCreator(userId, response2.data.data.userRelation));\r\n        }\r\n    }\r\n    dispatch(toggleFollowingProgress(false, userId));\r\n}\r\n\r\nexport const follow = (userId) => {\r\n    return (dispatch) => {\r\n        followUnfollowFlow(dispatch, userId, usersAPI.follow.bind(usersAPI), followUnfollowSuccess);\r\n    }\r\n}\r\nexport const unfollow = (userId) => {\r\n    return (dispatch) => {\r\n        followUnfollowFlow(dispatch, userId, usersAPI.unfollow.bind(usersAPI), followUnfollowSuccess);\r\n    }\r\n}\r\n\r\nexport default usersReducer;","/* eslint-disable jsx-a11y/anchor-is-valid */\r\n\r\nimport React from 'react';\r\nimport styles from \"./Users.module.css\";\r\nimport userPhoto from \"../../assets/images/user.png\";\r\nimport {NavLink} from \"react-router-dom\";\r\n\r\nlet User = ({user, followingInProgress, unfollow, follow}) => {\r\n    console.log(user)\r\n    // debugger followed\r\n    return (\r\n       <div>\r\n                <span>\r\n                    <div>\r\n                       <NavLink to={'/profile/' + user.userId}>\r\n                        <img src={user.photos.small != null ? user.photos.small : userPhoto}\r\n                             className={styles.userPhoto}/>\r\n                       </NavLink>\r\n                    </div>\r\n                    <div>\r\n                        {(user.userRelation === 'subscription' || user.userRelation === 'friend')\r\n                        //['subscription', 'friend'].includes(user.userRelation)\r\n                        ?\r\n                            <button disabled={followingInProgress\r\n                                .some(id => id === user.userId)}\r\n                                      onClick={() => { unfollow(user.userId) }}>\r\n                                Unfollow</button>\r\n                        :\r\n                        // ||\r\n                        // (['subscriber', null].includes(user.userRelation) \r\n                        // &&\r\n                            <button disabled={followingInProgress\r\n                                .some(id => id === user.userId)}\r\n                                      onClick={() => { follow(user.userId) }}>\r\n                                      Follow</button>\r\n                        }\r\n\r\n                    </div>\r\n                </span>\r\n                <span>\r\n                    <span>\r\n                        <div>{user.name}</div>\r\n                        <div>{user.status}</div>\r\n                    </span>\r\n                    {/* <span>\r\n                        <div>{\"user.location.country\"}</div>\r\n                        <div>{\"user.location.city\"}</div>\r\n                    </span> */}\r\n                </span>\r\n            </div>)\r\n}\r\n\r\nexport default User;\r\n\r\n\r\n\r\nexport const ForChatUser = ({user, setSelectedForChatUsers, setSelectedForChatUser, selectedForChatUsers, chatUsersIds, styleForUser, ...props}) => {\r\n    // console.log(user)\r\n    // debugger followed // className={styleForUser}\r\n    // console.log([...selectedForChatUsers.filter(selUserId => selUserId !== user.userId)])\r\n    // console.log(selectedForChatUsers)\r\n    return ( \r\n        <div>\r\n            <NavLink to={'/profile/' + user.userId}>\r\n                <div >{user.name}</div>\r\n                <div className={styles.userChoosePhoto}><img src={user.photos.small} alt='Ava' /></div>\r\n            </NavLink>\r\n            { selectedForChatUsers \r\n            ?  \r\n                selectedForChatUsers.includes(user.userId) ? \r\n                // setSelectedForChatUsers ?\r\n                <a onClick={()=>{setSelectedForChatUsers( selectedForChatUsers.filter(selUserId => selUserId !== user.userId) )}}>Remove User</a> \r\n                // :\r\n                // null\r\n                // // null --- cause cant be anything - this bloack should be closed after 1 member choise \r\n                :\r\n                <a onClick={()=>{setSelectedForChatUsers([...selectedForChatUsers, user.userId])}}>Add User</a> \r\n\r\n            :\r\n                chatUsersIds.includes(user.userId) ? \r\n                    <div style={{color:\"blue\"}}>Chat Member</div>  \r\n                : \r\n\r\n                 <a onClick={()=>\r\n                    {\r\n                     setSelectedForChatUser(user.userId);\r\n                     console.log('after that should run inner function of useUserReducer '+ user.userId) \r\n                    //  props.clearCurrentFocusedWindow(props.fWAUFC) - dont work why???? but its better - cause i can choose a lot of users for adding to chat\r\n                    }\r\n                }>Add Member</a>  \r\n             }\r\n            \r\n        </div>\r\n             )\r\n}\r\n\r\n\r\n","import React, {useState} from 'react';\r\nimport styles from \"./paginator.module.css\";\r\nimport cn from \"classnames\";\r\n\r\nlet Paginator = ({totalItemsCount, pageSize, currentPage, onPageChanged, portionSize = 10}) => {\r\n\r\n    let pagesCount = Math.ceil(totalItemsCount / pageSize);\r\n\r\n    let pages = [];\r\n    for (let i = 1; i <= pagesCount; i++) {\r\n        pages.push(i);\r\n    }\r\n\r\n    let portionCount = Math.ceil(pagesCount / portionSize);\r\n    let [portionNumber, setPortionNumber] = useState(1);\r\n    let leftPortionPageNumber = (portionNumber - 1) * portionSize + 1;\r\n    let rightPortionPageNumber = portionNumber * portionSize;\r\n\r\n\r\n    return <div className={styles.paginator}>\r\n        { portionNumber > 1 &&\r\n        <button onClick={() => setPortionNumber(portionNumber - 1)}>PREV</button> }\r\n\r\n            {pages\r\n                .filter(p => p >= leftPortionPageNumber && p<=rightPortionPageNumber)\r\n                .map((p) => {\r\n                return <span className={ cn({\r\n                    [styles.selectedPage]: currentPage === p\r\n                }, styles.pageNumber) }\r\n                             key={p}\r\n                             onClick={(e) => {\r\n                                 onPageChanged(p);\r\n                             }}>{p}</span>\r\n            })}\r\n        { portionCount > portionNumber &&\r\n            <button onClick={() => setPortionNumber(portionNumber + 1)}>NEXT</button> }\r\n\r\n\r\n    </div>\r\n}\r\n\r\nexport default Paginator;","import React from 'react';\r\n\r\n// import Paginator from \"../common/Paginator/Paginator\";\r\nimport User, { ForChatUser } from \"./User\";\r\nimport Paginator from '../common/Paginator/Paginator';\r\n\r\n\r\nlet Users = ({currentPage, totalUsersCount, pageSize, onPageChanged, users, forChat=false, \r\n                                                                                            setSelectedForChatUsers, setSelectedForChatUser,  chatUsersIds,\r\n    selectedForChatUsers, styleForUsers, styleForUser , ...props}) => {\r\n        // console.log('Users for ForChatUser')\r\n        // console.log(chatUsersIds)\r\n        // debugger\r\n    return <div>\r\n        <Paginator currentPage={currentPage} onPageChanged={onPageChanged}\r\n                   totalItemsCount={totalUsersCount} pageSize={pageSize}/>\r\n        <div>\r\n            {\r\n                users.map(u => forChat ? <ForChatUser user={u}\r\n\r\n                                    setSelectedForChatUsers ={setSelectedForChatUsers} // can be undef if it member adding\r\n                                    setSelectedForChatUser={setSelectedForChatUser}\r\n                                    selectedForChatUsers={selectedForChatUsers} // can be undef if it member adding\r\n                                    styleForUser= {styleForUser}\r\n                                    chatUsersIds = {chatUsersIds}\r\n\r\n                                    // toogleFocuseElemArr={props.toogleFocuseElemArr}\r\n                                    // usersForChatShow={props.usersForChatShow} \r\n                                    // setUsersForChatShow={props.setUsersForChatShow}\r\n                                    fWAUFC={props.fWAUFC}\r\n                                    clearCurrentFocusedWindow={props.clearCurrentFocusedWindow}\r\n\r\n\r\n\r\n                                     key={u.id}/>                 \r\n                                     :\r\n                                     <User user={u}\r\n                                     followingInProgress={props.followingInProgress}\r\n                                     key={u.id}\r\n                                     unfollow={props.unfollow}\r\n                                     follow={props.follow}/>  \r\n                )\r\n            }\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default Users;","import { createSelector } from \"reselect\";\r\nimport replaceQuotes from \"../components/common/utils/quotes\";\r\n\r\nexport const getUsersPrimitiveSelector = state => {\r\n    return  state.usersPage.users;//.filter(u => true);\r\n}\r\n\r\n// export const getUsersSelector = state => {\r\n//     return getUsers().filter(u => true);\r\n// }\r\n\r\n// we dont need to backupQuotes cause we cant edit other users profile pages\r\nexport const getUsers = createSelector( getUsersPrimitiveSelector, (users) => {\r\n    let k = users.map(u => ({...u, photos: replaceQuotes(u.photos)}))\r\n    // debugger\r\n    return k\r\n})\r\n\r\nexport const getQuery = state => {\r\n    return state.usersPage.query;\r\n}\r\n\r\nexport const getPageSize = state => {\r\n    return  state.usersPage.pageSize;\r\n}\r\n\r\nexport const getTotalUsersCount = state => {\r\n    return  state.usersPage.totalUsersCount;\r\n}\r\n\r\n\r\nexport const getCurrentPage = state => {\r\n    return  state.usersPage.currentPage;\r\n}\r\n\r\n\r\nexport const getIsFetching = state => {\r\n    return  state.usersPage.isFetching;\r\n}\r\n\r\n\r\nexport const getFollowingInProgress = state => {\r\n    return  state.usersPage.followingInProgress;\r\n}\r\n\r\n\r\n// export const getUsersSuperSelector2 = createSelector( getUsers, getIsFetching, (users, isFetching) => {\r\n//     return users.filter(u => true);\r\n// })\r\n","import React from 'react';\r\nimport { createField, Input } from '../common/FormsControls/FormsControls';\r\nimport { reduxForm } from 'redux-form';\r\nimport { maxLength50 } from '../../utils/validators/validators';\r\nimport styles from '../common/FormsControls/FormsControls.module.css'\r\nimport { searchUsers , setQuery} from '../../redux/users-reducer';\r\nimport { connect } from 'react-redux';\r\nimport {getCurrentPage, getQuery} from \"../../redux/users-selectors\";\r\n\r\nconst UsersSearchForm = props => {\r\n    const { handleSubmit, pristine, reset, submitting, error, query } = props\r\n    return (\r\n        <form onSubmit={handleSubmit}>\r\n            {createField(query, \"search\", Input, [maxLength50], {defaultValue: query})}\r\n            {\r\n            error && \r\n            <div className={styles.formSummaryError}>\r\n                {error}\r\n            </div>\r\n            }\r\n            <div className=''>\r\n                <button type='submit' disabled={pristine || submitting} >Run</button>\r\n            </div>\r\n            <div className=''>\r\n                <button type='button' disabled={pristine || submitting} onClick={reset}>Clear Values</button>\r\n            </div>\r\n        </form>\r\n    )\r\n}\r\n\r\nconst UsersSearchReduxForm = reduxForm({form:'UsersSearch'})(UsersSearchForm)\r\n\r\nconst UsersSearch = (props) => {\r\n    const onSubmit = (formData) => {\r\n        props.setQuery(formData.search)\r\n        props.searchUsers(props.currentPage, formData.search)\r\n    }\r\n    // if(props.isAuth) return (<Redirect to='/profile'/>)\r\n\r\n    return (<>\r\n        <div className=''>\r\n            <label htmlFor=\"\">SEARCH: </label><UsersSearchReduxForm onSubmit={onSubmit} query={props.query}/>\r\n        </div>\r\n        </>)\r\n}\r\n\r\nconst mapStateToProps = (state) => ({\r\n    currentPage: getCurrentPage(state),\r\n    query: getQuery(state),\r\n});\r\n\r\n\r\nexport default connect(mapStateToProps, {searchUsers, setQuery})(UsersSearch);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport {\r\n    follow,\r\n    setCurrentPage,\r\n    unfollow, toggleFollowingProgress, requestUsers, searchUsers\r\n} from '../../redux/users-reducer';\r\nimport Users from './Users';\r\nimport Preloader from \"../common/Preloader/Preloader\";\r\nimport { compose } from \"redux\";\r\nimport {\r\n    getCurrentPage,\r\n    getFollowingInProgress,\r\n    getIsFetching,\r\n    getPageSize,\r\n    getTotalUsersCount, getUsers, getQuery\r\n} from \"../../redux/users-selectors\";\r\nimport UsersSearch from './UsersSearch';\r\n\r\nimport { useUsersEffects } from '../../customHooks/usersHooks';\r\n\r\n\r\n// export function useQuering(isWithQuery){\r\n//     const [queried, setQueried] = useState(null)\r\n//     useEffect(()=>{\r\n//         setQueried(isWithQuery)\r\n//     },[isWithQuery])\r\n//     return queried\r\n// }\r\n\r\n// chatUsersIds // filter list\r\n// onClick={() => {props.toogleFocuseElem(props.setUsersForChatShow, props.usersForChatShow);onSubmit();}} // blur memberlist -> send to api request\r\n\r\n\r\n\r\nconst UsersContainer = (props) => {\r\n    // const queried = useQuering(false)\r\n    // const [query, setQuery] = useState('')\r\n    // const { currentPage, pageSize } = props;\r\n    const [onPageChanged] = useUsersEffects(props.getUsers, props.searchUsers, props.query, props.currentPage, props.pageSize)\r\n\r\n    // debugger\r\n    // console.log(props.chatUsersIds)\r\n\r\n    return (<div className={props.styleForUsers ? props.styleForUsers: ''}>\r\n        {props.isFetching ? <Preloader /> : null}\r\n        <div >\r\n            <UsersSearch/>\r\n        </div>\r\n        { props.fWUFCID === 0 ? \r\n        //props.forChat && props.setSelectedForChatUsers ?  \r\n        \r\n        \r\n        // <a onClick={props.toogleFocuseElem(props.setUsersForChatShow, props.usersForChatShow)}>\r\n        //     End Selection\r\n        // </a>\r\n        <a onClick={ () =>  props.clearCurrentFocusedWindow(props.fWUFCID) }>\r\n            End Selection\r\n        </a>\r\n        : null}\r\n        \r\n        <Users \r\n        \r\n            totalUsersCount={props.totalUsersCount}\r\n            pageSize={props.pageSize}\r\n            currentPage={props.currentPage}\r\n            onPageChanged={onPageChanged}\r\n            users={props.users}\r\n            follow={props.follow}\r\n            unfollow={props.unfollow}\r\n            followingInProgress={props.followingInProgress}\r\n\r\n\r\n            forChat = {props.forChat}\r\n\r\n\r\n            setSelectedForChatUsers = {props.setSelectedForChatUsers} // can be undef if it member adding\r\n            setSelectedForChatUser = {props.setSelectedForChatUser} // can be undef if it chat creation\r\n            chatUsersIds = {props.chatUsersIds} // can be undef if it chat creation\r\n\r\n            // toogleFocuseElemArr={props.toogleFocuseElemArr}\r\n            // usersForChatShow={props.usersForChatShow} \r\n\r\n            \r\n            // setUsersForChatShow={props.setUsersForChatShow} // can be undef if it chat creation\r\n            fWAUFC={props.fWAUFC}\r\n            clearCurrentFocusedWindow={props.clearCurrentFocusedWindow}\r\n\r\n\r\n            selectedForChatUsers={props.selectedForChatUsers} // can be undef if it member adding\r\n            styleForUsers= {props.styleForUsers}\r\n            styleForUser={props.styleForUser}\r\n        />\r\n    </div>)\r\n}\r\n\r\n\r\nlet mapStateToProps = (state) => {\r\n    return {\r\n        users: getUsers(state),\r\n        pageSize: getPageSize(state),\r\n        totalUsersCount: getTotalUsersCount(state),\r\n        currentPage: getCurrentPage(state),\r\n        isFetching: getIsFetching(state),\r\n        followingInProgress: getFollowingInProgress(state),\r\n        query: getQuery(state),\r\n    }\r\n}\r\n\r\n\r\nexport default compose(\r\n    connect(mapStateToProps, { follow, unfollow, setCurrentPage, toggleFollowingProgress, getUsers: requestUsers, searchUsers })\r\n)(UsersContainer)\r\n\r\n// class UsersContainer extends React.Component {\r\n\r\n//     getValidToken(){\r\n//         // console.log(`props token ${this.props.token}`);\r\n//         // console.log(`props ${this.props}`);\r\n//         return {\r\n//             headers: {\r\n//                 'Authorization': 'Bearer ' + this.props.token\r\n//               }\r\n//             }\r\n//     }\r\n\r\n//     // setValidToken(){\r\n\r\n//     // }\r\n\r\n//     componentDidMount() {\r\n//         if(this.props.token === null){\r\n//             return\r\n//         }\r\n//         // console.log(`props token ${this.props.token}`);\r\n//         // console.log(`props ${this.props}`);\r\n//         console.log('Im inside the DOM');\r\n//         console.log(`${this.props.token}`);\r\n//         // console.log(`\\ngetValidToken\\n${this.props.token}`);\r\n//         this.props.toggleIsFetching(true);\r\n//         // 'https://social-network.samuraijs.com/api/1.0/users'\r\n//         Axios.get(`http://127.0.0.1:8000/api/users?page=${this.props.currentPage}&limit=${this.props.pageSize}`, this.getValidToken()).then(response => {\r\n\r\n//             // console.log(response.data.data.items);\r\n//             // debugger;\r\n//             //response.data -- all json data\r\n//             // response.data.data -- data from json string\r\n//             // response.data.data.items -- data element to watch all users like in a list\r\n//             response.data.users.items = response.data.users.items.map(user => ({...user, photos:replaceQuotes(user.photos)}))\r\n//             // console.log(response.data);\r\n//             this.props.setUsers(response.data.users.items)\r\n//             // console.log(this.props.users);\r\n//             this.props.toggleIsFetching(false);\r\n//             // console.log(response.data.data.totalCount);\r\n//             this.props.setTotalUsersCount(response.data.users.totalCount)\r\n//         }).catch(function (error) {\r\n//             console.log(error);\r\n//         });\r\n//     }\r\n\r\n//     componentDidUpdate() {\r\n//         // console.log('Im update the DOM');\r\n//         // console.log(`${this.props.token}`);\r\n//     }\r\n\r\n//     onPageChanged = (page) => {\r\n//         console.log(`${this.props.token}`);\r\n\r\n//         this.props.setCurrentPage(page);\r\n//         this.props.toggleIsFetching(true);\r\n//         Axios.get(`http://127.0.0.1:8000/api/users?page=${page}&limit=${this.props.pageSize}`, this.getValidToken()).then(response => {\r\n//             // console.log(response.data.users.items);\r\n//             // debugger;\r\n//             response.data.users.items = response.data.users.items.map(user => ({...user, photos:replaceQuotes(user.photos)}))\r\n//             this.props.setUsers(response.data.users.items)\r\n//             this.props.toggleIsFetching(false);\r\n//         }).catch(function (error) {\r\n//             console.log(error);\r\n//         });\r\n//     }\r\n\r\n//     render() {\r\n//         if(this.props.token === null){\r\n//             return <Redirect to='/login'/>\r\n//         }\r\n\r\n//         return (<>\r\n//         {this.props.isFetching ? <Preloader /> : null}\r\n//         <Users totalUsersCount={this.props.totalUsersCount}\r\n//         pageSize={this.props.pageSize}\r\n//         currentPage={this.props.currentPage}\r\n//         users={this.props.users}\r\n//         onPageChanged={this.onPageChanged}\r\n//         follow={this.props.follow}\r\n//         unfollow={this.props.unfollow}\r\n\r\n//         token={this.props.token}\r\n//         userId={this.props.userId}\r\n\r\n//         />\r\n//         </>)\r\n//     }\r\n\r\n// }\r\n\r\n// const mapStateToProps = (state) => ({\r\n//         users: state.usersPage.users,\r\n//         pageSize: state.usersPage.pageSize,\r\n//         totalUsersCount: state.usersPage.totalUsersCount,\r\n//         currentPage: state.usersPage.currentPage,\r\n//         isFetching: state.usersPage.isFetching,\r\n//         // for fixing followed error (UNauthorized user because of lack token)\r\n//         // selfUserId: state.profilePage.selfUserId,\r\n//         // token: state.profilePage.token,\r\n//         // newPostText: state.profilePage.newPostText\r\n\r\n//         token: state.auth.token,\r\n//         userId: state.auth.userId,\r\n// });\r\n\r\n// const mapDispatchToProps = (dispatch) => {\r\n\r\n    // return {\r\n    //     follow: (userId) => {\r\n    //         dispatch(followAC(userId));\r\n    //     },\r\n    //     unfollow: (userId) => {\r\n    //         dispatch(unfollowAC(userId));\r\n    //     },\r\n    //     setUsers: (users) => {\r\n    //         dispatch(setUsersAC(users));\r\n    //     },\r\n    //     setCurrentPage: (currentPage) => {\r\n    //         dispatch(setCurrentPageAC(currentPage));\r\n    //     },\r\n    //     setTotalUsersCount: (totalUsersCount) => {\r\n    //         dispatch(setTotalUsersCountAC(totalUsersCount));\r\n    //     },\r\n    //     toggleIsFetching: (IsFetching) => {\r\n    //         dispatch(toggleIsFetchingAC(IsFetching));\r\n    //     }\r\n    // }\r\n// }\r\n\r\n\r\n// export default connect(mapStateToProps,\r\n//     {follow, unfollow, setUsers, setCurrentPage, setTotalUsersCount, toggleIsFetching})(UsersContainer);\r\n\r\n// export default UsersContainer;","import { useEffect } from \"react\";\r\nexport const useUsersEffects = (getUsers, searchUsers, query, currentPage, pageSize) => {\r\n    useEffect(() => {\r\n        query==='' ? getUsers(currentPage, pageSize) : searchUsers(currentPage, query);\r\n    }, [currentPage])\r\n\r\n    const onPageChanged = (pageNumber) => {\r\n        query==='' ? getUsers(pageNumber, pageSize) : searchUsers(pageNumber, query);\r\n    }\r\n    return [onPageChanged]\r\n}","/* eslint-disable jsx-a11y/alt-text */\r\n/* eslint-disable jsx-a11y/anchor-is-valid */\r\n\r\nimport React from 'react';\r\nimport s from './../Chats.module.css';\r\nimport styleMessages from './../Message/Message.module.css';\r\nimport { NavLink } from \"react-router-dom\";\r\nimport { convertTime } from '../../common/utils/convertTime';\r\nimport Preloader from '../../common/Preloader/Preloader';\r\nimport { ReduxFormSnippet, createField, Input, DropDownSelect } from '../../common/FormsControls/FormsControls';\r\nimport { maxLength200, maxLength1000 } from '../../../utils/validators/validators';\r\nimport { reduxForm } from 'redux-form';\r\nimport backupQuotes from '../../common/utils/backupQuotes';\r\nimport { useState } from 'react';\r\nimport UsersContainer from '../../Users/UsersContainer';\r\n// import { useUserSelector } from '../ChatsContainer';\r\n\r\n\r\n////////////////////\r\n// const AddChatMemberForm = (props) => {\r\n//     const { handleSubmit, pristine, reset, submitting, error, snusers, chatUsersIds, msgStyle } = props // chatUsersIds - list of ids from chat members\r\n//     // console.log(props)\r\n//     return (\r\n//         <form onSubmit={handleSubmit} className={`${msgStyle} ${s.addBorder}`}>\r\n//         {createField('DropDownSelect', 'dropDownSelect', DropDownSelect, null, {people:  snusers.filter(snuser => !chatUsersIds.includes(snuser.userId))})}\r\n//         <ReduxFormSnippet  pristine={pristine} reset={reset} submitting={submitting} error={error} sumbitButtonName={'Add Member'}/>\r\n//         </form>\r\n//     )\r\n// }\r\n\r\n// const AddChatMemberFormRedux = reduxForm({form: 'addChatMember'})(AddChatMemberForm)\r\n\r\n// export const AddChatMember = ({addMember, chatTypeId, chatId, snusers, chatUsersIds, msgStyle=''}) => {\r\n//     const onSubmit = (formData) => {\r\n//         addMember(chatTypeId, chatId, formData['dropDownSelect'])\r\n//     }\r\n//     return  <AddChatMemberFormRedux onSubmit={onSubmit} snusers={snusers} chatUsersIds={chatUsersIds} msgStyle={msgStyle}/>\r\n// }\r\n////////////////////\r\n\r\n//////////////////// styleMessages.chatsSettingsItemForm\r\n\r\nconst ChangeChatPhotoForm = (props) => {\r\n    const { handleSubmit, pristine, reset, submitting, error, msgStyle } = props\r\n    return ( // className={s.changeChatPhotoForm} chatsSettingsItem\r\n        <form onSubmit={handleSubmit} className={`${msgStyle} ${s.addBorder}`}>\r\n            {createField('Photo', 'photo', Input, [maxLength1000])}\r\n            <ReduxFormSnippet  pristine={pristine} reset={reset} submitting={submitting} error={error} sumbitButtonName={'Change Photo'}/>\r\n        </form>\r\n    )\r\n}\r\n\r\nconst ChangeChatPhotoFormRedux = reduxForm({form: 'chageChatPhoto'})(ChangeChatPhotoForm)\r\n\r\n\r\nexport const ChangeChatPhoto = ({setChatPhotoRequest, chatTypeId, chatId, msgStyle=''}) => {\r\n    const onSubmit = (formData) => { // or JSON.stringify\r\n        let newPhotoObject = backupQuotes({'large': null, 'small': formData['photo']})\r\n        setChatPhotoRequest(chatTypeId, chatId, newPhotoObject)\r\n    }\r\n    return  <ChangeChatPhotoFormRedux onSubmit={onSubmit} msgStyle={msgStyle}/>\r\n}\r\n////////////////////\r\n\r\n//////////////////// {styleMessages.chatsSettingsItem}\r\nconst RenameChatForm = (props) => {\r\n    const { handleSubmit, pristine, reset, submitting, error, msgStyle } = props\r\n    // let msgStyle = styleMessageClass ? styleMessages.chatsSettingsItemForm : ''\r\n    return ( // className={s.renameChatForm}\r\n        <form onSubmit={handleSubmit} className={`${msgStyle} ${s.addBorder}`}>\r\n            {createField('Name', 'name', Input, [maxLength200])}\r\n            <ReduxFormSnippet  pristine={pristine} reset={reset} submitting={submitting} error={error} sumbitButtonName={'Rename Chat'}/>\r\n        </form>\r\n    )\r\n}\r\n\r\nconst RenameChatFormRedux = reduxForm({form: 'renameChat'})(RenameChatForm)\r\n\r\nexport const RenameChat = ({renameChatRequest, chatTypeId, chatId, msgStyle=''}) => {\r\n    const onSubmit = (formData) => {\r\n        renameChatRequest(chatTypeId, chatId, formData['name'])\r\n    }\r\n    return  <RenameChatFormRedux onSubmit={onSubmit} msgStyle={msgStyle}/>\r\n}\r\n////////////////////\r\n\r\n// setMembersShow(event);\r\nexport const Member = ({ member, memberStyle, chatMemberSettings=null, setMemberOperShow=null, setSelectedMember=null }) => {\r\n    return (\r\n        <>\r\n        <div className={memberStyle}>\r\n            <NavLink to={'/profile/' + member.id}>\r\n                <div className={s.memberName}>{member.name}</div>\r\n                <div className={s.memberPhoto}><img src={member.photos.small} alt='Ava' /></div>\r\n            </NavLink>\r\n            {chatMemberSettings ? <a className={chatMemberSettings} onClick={(event) => {setSelectedMember(member.id); setMemberOperShow(event)}}>Operations</a>: null}\r\n        </div>\r\n        {/* <br/> */}\r\n        </>\r\n    )\r\n}\r\n\r\n\r\n\r\nexport const Members = ({members, membersShow, memberOperShow, selectedMember, memberOpers}) => { // <Member />\r\n    \r\n    return(\r\n        <>\r\n\r\n        <div className={membersShow ? styleMessages.chatsMembersActive : styleMessages.chatsMembers}>\r\n            <div className={membersShow ? styleMessages.chatsMembersActive : styleMessages.chatsMembers}>{members}</div>\r\n        </div>\r\n        \r\n        <div className={memberOperShow ? `${styleMessages.smthElseListActive}`: `${s.smthElseList}`}>\r\n            \r\n            {memberOpers.map(memberOper => \r\n                <div className={`${styleMessages.subElemMSBs} ${styleMessages.infoItemMSBs}`}>\r\n                    <a className={`${styleMessages.membOperLink}`} onClick={memberOper.method(selectedMember)}>{memberOper.name}</a>\r\n                </div>\r\n            )}\r\n        </div>\r\n        </>\r\n    )\r\n}\r\n\r\n\r\nexport const SelectMemberToChat = (props) => {\r\n\r\n    const onSubmit = (selectedForChatUser) => {\r\n        console.log('pre api')\r\n        props.addMember(props.chatTypeId, props.chatId, selectedForChatUser)\r\n    }\r\n\r\n    return (\r\n        <div  className={s.getMemberList} onClick={(event)=>{event.stopPropagation();}}>\r\n        <UsersContainer\r\n        setSelectedForChatUser = {onSubmit} \r\n        forChat={true} \r\n        styleForUsers={styleMessages.usersForChatActive} \r\n        styleForUser={styleMessages.userForChat}\r\n        fWAUFC={props.fWAUFC}\r\n        clearCurrentFocusedWindow={props.clearCurrentFocusedWindow}\r\n        // setUsersForChatShow={setUserForChatShow}\r\n        // toogleFocuseElemArr={toogleFocuseElemArr} //    -  \r\n        chatUsersIds={props.chatUsersIds}  \r\n        />\r\n      </div>\r\n    )\r\n}\r\n\r\n\r\nconst LastMessage = ({ sended, body, authorName }) => {\r\n    return (\r\n        <>\r\n            <div className={s.chatLMAuthorName}>{authorName} </div>\r\n            <div className={s.chatLMAuthorNameDotted}>:</div>\r\n            {/* <div className={s.chatLMBody}>{body.length > 30 ? `${ body.slice(0,27)}...`: body}</div>\r\n             */}\r\n                <div className={s.chatLMBody}>{body}</div>\r\n            <div className={s.chatLMSended}>{convertTime(sended)}</div>\r\n        </>\r\n    )\r\n}\r\n\r\n\r\nconst ChatItem = ({ lastMessage, getCountOfNewGlobalMsgs, members, chatType, name, setCurrentChatData, chatTypeId, chatId, chatPhotoSmall, isFetching, \r\n                    clearChatMyLocal, clearChatMyGlobal, clearChatAllLocal, clearChatAllGlobal,\r\n                    renameChatRequest, deleteChatRequest, addMember, setChatPhotoRequest,\r\n                    ...props  \r\n                }) => {\r\n\r\n\r\n    const unmout = () => {\r\n        setCurrentChatData(chatTypeId, chatId)\r\n    }\r\n\r\n    const clearChatByMethod = (method) => {\r\n        // debugger\r\n        method(chatTypeId, chatId)\r\n    }\r\n\r\n    // const putChatByMethod = (method, putData) => {\r\n    //     method(chatTypeId, chatId, putData)\r\n    // }\r\n\r\n    let path = `/chats/${chatType}/${name}/`\r\n    let chatUsersIds = members.map(member => member.id)\r\n    members = members.map(member => <Member member={member} key={member.id} memberStyle={`${s.member} ${s.subElem2}`} />)\r\n    if(isFetching) return <Preloader />\r\n    // console.log(userForChatShow)\r\n    \r\n    return (\r\n        <>\r\n        {\r\n        // add member\r\n        props.fWAUFC.data !== null && props.fWAUFC.data[1] === chatId && props.fWAUFC.data[0] === chatTypeId  &&\r\n            <div className={s.addMember}>\r\n                <div className={s.addMemberHeader}>\r\n                <SelectMemberToChat addMember={addMember} chatTypeId={chatTypeId} chatId={chatId} chatUsersIds={chatUsersIds}\r\n                    clearCurrentFocusedWindow={props.clearCurrentFocusedWindow} \r\n                    fWAUFC={props.fWAUFC}/>\r\n                 </div>\r\n            </div>\r\n                }\r\n\r\n\r\n\r\n\r\n        <div className={s.chatItem}>\r\n            <NavLink to={path} className={s.chatItemData} onClick={unmout}>\r\n                <div className={s.chatItemPhoto}>\r\n                    {/* <img src={(chatPhoto==='') ? (chatTypeId===0) ? members.find(member=>userId!==member.id).photos.small : 'chatPhoto' : chatPhoto} alt='chatPhoto'/> */}\r\n                    {chatPhotoSmall !== null ? <img src={chatPhotoSmall} /> : <div className=''>chatPhotoSmall</div>}\r\n                </div>\r\n                    {/* lastMessage: */}\r\n                    {Object.keys(lastMessage).length > 0 ? <LastMessage sended={lastMessage.sended} body={lastMessage.body} key={lastMessage.id} authorName={lastMessage.authorName} /> : null}\r\n                <div className={s.chatItemNewMsgsNum}>{getCountOfNewGlobalMsgs}</div>\r\n\r\n                <div className={s.chatItemName}>\r\n                    {name}\r\n                </div>\r\n            </NavLink>\r\n                <div className={s.chatSettings}>\r\n                Settings:\r\n                    <div className={s.chatSettingsHeader}>\r\n                        <div className={s.chatSettingsMembersListHeader}>\r\n                            members:\r\n                            <div className={s.chatSettingsMembersList}>\r\n                                {members}\r\n                            </div>\r\n                        </div>\r\n                        <div className={s.smthElseHeader} >\r\n                                clear chat:\r\n                                <div className={s.smthElseList}>\r\n                                        <div className={`${s.subElem} ${s.infoItem}`}><button onClick={() => clearChatByMethod(clearChatMyLocal)}>Clear My Messages Locally</button></div>\r\n                                        <div className={`${s.subElem} ${s.infoItem}`}><button onClick={() => clearChatByMethod(clearChatMyGlobal)}>Clear My Messages Globally</button></div>\r\n                                        <div className={`${s.subElem} ${s.infoItem}`}><button onClick={() => clearChatByMethod(clearChatAllLocal)}>Clear All Messages Locally</button></div>\r\n                                        <div className={`${s.subElem} ${s.infoItem}`}><button onClick={() => clearChatByMethod(clearChatAllGlobal)}>Clear All Messages Globally</button></div>\r\n                                </div>\r\n                        </div>\r\n                        <div className={s.renameChatHeader}>\r\n                            rename\r\n                            { chatTypeId === 1 && <div className={s.renameChatItem}>\r\n                                <RenameChat renameChatRequest={renameChatRequest} chatTypeId={chatTypeId} chatId={chatId}/>\r\n                            </div>}\r\n                            \r\n                        </div>\r\n                        <div className={s.smthElseHeader}>\r\n                            other operations\r\n                            <div className={s.smthElseList}>\r\n                                    <div className={`${s.subElem} ${s.infoItem}`}>\r\n                                        set photo\r\n                                        { chatTypeId === 1 && <div className={s.changePhotoChat}>\r\n                                            <ChangeChatPhoto setChatPhotoRequest={setChatPhotoRequest} chatTypeId={chatTypeId} chatId={chatId}/>\r\n                                        </div>}\r\n                                    </div>\r\n\r\n                                    <div className={`${s.subElem} ${s.infoItem}`}>\r\n                                        \r\n\r\n                                        \r\n                                    { chatTypeId === 1 &&\r\n                                    <div className={s.addMemberItem}>\r\n                                    { props.fWAUFC.data === null  && // make true from false to open element ( but i should push here userId and after by userId show itself user list)\r\n                                        <a \r\n                                        onClick={\r\n                                            (event) => (event.stopPropagation(), props.addFocusedWindow(props.fWAUFC.id, [chatTypeId, chatId]))\r\n                                         }> \r\n                                            Add Member\r\n                                        </a>\r\n                                    }\r\n                                    </div>\r\n                                    }\r\n                                    </div>\r\n\r\n                                    <div className={`${s.deleteChat} ${s.subElem} ${s.infoItem}`}><button onClick={() => clearChatByMethod(deleteChatRequest)}>DELETE CHAT</button></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n        </div> \r\n        </>)\r\n}\r\n\r\nexport default ChatItem;\r\n\r\n\r\n// chatItemMemberList -   (     (   ))","import { createSelector } from \"reselect\";\r\nimport replaceQuotes from \"../components/common/utils/quotes\";\r\n\r\n\r\nexport const selectChatsPrimitiveSelector = state => {\r\n    return  state.chatsPage.chats;//.filter(u => true);\r\n}\r\nexport const selectChats = createSelector( selectChatsPrimitiveSelector, (chats) => {\r\n        return chats.map(chat => ({...chat, members: chat.members.map(member => ({...member, photos: replaceQuotes(member.photos)})), chatPhoto: replaceQuotes(chat.chatPhoto)}))\r\n})\r\n\r\n\r\nexport const selectChatMessages = state => {\r\n    return  state.chatsPage.messages;//.filter(u => true);\r\n}\r\n\r\n\r\nexport const selectCTIPS = state => {\r\n    return state.chatsPage.chatTypeId;\r\n}\r\nexport const selectCIPS = state => {\r\n    return state.chatsPage.chatId;\r\n}\r\n\r\nexport const selectCurrentChatPS = state => {\r\n    return  state.chatsPage.currentChat\r\n}\r\n\r\nexport const selectCurrentChat = createSelector( selectCurrentChatPS, (chat) => {\r\n    return chat!==null ? {...chat, members: chat.members.map(member => ({...member, photos: replaceQuotes(member.photos)})), chatPhoto: replaceQuotes(chat.chatPhoto)} : null\r\n})\r\n\r\n\r\n\r\n\r\nexport const selectFocusedWindowsPS = state => {\r\n    return  state.app.focusedWindows;//.filter(u => true);\r\n}\r\nexport const selectFocusedWindowsIdsPS = state => {\r\n    return  state.app.focusedWindowsIds;//.filter(u => true);\r\n}\r\n\r\nexport const selectFocusedWindow = (windowIdKey) => createSelector( selectFocusedWindowsPS, selectFocusedWindowsIdsPS,  (focusedWindows, focusedWindowsIds) => {\r\n    // debugger\r\n    return focusedWindows.find(window => window.id === focusedWindowsIds[windowIdKey]) || {'id': focusedWindowsIds[windowIdKey], 'data': null} // {'id':, 'data'}\r\n})\r\n\r\nexport const selectFocusedWindowUsersForChat = selectFocusedWindow(\"fWUsersFCId\")\r\nexport const selectFocusedWindowAddUserForChat = selectFocusedWindow(\"fWAddUserFCId\")\r\nexport const selectFocusedWindowMembersForChat = selectFocusedWindow(\"fWMembersId\")\r\nexport const selectFocusedWindowMemberOperationsForChat = selectFocusedWindow(\"fWMemberOperationsId\")","// import {authAPI} from \"../api/api\";\r\nimport { getAuthUserData, setAuthUserData } from \"./auth-reducer\";\r\n\r\nconst INITIALIZED_SUCCESS = 'INITIALIZED_SUCCESS';\r\nconst ADD_FOCUSED_WINDOW = 'SET_FOCUSED_WINDOWS';\r\nconst CLEAR_FOCUSED_WINDOWS = 'CLEAR_FOCUSED_WINDOWS';\r\nconst CLEAR_CURRENT_FOCUSED_WINDOW = 'CLEAR_CURRENT_FOCUSED_WINDOW';\r\n\r\nlet initialState = {\r\n    initialized: false,\r\n    focusedWindows: [],\r\n    focusedWindowsIds: {fWUsersFCId: 0, fWAddUserFCId: 1, fWMembersId: 2, fWMemberOperationsId: 3}\r\n};\r\n\r\nconst appReducer = (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case INITIALIZED_SUCCESS:\r\n\r\n            return {\r\n                ...state,\r\n                initialized: true\r\n            }\r\n\r\n        case ADD_FOCUSED_WINDOW:\r\n\r\n            return {\r\n                ...state,\r\n                focusedWindows: [...state.focusedWindows, action.newFocusedWindow]\r\n            }\r\n\r\n        case CLEAR_FOCUSED_WINDOWS:\r\n            // debugger\r\n                return {\r\n                    ...state,\r\n                    focusedWindows: []\r\n                }\r\n        \r\n        case CLEAR_CURRENT_FOCUSED_WINDOW: \r\n            // debugger\r\n            return {\r\n                ...state,\r\n                focusedWindows: state.focusedWindows.filter(window=> window.id !== action.currentWindowId)\r\n            }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport const initializedSuccess = () => ({type: INITIALIZED_SUCCESS })\r\n\r\nexport const addFocusedWindow = (id, data) => ({type: ADD_FOCUSED_WINDOW, newFocusedWindow: {id: id, data: data} }) // id, data\r\nexport const clearAllFocusedWindows = () => ({type: CLEAR_FOCUSED_WINDOWS})\r\nexport const clearCurrentFocusedWindow = (currentWindowId) => ({type: CLEAR_CURRENT_FOCUSED_WINDOW, currentWindowId})\r\n\r\n\r\nexport const initializeApp = () => (dispatch) => {\r\n    // debugger \r\n    Promise.all([dispatch(getAuthUserData())])\r\n    .then( resolve => {\r\n        // debugger\r\n        // console.log('hui')\r\n        dispatch(initializedSuccess());\r\n    }).catch(error => \r\n        {\r\n            // debugger\r\n            if([\"Signature has expired.\", \"Error decoding signature.\", \"Invalid Authorization header. No credentials provided.\"].includes(error.response.data.detail)){\r\n                // console.log(error.response.data.detail)\r\n                // delete localStorage['token']\r\n                // dispatch(setAuthUserData(null, null, null, false, true))\r\n            } else {\r\n                console.log('its amaizing error - server error')\r\n            }\r\n            dispatch(initializedSuccess());\r\n            // dispatch(initializedSuccess());\r\n            // dispatch(getAuthUserData());\r\n        }\r\n        ).catch(error => {\r\n            console.log('you gonna die')\r\n            dispatch(initializedSuccess());\r\n        });\r\n    \r\n    // authAPI.me()\r\n    //     .then(response => {\r\n    //         if (response.data.resultCode === 0) {\r\n    //             let {id, login, email} = response.data.data;\r\n    //             dispatch(initializedSuccess());\r\n    //         }\r\n    //     });\r\n}\r\n\r\n\r\nexport default appReducer;","// import React from 'react';\r\n// import {sendMessageCreator, updateNewMessageBodyCreator} from \"../../redux/dialogs-reducer\";\r\n// import Dialogs from \"./Dialogs\";\r\n// import {connect} from \"react-redux\";\r\n// import { Redirect, withRouter } from 'react-router-dom';\r\n\r\n// class DialogsContainer extends React.Component {\r\n//     componentDidMount() {\r\n//         console.log('Im inside the DOM');\r\n//         console.log(`${this.props.token}`);\r\n//     }\r\n//     render() {\r\n//         if(this.props.token === null){\r\n//             return <Redirect to='/login'/>\r\n//         }\r\n//         return (\r\n//             <Dialogs {...this.props}/>\r\n//         )\r\n//     }\r\n// }\r\n\r\n// let mapStateToProps = (state) => {\r\n//     return {\r\n//         dialogsPage: state.dialogsPage,\r\n//         token: state.auth.token\r\n//     }\r\n// }\r\n// let mapDispatchToProps = (dispatch) => {\r\n//     return {\r\n//         sendMessage: () => {\r\n//             dispatch(sendMessageCreator());\r\n//         },\r\n//         updateNewMessageBody: (body) => {\r\n//             dispatch(updateNewMessageBodyCreator(body));\r\n//         }\r\n//     }\r\n// }\r\n\r\n// let WithURLDialogsContainer = withRouter(DialogsContainer);\r\n// // const DialogsContainer = \r\n// export default connect(mapStateToProps, mapDispatchToProps)(WithURLDialogsContainer);\r\n\r\n// // export default DialogsContainer;\r\n\r\n// eslint-disable react/jsx-no-duplicate-props\r\n/* eslint-disable jsx-a11y/anchor-is-valid */\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { compose } from 'redux';\r\nimport withAuthRedirect from '../../hoc/WithAuthRedirect';\r\nimport { connect } from 'react-redux';\r\nimport { setCurrentChatData, unSetCurrentChatData, getChats, \r\n        clearChatMyLocal, clearChatMyGlobal, clearChatAllLocal, clearChatAllGlobal, createConversation, createDialog, \r\n        // requestUsersForChat, \r\n        renameChatRequest, setChatPhotoRequest, addMember, deleteChatRequest } from '../../redux/chats-reducer';\r\nimport Preloader from '../common/Preloader/Preloader';\r\nimport ChatItem from './ChatItem/ChatItem';\r\nimport chatsStyles from './Chats.module.css';\r\nimport { selectChats, selectFocusedWindowUsersForChat, selectFocusedWindowAddUserForChat, selectFocusedWindowMembersForChat, selectFocusedWindowMemberOperationsForChat } from '../../redux/chats-selector';\r\n\r\nimport { withRouter } from 'react-router-dom';\r\nimport { reduxForm, formValues } from 'redux-form';\r\nimport { createField, Input, ReduxFormSnippet } from '../common/FormsControls/FormsControls';\r\nimport { maxLength200 } from '../../utils/validators/validators';\r\n \r\nimport styleMessages from './Message/Message.module.css';\r\nimport UsersContainer from '../Users/UsersContainer';\r\nimport { useRefactorPopUp } from '../../customHooks/focusedElems';\r\nimport { clearCurrentFocusedWindow, addFocusedWindow } from '../../redux/app-reducer';\r\n\r\n\r\nconst CreateChatForm = (props) => {\r\n    const { handleSubmit, pristine, reset, submitting, error} = props\r\n    // const MyItemizedList = [19, 20]\r\n    // const ItemList = formValues('selectedMembers')(MyItemizedList)\r\n    // const [selected, setSelected] = useState([]);\r\n    // // snusers, myUserId\r\n    // const options = snusers\r\n    //                 .filter(snuser => snuser.userId !== myUserId)\r\n    //                 .map(snuser => ({label: snuser.name, value: snuser.id}))\r\n    return (\r\n        <form onSubmit={handleSubmit} className={chatsStyles.createChatForm}>\r\n            {/* {createField('DropDownSelect', 'dropDownSelect', DropDownSelect, null, {people: snusers.filter(snuser => snuser.userId !== myUserId)})} */}\r\n            \r\n            {/* {createField('SelectedMembers', 'selectedMembers', MultiSelectWrap, null, \r\n                { optionsMS: options, \r\n                    valueMS:selected, \r\n                    onChangeMS:setSelected, \r\n                    labelledByMS:\"Select\"  })} */}\r\n            {/* {createField('SelectedMembers', 'selectedMembers', ForChatUsersListWrap, null)} */}\r\n            \r\n            {createField('Name', 'name', Input, [maxLength200])}\r\n            <ReduxFormSnippet  pristine={pristine} reset={reset} submitting={submitting} error={error} sumbitButtonName={'Create Chat'}/>\r\n        </form>\r\n    )\r\n}\r\n\r\n\r\nconst CreateChatReduxForm = reduxForm({form:'CreateChat'})(CreateChatForm)\r\n\r\n\r\n\r\n \r\nexport const useUsersSelector = (callbackMethod, keys=[]) => { // ['name'] // props.createConversation\r\n    const [selectedForChatUsers, setSelectedForChatUsers] = useState([])\r\n\r\n    const onSubmit = (formData) => { // keys = ['name', 'photos']\r\n        // debugger\r\n        // let sns = Array.isArray(formData['dropDownSelect']) ? formData['dropDownSelect']: [formData['dropDownSelect']]\r\n        // let sns = Array.isArray(selectedForChatUsers) ? selectedForChatUsers: selectedForChatUsers\r\n        callbackMethod(selectedForChatUsers, ...keys.map(key=>formData[key])) // if select for create chat -> keys are not null - else null (fro add member to chat)\r\n    }\r\n    return [selectedForChatUsers, setSelectedForChatUsers, onSubmit]\r\n\r\n}\r\n\r\n// export const useUserSelector = (chatTypeId, chatId, callbackMethod) => { //props.addMember\r\n//     const [selectedForChatUser, setSelectedForChatUser] = useState(null)\r\n//     const onSubmit = async() => {\r\n//         console.log('pre api')\r\n//         await callbackMethod(chatTypeId, chatId, selectedForChatUser)\r\n//     }\r\n\r\n//     // useEffect(() => {\r\n//     //     if(selectedForChatUser!==null){\r\n//     //         console.log(\"adding\")\r\n//     //         onSubmit()\r\n//     //         setSelectedForChatUser(null) \r\n//     //     } else {\r\n//     //         console.log(\" notadding\")\r\n//     //     }\r\n//     // }, [selectedForChatUser])\r\n//     return [setSelectedForChatUser ]\r\n// }\r\n\r\n\r\n\r\nconst ChatsContainer = (props) => {\r\n    const [iF, setIF]= useState(true) // isFetching\r\n    // const [iF2, setIF2]= useState(true) // isFetching\r\n    const [selectedForChatUsers, setSelectedForChatUsers, onSubmit] = useUsersSelector(props.createConversation, ['name'])\r\n\r\n    const refreshData = () => {\r\n        // if (!iF2) {\r\n        console.log('start refresh')\r\n        setTimeout(async() =>{await props.getChats()}, 5000) //                 \r\n        console.log('end refresh')\r\n        // }\r\n    }\r\n\r\n    useEffect(() => {\r\n        const fetchData = async() => {\r\n            if(iF){\r\n                props.unSetCurrentChatData()\r\n                await props.getChats()\r\n                setIF(false)\r\n            }\r\n            // if(iF2){\r\n            //     await props.requestUsersForChat()\r\n            //     setIF2(false)\r\n            // }\r\n        }\r\n        fetchData();\r\n    }, [props, iF])//, iF2])\r\n\r\n    useEffect(() => {\r\n        refreshData();\r\n        console.log('effect refresh used by changing: ')\r\n    }, [props])\r\n\r\n\r\n    // if(iF || iF2) return <Preloader/>\r\n    if(iF) return <Preloader/>\r\n    // key `${chat.chatType}_${chat.name}`\r\n    // let chatsElements = [...(props.chats.filter(chat => !('sended' in chat.lastMessage))).sort((a,b)=>b.chatId - a.chatId), ...props.chats\r\n    //         .filter(chat => 'sended' in chat.lastMessage) // if this is the chat with existing msgs within\r\n    //         .sort((chat1, chat2)=> (chat2.lastMessage.sended - chat1.lastMessage.sended))]\r\n    let chatsElements = props.chats\r\n            .map(chat => <ChatItem lastMessage={chat.lastMessage} \r\n                getCountOfNewGlobalMsgs={chat.getCountOfNewGlobalMsgs} \r\n                members={chat.members} name={chat.name} \r\n                chatType={chat.chatType} chatId={chat.chatId} \r\n                chatTypeId={chat.chatTypeId} key={chat.id}\r\n                setCurrentChatData={props.setCurrentChatData}\r\n                chatPhotoSmall = {chat.chatPhoto.small} \r\n                isFetching={props.isFetching} \r\n                // currentChatDataFetching={props.currentChatDataFetching} \r\n                clearChatMyLocal={props.clearChatMyLocal} clearChatMyGlobal={props.clearChatMyGlobal} clearChatAllLocal={props.clearChatAllLocal} clearChatAllGlobal={props.clearChatAllGlobal}\r\n                renameChatRequest={props.renameChatRequest}\r\n                setChatPhotoRequest={props.setChatPhotoRequest}\r\n                addMember={props.addMember}\r\n                // snusers={props.OLDsnusers}\r\n                deleteChatRequest={props.deleteChatRequest}\r\n\r\n                fWAUFC={props.fWAUFC}\r\n                clearCurrentFocusedWindow={props.clearCurrentFocusedWindow}\r\n                addFocusedWindow={props.addFocusedWindow}\r\n\r\n                />);\r\n \r\n\r\n    return(\r\n        <>\r\n        <div className={chatsStyles.chats}>\r\n            <div className={chatsStyles.chats_header}>Chats</div>\r\n            <div className={chatsStyles.createChat}>\r\n            <div className={chatsStyles.createChatHeader}>Create Conversation\r\n                {selectedForChatUsers.length > 1 && <CreateChatReduxForm onSubmit={onSubmit} snusers={props.snusers} myUserId={props.myUserId} /> }\r\n\r\n                {props.fWUFC.data !== null ?\r\n                    \r\n                    <div  className={chatsStyles.getMemberList} onClick={(event)=>{event.stopPropagation();}}>\r\n                        <UsersContainer\r\n\r\n                        setSelectedForChatUsers={setSelectedForChatUsers} forChat={true} \r\n                        selectedForChatUsers={selectedForChatUsers} \r\n                        styleForUsers={styleMessages.usersForChatActive} styleForUser={styleMessages.userForChat}\r\n                        clearCurrentFocusedWindow={props.clearCurrentFocusedWindow}\r\n                        fWUFCID = {props.fWUFC.id}\r\n                        toogleFocuseElem={props.toogleFocuseElem}\r\n\r\n                        />\r\n\r\n                        {selectedForChatUsers.length === 1 &&  \r\n                            <a onClick={() => {props.createDialog(selectedForChatUsers[0]); props.clearCurrentFocusedWindow(props.fWUFC.id); }}>Create Dialog</a>}\r\n                    </div>\r\n\r\n                :\r\n                 \r\n                    <a className={chatsStyles.getMemberList}  \r\n                    onClick={\r\n                        (event)=>{event.stopPropagation();\r\n                        props.addFocusedWindow(props.fWUFC.id, true);\r\n                    }}>\r\n                            Choose Users for Chat\r\n                    </a>\r\n\r\n                }\r\n\r\n                {/* {props.usersForChatShow ? \r\n                <div  className={chatsStyles.getMemberList} onClick={(event)=>{event.stopPropagation();}}>\r\n                    <UsersContainer\r\n\r\n                    setSelectedForChatUsers={setSelectedForChatUsers} forChat={true} \r\n                    selectedForChatUsers={selectedForChatUsers} \r\n                    styleForUsers={styleMessages.usersForChatActive} styleForUser={styleMessages.userForChat}\r\n\r\n                    usersForChatShow={props.usersForChatShow}\r\n                    setUsersForChatShow={props.setUsersForChatShow}\r\n                    toogleFocuseElem={props.toogleFocuseElem}/>\r\n\r\n                    {selectedForChatUsers.length === 1 && <a onClick={() => {props.createDialog(selectedForChatUsers[0])}}>Create Dialog</a>}\r\n                    </div>\r\n                    // <div className={styleMessages.usersForChatActive}>\r\n                    :\r\n                    <a className={chatsStyles.getMemberList} \r\n                        onClick={props.toogleFocuseElem(props.setUsersForChatShow, props.usersForChatShow)}>\r\n                            Choose Users for Chat\r\n                    </a>\r\n                } */}\r\n\r\n\r\n\r\n            </div>\r\n            </div>\r\n                <div className={chatsStyles.chatsItems}>\r\n                    {chatsElements}\r\n                </div>\r\n        </div>\r\n        \r\n        </>\r\n    )\r\n}\r\n// can be lastMessage ={} if no msgs yet, \r\n\r\n\r\nlet mapStateToProps = (state) => ({\r\n    chats: selectChats(state),\r\n    isAuth: state.auth.isAuth,\r\n    isFetching: state.chatsPage.isFetching,\r\n    isUnmount: state.chatsPage.isUnmount,\r\n    myUserId: state.auth.userId,\r\n    OLDsnusers: state.chatsPage.usersToSelect, // -   )))))))) TODO   \r\n    // state.chatsPage.membersToSelect <- getUsers(page) (subs requestUsersForChat) TODO\r\n    // chatPhotoSmall: selectChatPhotoSmall(state)\r\n    // userId: state.auth.userId,\r\n    // id - data\r\n    fWUFC: selectFocusedWindowUsersForChat(state),\r\n    fWAUFC: selectFocusedWindowAddUserForChat(state),\r\n    fWMFC: selectFocusedWindowMembersForChat(state),\r\n    fWMOFC: selectFocusedWindowMemberOperationsForChat(state),\r\n\r\n\r\n})\r\n\r\nexport default compose(\r\n    withAuthRedirect,\r\n    connect(mapStateToProps, {getChats, setCurrentChatData, unSetCurrentChatData,\r\n        clearChatMyLocal, clearChatMyGlobal, clearChatAllLocal, clearChatAllGlobal,\r\n        createDialog, createConversation, \r\n        // requestUsersForChat,\r\n        renameChatRequest, addMember, setChatPhotoRequest, deleteChatRequest,\r\n\r\n        addFocusedWindow, clearCurrentFocusedWindow,\r\n    }),\r\n    withRouter\r\n)(ChatsContainer);\r\n\r\n\r\n//currentChatDataFetching\r\n","import {profileAPI, authAPI} from \"../api/api\";\r\nimport { stopSubmit } from \"redux-form\";\r\nimport replaceQuotes from \"../components/common/utils/quotes\";\r\nimport authReducer from \"./auth-reducer\";\r\n// import backupQuotes from \"../components/common/utils/backupQuotes\";\r\n// const ADD_POST = 'ADD-POST';\r\n// const UPDATE_NEW_POST_TEXT = 'UPDATE-NEW-POST-TEXT';\r\n// const SET_USER_PROFILE = 'SET_USER_PROFILE';\r\n// const SET_USER_JWTTOKEN = 'SET_USER_JWTTOKEN';\r\n// const SET_SELF_USER_ID = 'SET_SELF_USER_ID';\r\n\r\n\r\n// must be 8\r\nconst ADD_POST = 'ADD-POST';\r\nconst DELETE_POST = 'DELETE_POST';\r\n\r\nconst SET_USER_PROFILE = 'SET_USER_PROFILE';\r\nconst UPDATE_PROFILE = 'UPDATE_USER_PROFILE';\r\n// const DELETE_PROFILE = 'DELETE_USER_PROFILE';\r\n\r\nconst SET_STATUS = 'SET_STATUS';\r\nconst SET_PHOTO = 'SET_PHOTO';\r\n\r\nlet initialState = {\r\n    posts: [\r\n        {id: 1, message: 'Hi, how are you?', likesCount: 12},\r\n        {id: 2, message: 'It\\'s my first post', likesCount: 11},\r\n        {id: 3, message: 'Blabla', likesCount: 11},\r\n        {id: 4, message: 'Dada', likesCount: 11}\r\n    ],\r\n    // newPostText: 'it-kamasutra.com',\r\n    profile: null,\r\n    status: \"\"\r\n};\r\n\r\n\r\nconst profileReducer = (state = initialState, action) => {\r\n\r\n    switch(action.type) {\r\n        case ADD_POST: {\r\n            let newPost = {\r\n                id: 5,\r\n                message: action.newPostText,\r\n                likesCount: 0\r\n            };\r\n            return {\r\n                ...state,\r\n                posts: [...state.posts, newPost],\r\n            };\r\n        }\r\n        case DELETE_POST: {\r\n            return {...state, posts: state.posts.filter(p => p.id !== action.postId)}\r\n        }\r\n\r\n        case SET_USER_PROFILE: {\r\n            return {...state, profile: action.profile}\r\n        }\r\n        // when we update subobject - we just add other old subproperties that dont updated \r\n        case UPDATE_PROFILE: { //      (   ) -    ,       \r\n            return {...state,\r\n                    profile: \r\n                    {...state.profile,\r\n                    ...action.profileData,\r\n                    photos: {...state.profile.photos, ...action.profileData.photos},\r\n                    contacts: {...state.profile.contacts, ...action.profileData.contacts}\r\n                    }\r\n                }\r\n        }\r\n        // case DELETE_PROFILE: {\r\n        //     return {...state, posts: [], profile: null, status: ''}\r\n        // }\r\n\r\n        case SET_STATUS: {\r\n            // return {...state, status: action.status}\r\n            return {...state, profile: { ...state.profile, status: action.status} }\r\n        }\r\n        case SET_PHOTO: {\r\n            return {...state, profile: {...state.profile, photos: action.photos}}\r\n        }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\n\r\n// no API yet ( no likes api, no posts api, no polls api, no comments api)\r\nexport const addPost = (newPostText) => ({type: ADD_POST, newPostText})\r\nexport const deletePost = (postId) => ({type: DELETE_POST, postId})\r\n\r\n// no API hidden layer of action\r\nexport const setUserProfile = (profile) => ({type: SET_USER_PROFILE, profile})\r\nexport const setStatus = (status) => ({type: SET_STATUS, status})\r\nexport const setPhoto = (photos) => ({type: SET_PHOTO, photos})\r\nexport const setUpdateUserProfile = (profileData) => ({type: UPDATE_PROFILE, profileData})\r\n\r\n// API actions\r\nexport const getUserProfile = (userId) => async(dispatch) => {\r\n    // debugger\r\n    let response = await profileAPI.getProfile(userId)\r\n    if (response.data.resultCode === 0){\r\n        let profile = response.data.data;\r\n        profile.photos = replaceQuotes(profile.photos);\r\n        profile.contacts = replaceQuotes(profile.contacts);\r\n        dispatch(setUserProfile(profile));\r\n        // return response.data.data\r\n    }\r\n}\r\n\r\nexport const updateUserProfile = (profileData) => async(dispatch) => {\r\n    // debugger\r\n    // profileData = backupQuotes(profileData)\r\n    let response = await profileAPI.updateProfile(profileData)\r\n    if(response.data.resultCode === 0){\r\n        let profile = response.data.data\r\n        if('photos' in profile){\r\n            profile.photos = replaceQuotes(profile.photos);\r\n        }\r\n        if ('contacts' in profile){\r\n            profile.contacts = replaceQuotes(profile.contacts);\r\n        }\r\n        dispatch(setUpdateUserProfile(profile))\r\n    } else {\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        dispatch(stopSubmit(\"updateProfile\", {_error: message}));\r\n    }\r\n}\r\n// fields to change\r\n\r\n// \"name\",\r\n// \"status\",\r\n// \"photos\",\r\n// \"lookingForAJob\",\r\n// \"lookingForAJobDescription\",\r\n// \"fullname\",\r\n// \"contacts\"\r\n\r\n// export const setDeleteUserProfile = () => ({type: DELETE_PROFILE})\r\nexport const deleteUserProfile = () => async(dispatch) => {\r\n    let response = profileAPI.deleteProfile()\r\n    if(response.data.resultCode === 0){\r\n        dispatch(setUserProfile(null))\r\n        authReducer.logout()\r\n        // delete state data and token ????\r\n        // reidrect login???\r\n        // if profile === null -> rerender all and redirect login (solved)\r\n    } else {\r\n        //      ,           ,\r\n        // ,       \r\n        // (        ),     \r\n        let authResponse = await authAPI.me() \r\n        if(authResponse.data.resultCode !== 0){ //      -   -  \r\n            dispatch(setUserProfile(null))\r\n            authReducer.logout()\r\n        }\r\n    }\r\n}\r\n\r\n\r\n// export const getStatus = (userId) => async(dispatch) => {\r\n//     let response =  await profileAPI.getStatus(userId);\r\n//     if(response.data.resultCode === 0){\r\n//         dispatch(setStatus(response.data.data));\r\n//     } // if subs to redux-form  -> + stopSubmit\r\n// }\r\n\r\n// there is the only place we dont want to say the user that there is was an error in sataus update\r\nexport const updateStatus = (status) => async(dispatch) => {\r\n    let response =  await profileAPI.updateStatus(status); //          \r\n    console.log(response);\r\n    if( response.data.resultCode === 0 ){\r\n        dispatch(setStatus(status));\r\n    }\r\n}\r\n\r\nexport const updatePhoto = (photo) => async(dispatch) => {\r\n    let response =  await profileAPI.updatePhoto(photo);\r\n    if( response.data.resultCode === 0 ){\r\n        dispatch(setPhoto(photo));\r\n    } else {\r\n        let message = response.data.messages.length  ? response.data.messages[0] : 'Some error';\r\n        dispatch(stopSubmit(\"updatePhoto\", {_error: message}));\r\n    }\r\n}\r\n\r\n\r\n\r\n// export const setUserJWTToken = (token) => ({type: SET_USER_JWTTOKEN, token})\r\n// export const setSelfUserId = (selfUserId) => ({type: SET_SELF_USER_ID, selfUserId})\r\n\r\n// export const updateNewPostTextActionCreator = (text) =>\r\n//     ({type: UPDATE_NEW_POST_TEXT, newText: text })\r\n\r\nexport default profileReducer;","import { useState, useEffect } from 'react';\r\nexport const useHotEditing = (startFieldValue, apiFunction, validators=[], maxLength=0) => { //  additionalData=null\r\n    let [editMode, setEditMode] = useState(false);\r\n    let [fieldValue, setFieldValue] = useState(startFieldValue);\r\n    let [isInvalid, setisInvalid] = useState(false);\r\n\r\n    let [charCount, setCharCount] = useState(`${startFieldValue.length}/${maxLength}`)\r\n\r\n    useEffect(() => {\r\n        setFieldValue(startFieldValue);\r\n    }, [startFieldValue]);\r\n    const activateEditMode = () => {\r\n        setEditMode(true);\r\n    }\r\n    const deactivateEditMode = () => {\r\n        setEditMode(false);\r\n        !isInvalid && apiFunction(fieldValue)\r\n    }\r\n    const onFieldValueChange = (e) => {\r\n       if( validators.every(valid => valid(e.currentTarget.value)===undefined)) {\r\n            setisInvalid(false)\r\n            setFieldValue(e.currentTarget.value) \r\n            chars(e.currentTarget.value.length, maxLength)\r\n       } else {\r\n        setisInvalid(true)\r\n       }\r\n    }\r\n\r\n    const chars = (currLen, maxLength) => {\r\n        setCharCount(`${currLen}/${maxLength}`)\r\n    }\r\n\r\n\r\n    return [activateEditMode, deactivateEditMode, onFieldValueChange, editMode, fieldValue, isInvalid, charCount]\r\n}","import React from 'react';\r\nimport { useHotEditing } from '../../../customHooks/hotEditing';\r\nimport { maxLength30 } from '../../../utils/validators/validators';\r\n\r\n\r\n// if i want field level validation better i have to use redux-form than localState (hooks)\r\nconst ProfileStatusWithHooks = (props) => {\r\n    const [activateEditMode, deactivateEditMode, onStatusChange, editMode, status, isInvalid, charCount] = useHotEditing(props.status, props.updateStatus, [maxLength30], 30)\r\n\r\n    return (\r\n        <div className=''>\r\n            {!props.ENSM ?\r\n                <div>\r\n                    {!editMode &&\r\n                        <div>\r\n                            <span onDoubleClick={activateEditMode}>Status: {props.status || \"-------\"}</span>\r\n                        </div>\r\n                    }\r\n                    {editMode &&\r\n                        <div>\r\n                            <input onChange={onStatusChange} autoFocus={true} onBlur={deactivateEditMode}\r\n                                value={status} />\r\n                        </div>\r\n                    }\r\n                </div>\r\n                :\r\n                <div>\r\n                    <div>\r\n                        <span>Status: {props.status || \"-------\"}</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nexport default ProfileStatusWithHooks;","// import React from 'react';\r\n// import s from './ProfileInfo.module.css';\r\n// import Preloader from '../../common/Preloader/Preloader';\r\n\r\n// const ProfileInfo = (props) => {\r\n//     if (!props.profile) {\r\n//         return <Preloader />\r\n//     }\r\n//     return (\r\n//         <div className={s.profile_info}>\r\n//             <div className={s.landi_block}>\r\n//                 <img\r\n//                     src='https://images.pexels.com/photos/248797/pexels-photo-248797.jpeg?auto=compress&cs=tinysrgb&h=350'/>\r\n//             </div>\r\n//             <div className={s.descriptionBlock}>\r\n//                 <div className={s.ava_block}>\r\n//                     <img src={props.profile.photos.large} alt={`PHOTO OF ${props.profile.name}`}/>\r\n//                 </div>\r\n//                 <div className={s.username}>{props.profile.name}</div>\r\n//                 <div className={s.userinfo}>BIO: Date of Birth: 19 Jan 1997</div>\r\n//             </div>\r\n//         </div>\r\n//     )\r\n// }\r\n\r\n// export default ProfileInfo;\r\n\r\n\r\nimport React from 'react';\r\nimport s from './ProfileInfo.module.css';\r\nimport Preloader from \"../../common/Preloader/Preloader\";\r\nimport ProfileStatusWithHooks from './ProfileStatusWithHooks';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\nconst ProfileInfo = ({ profile, updateStatus, updatePhoto, ENSM }) => {\r\n\r\n    if (!profile) {\r\n        return <Preloader />\r\n    }\r\n    console.log(profile.photos.large)\r\n    return (\r\n        <div className={s.profile_info}>\r\n            <div className={s.landi_block}>\r\n                <img\r\n                    src='https://images.pexels.com/photos/248797/pexels-photo-248797.jpeg?auto=compress&cs=tinysrgb&h=350' />\r\n            </div>\r\n            <div className={s.descriptionBlock}>\r\n                <div className={s.ava_block}>\r\n                    <img src={profile.photos.large} alt='ProfilePhoto' />\r\n                </div>\r\n                <div className={s.username}>USERNAME: {profile.name}</div>\r\n                <div className={s.userinfo}>\r\n                    <div>\r\n                        BIO: Date of Birth: 19 Jan 1997\r\n                    </div>\r\n                    <ProfileStatusWithHooks status={profile.status} updateStatus={updateStatus} ENSM={ENSM}/>\r\n                    img url: <a target=\"_blank\" href={profile.photos.large}>Get Photo</a>\r\n                </div>\r\n\r\n                {/* <ProfileStatusWithHooks status={profile.status} updateStatus = {updateStatus}/>\r\n                <ProfilePhotos photos={profile.photos} updatePhoto = {updatePhoto}/> */}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ProfileInfo;","import React from 'react';\r\nimport s from './Post.module.css';\r\n\r\nconst Post = (props) => {\r\n  return (\r\n    <div className={s.item}>\r\n      <img src='https://movies4maniacs.liberty.me/wp-content/uploads/sites/1218/2015/09/avatarsucks.jpg' />\r\n        { props.message }\r\n          <div>\r\n        <span>like</span> { props.likesCount }\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Post;","import React from 'react';\r\nimport s from './MyPosts.module.css';\r\nimport Post from './Post/Post';\r\nimport { reduxForm } from 'redux-form';\r\nimport { requiredField, maxLength30 } from '../../../utils/validators/validators';\r\nimport { createField, TextArea } from '../../common/FormsControls/FormsControls';\r\nimport {addPost} from \"../../../redux/profile-reducer\";\r\nimport {connect} from \"react-redux\";\r\n\r\nconst AddNewPostForm = (props) => {\r\n    return (\r\n        <form onSubmit={props.handleSubmit}> {/* +       props.onSubmit*/}\r\n            <div className=''>\r\n                {createField('Write your post', \"newPostText\", TextArea, [requiredField, maxLength30])}\r\n            </div>\r\n            <div className=''>\r\n                <button>Add post</button>\r\n            </div>\r\n        </form>\r\n    )\r\n}\r\n// a unique name for the form\r\nconst AddNewPostFormRedux = reduxForm({ form: 'ProfileAddNewPostForm' })(AddNewPostForm)\r\n\r\nconst MyPosts = (props) => {\r\n\r\n    const onAddPost = (formData) => {\r\n        // console.log(formData);\r\n        props.addPost(formData.newPostText);\r\n    }\r\n\r\n    let postsElements =\r\n        props.posts.map(p => <Post message={p.message} likesCount={p.likesCount} />);\r\n\r\n    return (\r\n        <div className={s.postsBlock}>\r\n            <div className={s.myPostsHeader}>My posts</div>\r\n            <div className={s.createPost}>\r\n                <AddNewPostFormRedux onSubmit={onAddPost} />\r\n            </div>\r\n            <div className={s.posts}>\r\n                {postsElements}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        posts: state.profilePage.posts\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, {addPost})(MyPosts);\r\n\r\n\r\n// import React from 'react';\r\n// import s from './MyPosts.module.css';\r\n// import Post from './Post/Post';\r\n\r\n\r\n// const MyPosts = (props) => {\r\n//     let postsElements =\r\n//         props.posts.map( p => <Post message={p.message} likesCount={p.likesCount}/>);\r\n\r\n//     let newPostElement = React.createRef();\r\n\r\n//     let onAddPost = () => {\r\n//         props.addPost();\r\n//     }\r\n\r\n//     let onPostChange = () => {\r\n//         let text = newPostElement.current.value;\r\n//         props.updateNewPostText(text);\r\n//         // console.log(text);\r\n//     }\r\n\r\n//     return (\r\n//         <div className={s.postsBlock}>\r\n//             <div className={s.myPostsHeader}>My posts</div>\r\n//             <div className={s.createPost}>\r\n//                 <div>\r\n//                     <textarea ref={newPostElement} value={props.newPostText} onChange={onPostChange}/>\r\n//                 </div>\r\n//                 <div>\r\n//                     <button onClick={onAddPost}>Add post</button>\r\n//                 </div>\r\n//             </div>\r\n//             <div className={s.posts}>\r\n//                 { postsElements }\r\n//             </div>\r\n//         </div>\r\n//     )\r\n// }\r\n\r\n// export default MyPosts;","import React, { useState, useEffect } from 'react';\r\nimport { reduxForm } from 'redux-form';\r\nimport { Input, TextArea, createField } from '../common/FormsControls/FormsControls';\r\nimport { maxLength30, maxLength50, maxLength200 } from '../../utils/validators/validators';\r\nimport { connect } from 'react-redux';\r\nimport { addPost, deletePost, getUserProfile, updateUserProfile, deleteUserProfile, updateStatus, updatePhoto} from '../../redux/profile-reducer';\r\nimport { withRouter, Redirect, NavLink } from 'react-router-dom';\r\nimport styles from '../common/FormsControls/FormsControls.module.css'\r\n\r\nimport s from './Profile.module.css';\r\nimport ProfileInfo from \"./ProfileInfo/ProfileInfo\";\r\n\r\nimport { compose } from 'redux';\r\nimport withAuthRedirect from '../../hoc/WithAuthRedirect';\r\nimport MyPosts from './MyPosts/MyPosts';\r\nimport Preloader from '../common/Preloader/Preloader';\r\nimport { useForbidUnsafeMethods } from '../../customHooks/reduceUnsafeMethods';\r\n\r\nconst ProfileContainer = (props) => {\r\n\r\n    const [exchangeNotSafeMethods, setExchangeNotSafeMethods, shown, setShown, reduceMethods] = useForbidUnsafeMethods()\r\n\r\n    useEffect(() => { \r\n        const fetchData = async() => {\r\n        // debugger\r\n        let userId = props.match.params.userId;\r\n        if (!userId) {\r\n            userId = props.userId; // getting from withAuthRedirect\r\n            if (!userId) {\r\n                // return <Redirect to='/login'/>\r\n                props.history.push('/login')\r\n            }\r\n            exchangeNotSafeMethods && setExchangeNotSafeMethods(false)\r\n        }\r\n        else {\r\n            if (props.userId !== parseInt(userId)) {\r\n                //   (   )\r\n                !exchangeNotSafeMethods && setExchangeNotSafeMethods(true)\r\n            } else {\r\n                exchangeNotSafeMethods && setExchangeNotSafeMethods(false)\r\n            }\r\n        }\r\n        \r\n        await props.getUserProfile(userId);\r\n        // debugger\r\n        setShown(true)\r\n        }\r\n        fetchData();\r\n    }, [props.match.params.userId])\r\n    \r\n\r\n    if(!shown) return <Preloader/>\r\n    return (\r\n        // {this.props.tokenError) ? <Login/>}\r\n        <div className={s.profile_wrapper}>\r\n            <ProfileInfo profile={props.profile} updateStatus={reduceMethods(props.updateStatus)} updatePhoto={reduceMethods(props.updatePhoto)} ENSM={exchangeNotSafeMethods}/>\r\n            {!exchangeNotSafeMethods && <div className=''><MyPosts/> <NavLink to={'/profile_update'}>Update My Profile</NavLink><button onClick={props.deleteUserProfile}>Delete My Profile</button> </div> }\r\n            \r\n        </div>\r\n\r\n    )\r\n\r\n}\r\n// status is already in profile.status => so we dont need to store it out profile instance in state\r\n\r\nlet mapStateToProps = (state) => ({\r\n    profile: state.profilePage.profile,\r\n    userId: state.auth.userId,\r\n    isAuth: state.auth.isAuth,// for WithAuthRedirect\r\n});\r\nexport default compose(\r\n    withAuthRedirect,\r\n    connect(mapStateToProps, {getUserProfile, updateStatus, updatePhoto, deleteUserProfile, updateUserProfile}), // getPhoto == \r\n    withRouter\r\n)(ProfileContainer)\r\n","import { useState } from 'react';\r\nexport const useForbidUnsafeMethods = () => {\r\n    const [exchangeNotSafeMethods, setExchangeNotSafeMethods] = useState(false)\r\n    const [shown, setShown] = useState(false)\r\n\r\n    const reduceMethods = (method, isReduced=null) => (isReduced!==null ? !isReduced : exchangeNotSafeMethods) ? ()=>{} : method\r\n\r\n    return [exchangeNotSafeMethods, setExchangeNotSafeMethods, shown, setShown, reduceMethods]\r\n}","import React from 'react';\r\nimport { reduxForm } from 'redux-form';\r\nimport { Input, createField } from '../common/FormsControls/FormsControls';\r\nimport { requiredField } from '../../utils/validators/validators';\r\nimport { connect } from 'react-redux';\r\nimport { login } from '../../redux/auth-reducer';\r\nimport { Redirect } from 'react-router-dom';\r\nimport styles from '../common/FormsControls/FormsControls.module.css'\r\n\r\n// can show the summary error\r\n// form-level validation\r\nconst LoginForm = props => {\r\n    const { handleSubmit, pristine, reset, submitting, error } = props\r\n    return (\r\n        <form onSubmit={handleSubmit}>\r\n            {createField('Login', \"login\", Input, [requiredField])}\r\n            {createField('Password', \"password\", Input, [requiredField], {type: \"password\"})}\r\n            {\r\n            error && \r\n            <div className={styles.formSummaryError}>\r\n                {error}\r\n            </div>\r\n            }\r\n            <div className=''>\r\n                <button type='submit' disabled={pristine || submitting} >Login</button>\r\n            </div>\r\n            <div className=''>\r\n                <button type='button' disabled={pristine || submitting} onClick={reset}>Clear Values</button>\r\n            </div>\r\n        </form>\r\n    )\r\n}\r\n\r\nconst LoginReduxForm = reduxForm({form:'login'})(LoginForm)\r\n\r\n\r\nconst Login = (props) => {\r\n    // debugger\r\n    const onSubmit = (formData) => {\r\n        props.login(formData.login, formData.password)\r\n    }\r\n    if(props.isAuth) return (<Redirect to='/profile'/>)\r\n\r\n    return (<>\r\n        <div className=''>\r\n            <h1>LOGIN</h1>\r\n            <LoginReduxForm onSubmit={onSubmit}/>\r\n        </div>\r\n        </>)\r\n}\r\n\r\nconst mapStateToProps = (state) => ({\r\n    isAuth: state.auth.isAuth,\r\n});\r\n\r\n\r\nexport default connect(mapStateToProps, {login})(Login);","import React, { useEffect, useState } from 'react';\r\nimport { reduxForm } from 'redux-form';\r\nimport { Input, TextArea, createField } from '../../common/FormsControls/FormsControls';\r\nimport { maxLength30, maxLength50, maxLength200 } from '../../../utils/validators/validators';\r\nimport { connect } from 'react-redux';\r\nimport { getUserProfile, updateUserProfile } from '../../../redux/profile-reducer';\r\nimport { Redirect, withRouter } from 'react-router-dom';\r\nimport styles from '../../common/FormsControls/FormsControls.module.css'\r\nimport withAuthRedirect from '../../../hoc/WithAuthRedirect';\r\nimport { compose } from 'redux';\r\nimport backupQuotes from '../../common/utils/backupQuotes';\r\nimport Preloader from '../../common/Preloader/Preloader';\r\n\r\nconst UpdateProfileForm = props => {\r\n    const [lFAJ, setLFAJ] = useState(props.profile.lookingForAJob)\r\n    const toggleLFAJ = () => lFAJ ? setLFAJ(false) : setLFAJ(true)\r\n\r\n    //          -           (      )\r\n    const { handleSubmit, pristine, reset, submitting, error, profile } = props\r\n    return (\r\n        <form onSubmit={handleSubmit}>\r\n            <label htmlFor=\"\">Name</label>\r\n            {createField(profile.name, 'name', Input, [maxLength30], {defaultValue: profile.name})}\r\n            <label htmlFor=\"\">Status</label>\r\n            {createField(profile.status, 'status', TextArea, [maxLength200], {defaultValue: profile.status})}\r\n            {/* photos */}\r\n            <h3>Photos</h3>\r\n            <h4>Large</h4>\r\n            {createField(profile.photos.large, 'photos_large', Input, null, {defaultValue: profile.photos.large})} {/*here we just write urls to ours photos -> should be subs to uploading blobs or files*/}\r\n            <label htmlFor=\"\">Small</label>\r\n            {createField(profile.photos.small, 'photos_small', Input, null, {defaultValue: profile.photos.small})}\r\n            <label htmlFor=\"\">Are you looking for A job?</label>\r\n            {createField(profile.lookingForAJob , 'lookingForAJob', Input, null, {type: \"checkbox\", checked: lFAJ, onClick: toggleLFAJ })} {/* true-false*/}\r\n            <label htmlFor=\"\">Make a small description for a job you are looking for</label>\r\n            {createField(profile.lookingForAJobDescription, 'lookingForAJobDescription', TextArea, [maxLength200], {defaultValue: profile.lookingForAJobDescription})}\r\n            <label htmlFor=\"\">Fullname</label>\r\n            {createField(profile.fullname, 'fullname', TextArea, [maxLength200], {defaultValue: profile.fullname})}\r\n            {/* contacts */}\r\n            <h3 >Contacts</h3>\r\n            <h4>github</h4>\r\n            {createField(profile.contacts.github, 'contacts_github', Input, [maxLength50], {defaultValue: profile.contacts.github})}\r\n            {createField('vk', 'contacts_vk', Input, [maxLength50], {defaultValue: profile.contacts.vk})}\r\n            {createField('facebook', 'contacts_facebook', Input, [maxLength50], {defaultValue: profile.contacts.facebook})}\r\n            {createField('instagram', 'contacts_instagram', Input, [maxLength50], {defaultValue: profile.contacts.instagram})}\r\n            {createField('twitter', 'contacts_twitter', Input, [maxLength50], {defaultValue: profile.contacts.twitter})}\r\n            {createField('website', 'contacts_website', Input, [maxLength50], {defaultValue: profile.contacts.website})}\r\n            {createField('youtube', 'contacts_youtube', Input, [maxLength50], {defaultValue: profile.contacts.youtube})}\r\n            {createField('mainLink', 'contacts_mainLink', Input, [maxLength50], {defaultValue: profile.contacts.mainLink})}\r\n\r\n            {\r\n            error && \r\n            <div className={styles.formSummaryError}>\r\n                {error}\r\n            </div>\r\n            }\r\n\r\n            <div className=''>\r\n                <button type='submit' disabled={pristine || submitting} >Update</button>\r\n            </div>\r\n            <div className=''>\r\n                <button type='button' disabled={pristine || submitting} onClick={reset}>Clear Values</button>\r\n            </div>\r\n        </form>\r\n    )\r\n}\r\n// if only for the first render i would use  {form: ... , initialValues: {}}\r\nconst UpdateProfileReduxForm = reduxForm({form: 'updateProfile'})(UpdateProfileForm)\r\n\r\nconst UpdateProfile = props => {\r\n\r\n    useEffect(()=>{props.getUserProfile(props.userId)}, []) //     -         props.profile\r\n    \r\n    let [profileRedirect, setProfileRedirect] = useState(false);\r\n    //       \r\n    //            \r\n    // (           \r\n    //     ( ,          ))\r\n    let addProfleFilledProperty = (obj, key, prop) => { \r\n        let subObjects = ['contacts', 'photos']\r\n        if(subObjects.every(start => !key.startsWith(start))){\r\n            obj[key] = prop\r\n        } \r\n        else {\r\n            subObjects.map(start => \r\n                {if(key.startsWith(start)){\r\n                    obj[start] = {}\r\n                    obj[start][key.split('_')[1]] = prop\r\n                    }\r\n                    return true\r\n                })\r\n            }\r\n    } \r\n    const onSubmit = (formData) => {\r\n        // console.log(profileRedirect)\r\n        let profileData = {}\r\n        for(let profProp in formData){\r\n            addProfleFilledProperty(profileData, profProp, formData[profProp])\r\n        }\r\n        Object.keys(profileData).map(data => {\r\n            if(['contacts', 'photos'].includes(data)){\r\n                profileData = {...profileData, [data]: backupQuotes(Object.keys(props.profile[data])\r\n                    .reduce((res, key) => (res[key] = (key in profileData[data] ? profileData[data][key]: props.profile[data][key]), res ), {}))}\r\n            }\r\n        })\r\n        props.updateUserProfile(profileData)\r\n        setProfileRedirect(true)\r\n    }\r\n    // then redirect to profile page (add to store isProfileUpdated: true) // or right after submit redirect \r\n\r\n    \r\n    if (profileRedirect) return <Redirect to='/profile' />\r\n    if (!props.profile) return <Preloader/>\r\n    return (\r\n        \r\n        <div className=''>\r\n            <h2 className=''>Profile Data Changing</h2>\r\n            <UpdateProfileReduxForm onSubmit={onSubmit} profile={props.profile}/>\r\n        </div>\r\n    )\r\n}\r\n\r\nlet mapStateToProps = (state) => ({\r\n    profile: state.profilePage.profile,\r\n    userId: state.auth.userId,\r\n    isAuth: state.auth.isAuth,// for WithAuthRedirect\r\n});\r\nexport default compose(\r\n    withAuthRedirect,\r\n    connect(mapStateToProps, {updateUserProfile, getUserProfile}),  // getUserProfile\r\n    // withRouter\r\n)(UpdateProfile)\r\n","/* eslint-disable jsx-a11y/alt-text */\r\nimport React, { useState } from 'react';\r\nimport { useHotEditing } from '../../../customHooks/hotEditing';\r\nimport styleMessages from './Message.module.css';\r\nimport { maxLength1000 } from '../../../utils/validators/validators';\r\n \r\nimport { useRef } from 'react';\r\nimport { useEffect } from 'react';\r\nimport Preloader from '../../common/Preloader/Preloader';\r\n\r\n\r\nconst EditMessageActive = ({isInvalid, onMBChange, deactivateEditMode, editedMessage, charCount}) => {\r\n    return (<div className={styleMessages.editMessage}>\r\n        <textarea className={isInvalid ? `${styleMessages.editField} ${styleMessages.error}`: `${styleMessages.editField}`} onChange={onMBChange} autoFocus={true} onBlur={deactivateEditMode}\r\n            value={editedMessage} />\r\n        {\r\n            isInvalid && <div className={styleMessages.errorField}>Invalid Data</div>\r\n        }\r\n        <div className={styleMessages.countChars}>{charCount}</div>\r\n    </div>)\r\n}\r\n\r\n// isFileFetching\r\n\r\nconst EditMessageInactive = ({fileId, activateEditMode, messageBody, fileImageURL, loadFile, ENSM }) => {  // , messageId => loadFile(messageId, fileId)\r\n    if (fileId){\r\n        return ( <div className={styleMessages.messageBody} onDoubleClick={!ENSM? activateEditMode: undefined}> {messageBody} \r\n            <div className={`${styleMessages.messageFile} ${fileImageURL===null ? styleMessages.fileImageDeactivate : styleMessages.fileImageActivate}`}>\r\n                        {loadFile && <>\r\n                            <span> + fileId: {fileId}</span>\r\n                            <button onClick={()=>loadFile(fileId)}>GetFile</button> \r\n                        </>}\r\n\r\n                        {/* <button onClick={()=>downloadFile(fileId)}>GetFile</button>  */}\r\n                        <img src={fileImageURL} />\r\n                        {/* {fileImageURL && <a  onClick={downloadFile} download={imageName}><img src={fileImageURL} /></a>} */}\r\n                </div>\r\n            </div>)\r\n    } else {\r\n        return (<div className={styleMessages.messageBody} onDoubleClick={!ENSM? activateEditMode: undefined}>{messageBody}</div>)\r\n    }\r\n    \r\n}\r\n\r\n \r\n\r\n\r\nexport const EditMessage = ({messageBody, editMessage, ENSM, \r\n    fileId, fileIDBKey,  loadImageFromIDB,  \r\n    getFile,\r\n                            }) => {\r\n    const [activateEditMode, deactivateEditMode, onMBChange, editMode, editedMessage, isInvalid, charCount] = useHotEditing(messageBody, editMessage, [maxLength1000], 1000) \r\n \r\n\r\n    const [isFetching, setIF] = useState(false)\r\n\r\n    const [fileImageURL, setFIU] = useState(null) // fileIDBValue in fileImageURL \r\n\r\n    useEffect(() => { \r\n        if(!isFetching){ \r\n            console.log(fileIDBKey)  \r\n            if( fileIDBKey && !fileImageURL){ \r\n                console.log(fileIDBKey)  \r\n                setIF(true)\r\n                async function loadFromIdb(fileIDBKey){  \r\n                    console.log('loadFromIdb')\r\n                    let fileIDBValue = await loadImageFromIDB(fileIDBKey) // like  image-chatTypeId-chatId-messageId\r\n                    console.log(\"fileIDBValue for file IDB key: \" + fileIDBKey)\r\n                    console.log(fileIDBValue)\r\n                    setFIU(fileIDBValue) \r\n                    setIF(false)\r\n                }\r\n                loadFromIdb(fileIDBKey)\r\n            }\r\n\r\n        } \r\n    },[fileIDBKey, loadImageFromIDB, fileImageURL, isFetching] ) //     1     ( )\r\n\r\n\r\n    if(fileIDBKey && fileImageURL===null) return <Preloader/>\r\n\r\n    return ( \r\n            <>\r\n                {!editMode && \r\n                <EditMessageInactive fileId={fileId} activateEditMode={activateEditMode} messageBody={messageBody} \r\n                fileImageURL={fileImageURL} \r\n                // loadFile={loadFile.bind(this)} \r\n                // messageId={messageId}\r\n                loadFile={!fileImageURL ? getFile: undefined} // we cant get file if we already load from idb value for img:src\r\n                ENSM={ENSM}\r\n                \r\n                // downloadFile={downloadFile}\r\n                // imageName={imageName}\r\n                />\r\n                }\r\n                {editMode &&\r\n                <EditMessageActive isInvalid={isInvalid} onMBChange={onMBChange} deactivateEditMode={deactivateEditMode} editedMessage={editedMessage} charCount={charCount} />\r\n                }\r\n            </>  \r\n    )\r\n}\r\n\r\n// tasks\r\n\r\n// url browser add\r\n\r\n// scss change and add\r\n\r\n// validator create message make XoR-able\r\n\r\n// photo and tap open in that window\r\n\r\n","import React, {useRef, useImperativeHandle, forwardRef } from 'react';\r\nimport styleMessages from './Message.module.css';\r\nimport { NavLink } from 'react-router-dom';\r\nimport { convertTime } from '../../common/utils/convertTime';\r\nimport { EditMessage } from './EditMessage';\r\n\r\n\r\n// add readed and local and functions to operate with msgs\r\nconst Message = (props, ref) => {\r\n    const inputRef = useRef();\r\n    useImperativeHandle(ref, (node) => {\r\n    //   focus: () => {\r\n    //     inputRef.current.focus();\r\n    //   }\r\n        // console.log('useImperativeHandle')\r\n        // console.log(node)\r\n        // console.log(inputRef.current)\r\n        return inputRef.current\r\n    });\r\n    \r\n    const { message, editMessageRequest, deleteMessageRequest, ENSM, chatTypeId, chatId, getFile, downloadFile} = props\r\n    // console.log( message.fileId)\r\n    const editMessage = (chatTypeId, chatId,  message) => (messageBody) => editMessageRequest(chatTypeId, chatId, message.id, messageBody)\r\n    \r\n    const onDeleteMsg = () => {\r\n        deleteMessageRequest(chatTypeId, chatId, message.id, message.fileId)\r\n    }\r\n\r\n    \r\n    // just add /br for unread msgs  \r\n    return <div className={`${styleMessages.message}`} ref={inputRef}>\r\n        <div className={styleMessages.messageAuthorName}>\r\n            <NavLink to={`/profile/${message.authorId}`}>{message.authorName}</NavLink>\r\n        </div>\r\n        <EditMessage ENSM={ENSM} editMessage={editMessage(chatTypeId, chatId, message)} messageBody={message.body} getFile={getFile} downloadFile={downloadFile} fileId={message.fileId}\r\n        \r\n        // saveImageToIDB={props.saveImageToIDB}\r\n        loadImageFromIDB={props.loadImageFromIDB}\r\n\r\n        fileIDBKey={message.fileIDBKey}\r\n\r\n        // messageId={message.id}\r\n        \r\n        />\r\n        <div className={styleMessages.messageSendedEdited}>\r\n            <div className={styleMessages.messageSended}>sended: {convertTime(message.sended)}</div>\r\n            <div className={styleMessages.messageEdited}>edited: {convertTime(message.edited)}</div>\r\n        </div>\r\n        <div className={styleMessages.deleteMessage}>{!ENSM && <a onClick={onDeleteMsg}>Delete Message</a>}</div>\r\n        </div>\r\n}\r\n\r\nexport default forwardRef(Message);\r\n","import React, {useState}  from 'react';\r\nimport styles from '../../common/FormsControls/FormsControls.module.css'\r\nimport { createField, TextArea, FileInput, Input } from '../../common/FormsControls/FormsControls';\r\nimport { maxLength1000 } from '../../../utils/validators/validators';\r\nimport { reduxForm } from 'redux-form';\r\nimport { compose } from 'redux';\r\nimport { connect } from 'react-redux';\r\nimport withAuthRedirect from '../../../hoc/WithAuthRedirect';\r\nimport { createMessageRequest  } from '../../../redux/chats-reducer';\r\n\r\nconst CreateMessageForm = props => {\r\n    const { handleSubmit, pristine, reset, submitting, error } = props\r\n\r\n\r\n    // const [selectedFiles, setSelectedFiles] = useState(undefined);\r\n    // const selectFile = (event) => {\r\n    //   setSelectedFiles(event.target.files);\r\n    // };\r\n\r\n\r\n    // const [file, setFile] = useState({\r\n    //     selectedFiles: undefined,\r\n    //     currentFile: undefined,\r\n    //     progress: 0,\r\n    //     message: \"\",\r\n  \r\n    //     fileInfos: [],\r\n    //   })\r\n\r\n    // const selectFile = (ev) => {\r\n    //     setFile({\r\n    //         selectedFiles: ev.target.files,\r\n    //     });\r\n    // }\r\n\r\n    // TIP there is problems\r\n    return (\r\n        <form onSubmit={handleSubmit}>\r\n            {createField('Write a message...', 'messageBody', TextArea, [maxLength1000])}\r\n            {createField('Upload a file...', 'uploadedFile', FileInput, null, {type: \"file\"})} \r\n            {\r\n            error && \r\n            <div className={styles.formSummaryError}>\r\n                {error}\r\n            </div>\r\n            }\r\n            <div className=''>\r\n                <button type='submit' disabled={pristine || submitting}>Send</button>\r\n            </div>\r\n            <div className=''>\r\n                <button type='button' disabled={pristine || submitting} onClick={reset}>Clear</button>\r\n            </div>\r\n        </form>\r\n    )\r\n}\r\n\r\n\r\nconst msgCreationStyleForm = {\r\n    color: 'green'\r\n}\r\n\r\nconst CreateMessageReduxForm = reduxForm({form: 'CreateMessage'})(CreateMessageForm)\r\n\r\nconst CreateMessage = (props) => {\r\n    const onSubmit = (formData) => {\r\n        if(!formData['messageBody'] && formData[\"uploadedFile\"]){\r\n            formData['messageBody'] = ' '\r\n        }\r\n        formData[\"uploadedFile\"] ?\r\n            props.createMessageRequest(props.chatTypeId, props.chatId, formData[\"messageBody\"], formData[\"uploadedFile\"]) :\r\n            props.createMessageRequest(props.chatTypeId, props.chatId, formData[\"messageBody\"])\r\n    }\r\n    return (\r\n        <div className=''>\r\n            <div style={msgCreationStyleForm}>Message:</div>\r\n            <CreateMessageReduxForm onSubmit={onSubmit}/>   \r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nexport default compose(\r\n    withAuthRedirect,\r\n    connect(null, {createMessageRequest}),\r\n)(CreateMessage);\r\n","\r\n/* eslint-disable jsx-a11y/alt-text */\r\n/* eslint-disable no-sequences */\r\n/* eslint-disable jsx-a11y/anchor-is-valid */\r\nimport React, { useEffect, useState, useRef, useCallback, useReducer } from 'react';\r\nimport { compose } from 'redux';\r\nimport withAuthRedirect from '../../../hoc/WithAuthRedirect';\r\nimport { withRouter } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\nimport { getMessages, editMessageRequest, deleteMessageRequest, getCurrentChatData,\r\n        clearChatMyLocal, clearChatMyGlobal, clearChatAllLocal, clearChatAllGlobal,\r\n        toogleMemberStatus, removeMemberMsgs, removeOneMemberMsg, removeMember,\r\n        setChatPhotoRequest, addMember, renameChatRequest, \r\n        getFile, setRefreshMessageCreating, \r\n        // saveImageToIDB, \r\n        loadImageFromIDB, \r\n        // setRefreshAfterDM,\r\n\r\n        // setOldMsgsDonwload, \r\n        // fetchMoreOldMsgs\r\n     } from '../../../redux/chats-reducer';\r\nimport Preloader from '../../common/Preloader/Preloader';\r\nimport { selectChatMessages, selectCIPS, selectCTIPS, selectCurrentChat, selectFocusedWindowAddUserForChat, selectFocusedWindowMembersForChat, selectFocusedWindowMemberOperationsForChat } from '../../../redux/chats-selector';\r\nimport Message from '../Message/Message';\r\n\r\n\r\nimport styleMessages from '../Message/Message.module.css';\r\nimport styleChats from '../Chats.module.css';\r\nimport CreateMessage from '../Message/CreateMessage'; \r\nimport { ChangeChatPhoto, RenameChat, Member, Members, SelectMemberToChat } from './ChatItem';\r\nimport { addFocusedWindow, clearCurrentFocusedWindow } from '../../../redux/app-reducer';\r\n\r\n\r\n\r\n\r\n\r\nconst getMessageTagWithRef = (data, refCondition, withNewMsgsTag=false, NMTRefCondition=null) => {\r\n    if(!withNewMsgsTag) return (<Message message={data.msg} key={data.msg.id}\r\n                                ref={refCondition} // OMD_PSR_CBCB(msg.id)\r\n                                deleteMessageRequest={data.deleteMessageRequest} \r\n                                editMessageRequest={data.editMessageRequest} ENSM={!data.msg.local}\r\n                                chatTypeId={data._chatTypeId} chatId={data._chatId} getFile={data.getFile}\r\n                                // saveImageToIDB={data.saveImageToIDB} \r\n                                loadImageFromIDB={data.loadImageFromIDB}/>)\r\n    \r\n    return [\r\n        <div className={`${styleMessages.newMsgsStartTag}`} \r\n        ref={NMTRefCondition}>----------UNREAD MESSAGES----------</div>,\r\n        // rasCBCB1()\r\n        <Message message={data.msg} key={data.msg.id} \r\n        ref={refCondition} // OMD_PSR_CBCB(msg.id)\r\n                deleteMessageRequest={data.deleteMessageRequest} \r\n                editMessageRequest={data.editMessageRequest} ENSM={!data.msg.local}\r\n                chatTypeId={data._chatTypeId} chatId={data._chatId} getFile={data.getFile}\r\n                // saveImageToIDB={data.saveImageToIDB} \r\n                loadImageFromIDB={data.loadImageFromIDB}/>\r\n        ]\r\n}\r\n\r\n// setRefreshAfterDM /\r\n\r\n\r\n\r\n\r\n// ......  numOfDeletedMsgs -       \r\nconst ChatDetail = ({getCurrentChatData, getMessages, IsFetchingMsgs,  \r\n    setRefreshMessageCreating, \r\n    // setRefreshAfterDM, // functions\r\n    chatTypeId:_chatTypeId, chatId:_chatId, readFromIndexNext:_readFromIndexNext, readFromIndex:_readFromIndex, // state\r\n    windowScrollOnMsgCreate, isMessageCreating, isRefreshedAfterMC, \r\n    numOfDeletedMsgs,\r\n    \r\n    // saveImageToIDB,\r\n    loadImageFromIDB,\r\n\r\n    ...props}) => {  // other props\r\n\r\n    const [oldMsgsDonwload, setOldMsgsDonwload] = useState(false, 'oldMsgsDonwload'); \r\n    const [preFetch, setPreFetch] = useState(false, 'preFetch');  /// +\r\n    const [selectedMember, setSelectedMember] = useState(null, 'selectedMember') /// using in child functions (so dont check it now)   -\r\n    const [refToTopAtStart, setRTTAS] = useState(true,  'refToTopAtStart')  ///\r\n    const [positioningScrollRefScroll, setPSRS] = useState(false, 'positioningScrollRefScroll') \r\n    \r\n    // old message download positional scrol ref\r\n    const refOMDPSR = useRef(null) // this ref node always had loadOldMsgsDiv part of oclass ( we can write here not only node, but object {'node':node, classPart:'loadOldMsgsDiv'})\r\n    const refAtStart = useRef(null) // ref -> refAtStart\r\n    const refToObserve = useRef(null) // from refAtStartCB and \r\n\r\n    const [refreshIsRunning, setRIR] = useState(false)\r\n\r\n\r\n    // const [loadingOnScroll, setLoadingOnScroll] = useState(true) // _readFromIndex !=== _readFromIndexNext\r\n\r\n    // const getMessagesCB = useCallback( async (RFI) => (await getMessages(_chatTypeId, _chatId, RFI, _firstOfSetOfMsgsId )),\r\n    //                                     [ _chatTypeId, _chatId, _firstOfSetOfMsgsId, getMessages ] ) // _prop - mean its from props descruct\r\n\r\n\r\n    // const getRefreshMessagesCB = useCallback( async () => (await getMessagesCB( _readFromIndex )),  [_readFromIndex, getMessagesCB ] ) // _prop - mean its from props descruct\r\n\r\n    // const getOLDMessagesCB = useCallback( async () =>   (await getMessagesCB( _readFromIndexNext )), [ _readFromIndexNext, getMessagesCB ] ) // _prop - mean its from props descruct\r\n\r\n\r\n\r\n    const refLastMsg = useRef(null)\r\n    \r\n    //     -     -  )))\r\n    // const isUltimateCallbackProcced = useRef(false)\r\n    // isUltimateCallbackProcced.current = false // to set to the aflse each render\r\n\r\n    useEffect(()=>{\r\n        if(preFetch){\r\n            ULTIMATE_CALLBACK( refToTopAtStart ? 'start' : 'notStart',\r\n                                refToTopAtStart ? refAtStart.current : refOMDPSR.current, \r\n                                refToTopAtStart ?  props.currentChat.firstNewMsgID === null : positioningScrollRefScroll && !oldMsgsDonwload,\r\n                                refToObserve.current)\r\n        }\r\n        // isUltimateCallbackProcced.current = true\r\n        // return () => isUltimateCallbackProcced.current === true\r\n    }) // [preFetch, props.currentChat.firstNewMsgID, ]\r\n\r\n    // const wSOMC = useRef(windowScrollOnMsgCreate) // will be last value of prop ( e.i. if we cleanup it data we will check newest data from props to not run it action more then should)\r\n    useEffect(() => {\r\n        //          -   windowScrollOnMsgCreate   //            (     -       )\r\n        if(isRefreshedAfterMC){\r\n            if(refLastMsg.current){\r\n                refLastMsg.current.scrollIntoView()\r\n            } else {\r\n                console.log('some wierd error in ref creating for last msg after creation')\r\n            }\r\n            isRefreshedAfterMC && setRefreshMessageCreating(false)\r\n            // isRefreshedAfterDM && setRefreshAfterDM(false)\r\n        }\r\n        // return () => {if(windowScrollOnMsgCreate === true){shouldWindowScrollDown(false)}}\r\n    },[setRefreshMessageCreating, isRefreshedAfterMC]) // setRefreshAfterDM\r\n\r\n    useEffect(()=>{\r\n\r\n        let node = null;\r\n\r\n        const thresholdArray = steps => Array(steps + 1)\r\n            .fill(0)\r\n            .map((_, index) => index / steps || 0)\r\n\r\n        const handleIntersect = (entries, observer) => { // its async??? // no its callback!\r\n            entries.forEach(entry => {\r\n                const isIntersecting = entry.isIntersecting \r\n                console.log('only after scroll calling')\r\n                if(isIntersecting){ \r\n                    // debugger\r\n                    console.log('intersetcion of target(should be true) ')\r\n                    console.log(\"TOP DIV VIEWED: \" + entry.target.innerText) // refToObserve.current.innerText\r\n                    // entry.target.className = entry.target.className.replace(/[^\\s]*loadOldMsgsDiv[^\\s]*/g, ''); // change whole className but regex will take only a part of className (approp class)\r\n                    observer.unobserve(entry.target)\r\n                    \r\n                    setOldMsgsDonwload(true) // toggle proccess for loading old msgs\r\n                }\r\n            })\r\n        }\r\n\r\n        const observer = new IntersectionObserver(handleIntersect, {threshold: thresholdArray(2)})\r\n\r\n\r\n        \r\n        if(refToObserve.current && preFetch && ((!positioningScrollRefScroll && !oldMsgsDonwload) || (refToTopAtStart))){ \r\n            node = refToObserve.current\r\n            observer.observe(node); // its event.target\r\n        }\r\n\r\n\r\n        return () => node !==null && observer.unobserve(node);\r\n    }, [positioningScrollRefScroll, oldMsgsDonwload, refToTopAtStart, preFetch])// it will call every render and it okay//,[setOldMsgsDonwload, preFetch, refToTopAtStart]) \r\n\r\n\r\n\r\n    const ULTIMATE_CALLBACK = (nodeToScrollType, nodeToScroll, conditionNTS, nodeToObserve)=> {\r\n        if(nodeToScroll ==null) return \r\n            if(nodeToScrollType==='start'){\r\n                // debugger\r\n                if(conditionNTS){\r\n                    nodeToScroll.scrollTop = nodeToScroll.scrollHeight  \r\n                } else {\r\n                    nodeToScroll.scrollIntoView()\r\n                } \r\n                // refToObserveCB()\r\n                setRTTAS(false)\r\n            } else {\r\n                if(conditionNTS){\r\n                    // debugger\r\n                    nodeToScroll.scrollIntoView()\r\n                    setPSRS(false)\r\n                }\r\n            }\r\n    }\r\n\r\n\r\n    useEffect(() => { ////////////////////////////////////////////// (PF)\r\n        console.log('should run 2 times only (preFetch)') \r\n        if( !preFetch ){//&& !props.IsFetchingMsgs){ \r\n            const populatePreFetchData = async() => {\r\n                await getCurrentChatData();\r\n                setPreFetch(true);\r\n            }\r\n            populatePreFetchData();\r\n        }\r\n    }, [preFetch, getCurrentChatData])\r\n\r\n    useEffect(() => {/////////////////////////////////////////////////// (RD)\r\n            // if(preFetch) {\r\n            let sTOID = null\r\n            // console.log(\"refreshIsRunning\")\r\n            // console.log(refreshIsRunning)\r\n            if(!refreshIsRunning){\r\n            sTOID = setTimeout( async () => {\r\n                // setRIR(true)\r\n                if( !oldMsgsDonwload && preFetch && !IsFetchingMsgs && !positioningScrollRefScroll){\r\n                    // debugger\r\n                    setRIR(true)\r\n                    // let currentdate = new Date(); \r\n                    // let datetime = \"Last Sync: \" + currentdate.getDate() + \"/\"\r\n                    // + (currentdate.getMonth()+1)  + \"/\" \r\n                    // + currentdate.getFullYear() + \" @ \"  \r\n                    // + currentdate.getHours() + \":\"  \r\n                    // + currentdate.getMinutes() + \":\" \r\n                    // + currentdate.getSeconds();\r\n                    // console.log(datetime)\r\n                    await getMessages(_chatTypeId, _chatId, _readFromIndex, props.readFromIndexBefore, null, (windowScrollOnMsgCreate && !isMessageCreating), numOfDeletedMsgs )\r\n                    setRIR(false)\r\n                } \r\n            }\r\n            , 1500) }     \r\n            return () => { sTOID !== null && clearTimeout(sTOID); }; \r\n            //       (  oldMsgsDonwload - !!!!)\r\n        // if(!positioningScrollRefScroll && oldMsgsDonwload && !IsFetchingMsgs){ //       +      ,    \r\n        }, [preFetch, oldMsgsDonwload, IsFetchingMsgs, positioningScrollRefScroll,\r\n            _chatTypeId, _chatId, _readFromIndex, props.readFromIndexBefore, getMessages,\r\n            windowScrollOnMsgCreate, isMessageCreating, numOfDeletedMsgs, refreshIsRunning]) //  for what oldMsgsDonwload ???? if msgs not fetching yet ( but process of getOLDMessagesCB is started ( but async so can   ))\r\n        // IsFetchingMsgs dont need (cause only 2 effects - FOM and RD -> if FOM processing (oldMsgsDonwload) => u can use RD and vise versa)\r\n\r\n\r\n    useEffect(() => { // (FOM)\r\n\r\n        if(!positioningScrollRefScroll && oldMsgsDonwload && !IsFetchingMsgs){ //       +      ,    \r\n            const fetchOldMsgs = async() => { \r\n                await getMessages(_chatTypeId, _chatId, _readFromIndexNext, _readFromIndex )\r\n                // setPSRS(false)\r\n                setOldMsgsDonwload(false) \r\n\r\n                // if(_readFromIndexNext === _readFromIndex){\r\n                //     setLoadingOnScroll(false) \r\n                // }\r\n            }\r\n            setPSRS(true)\r\n            // debugger\r\n            fetchOldMsgs()\r\n        }\r\n        //     (  )\r\n        // return () => {} //               \r\n    }, [IsFetchingMsgs, positioningScrollRefScroll, oldMsgsDonwload, setOldMsgsDonwload, setPSRS,\r\n        _chatTypeId, _chatId, _readFromIndexNext, _readFromIndex, getMessages])\r\n  \r\n//|| props.oldMsgsDonwload\r\n    if (!preFetch){ return <Preloader />} else {\r\n        if(numOfDeletedMsgs > 0){\r\n            console.log(\"numOfDeletedMsgs\")\r\n            console.log(numOfDeletedMsgs)\r\n        }\r\n    // ----------Get Older Messages----------\r\n    let beforeMsgsDiv = (_readFromIndexNext !== _readFromIndex) ? (<div className={`${styleMessages.loadOldMsgsDiv}`} ref={refToObserve}></div>) : \r\n                                                (<div className={`${styleMessages.startChatDiv}`}>----------Chat Start----------</div>)\r\n\r\n    //    updateUnreadMsgs - props.messages[index-1].msgViewed === true -          (            )\r\n    \r\n    let messages = props.messages.map((msg, index) => \r\n                                        {\r\n                                            let dataToMsg = {msg:msg, getFile:props.getFile, _chatId:_chatId, _chatTypeId:_chatTypeId,\r\n                                                editMessageRequest:props.editMessageRequest, deleteMessageRequest:props.deleteMessageRequest,\r\n                                                // saveImageToIDB:saveImageToIDB, \r\n                                                loadImageFromIDB:loadImageFromIDB }\r\n\r\n                                            if(props.currentChat.firstNewMsgID!==null && props.currentChat.firstNewMsgID <= msg.id && \r\n                                                (index === 0 || props.messages[index-1].id < props.currentChat.firstNewMsgID ))\r\n                                            {// return list of 2 elems\r\n                                                return getMessageTagWithRef(dataToMsg, (msg.id === props.readFromIndexBefore && positioningScrollRefScroll ? refOMDPSR : undefined),\r\n                                                true,  (props.currentChat.firstNewMsgID !== null && refToTopAtStart ? refAtStart : undefined))\r\n                                            } else {\r\n                                                if(index === props.messages.length - 1){\r\n                                                    // if message already created and we should after that scroll -> do that then discard wsomc value to false \r\n                                                    return getMessageTagWithRef(dataToMsg, (isRefreshedAfterMC  ? refLastMsg : undefined))\r\n                                                } else {\r\n                                                    return getMessageTagWithRef(dataToMsg, (msg.id === props.readFromIndexBefore && positioningScrollRefScroll ? refOMDPSR : undefined))\r\n                                                }\r\n                                            }\r\n                                            }).flat()  // if we create newMsgsStartTag additional tag\r\n    messages.unshift(beforeMsgsDiv) // add div before first msg                                           \r\n    // if(messages.length < 3){ //      () -         \r\n    //     debugger\r\n    // }\r\n    const prefetchOper = (method, chatTypeId, chatId) => (selectedMemberId)  => () => method(chatTypeId, chatId, selectedMemberId)\r\n    let memberOpers = [{method: props.toogleMemberStatus, name: 'Toogle Member'}, {method: props.removeMemberMsgs, name: 'Remove All Member Messages'}, {method: props.removeMember, name: 'Remove Member'}]\r\n    let chatUsersIds = props.currentChat.members.map(member => member.id)\r\n\r\n    \r\n    let members = _chatTypeId === 1 \r\n                    ? \r\n                    props.currentChat.members.map(member => <Member member={member} key={member.id} memberStyle={`${styleMessages.chatMember}`} \r\n                        chatMemberSettings={`${styleMessages.chatMemberSettings}`}\r\n                        setMemberOperShow={(event) => (event.stopPropagation(), props.addFocusedWindow(props.fWMOFC.id, true))}\r\n                        addFocusedWindow={props.addFocusedWindow}\r\n                        fWMOFC={props.fWMOFC}\r\n                        setSelectedMember={setSelectedMember}/>)\r\n                    :\r\n                    props.currentChat.members.map(member => <Member member={member} key={member.id}/>)\r\n\r\n                    \r\n    return (\r\n        <>\r\n        {\r\n        props.fWAUFC.data !== null  && \r\n        <div className={styleChats.addMember}>\r\n            <SelectMemberToChat addMember={props.addMember} chatTypeId={_chatTypeId} chatId={_chatId} chatUsersIds={chatUsersIds} \r\n            fWAUFC={props.fWAUFC} clearCurrentFocusedWindow={props.clearCurrentFocusedWindow} />\r\n        </div>\r\n        } \r\n        <div className={styleMessages.currentChat}>\r\n            \r\n                <Members members={members} \r\n                membersShow={props.fWMFC.data} \r\n                memberOperShow={props.fWMOFC.data} \r\n                selectedMember={selectedMember}\r\n                memberOpers={memberOpers\r\n                    .map(memberOper => ({...memberOper, \r\n                        method: prefetchOper(memberOper.method, _chatTypeId, _chatId) }))}/>\r\n \r\n            <div className={styleMessages.chatsHeader}>\r\n                <div className={styleMessages.chatsHeaderPhoto}> {props.currentChat.chatPhoto.small !== null ? <img src={props.currentChat.chatPhoto.small} /> : <div className={styleMessages.chatsHeaderPhotoAlt}>chatPhotoSmall</div>}</div>\r\n                <div className={styleMessages.chatsHeaderName}>{props.currentChat.name}</div>\r\n                <div className={styleMessages.chatsHeaderSettings}>\r\n                    Settings\r\n                    <div className={styleMessages.chatsSettings}>\r\n                    { _chatTypeId === 1 &&\r\n                        <>\r\n                            <div className={styleMessages.chatsSettingsItem}>\r\n                                {props.fWAUFC.data === null  &&\r\n                                    <a className={styleChats.getMemberList}\r\n                                        onClick={\r\n                                            (event) => (event.stopPropagation(), props.addFocusedWindow(props.fWAUFC.id, [_chatTypeId, _chatId]))\r\n                                         }\r\n                                        > \r\n                                            Add Member\r\n                                        </a>\r\n                                }\r\n                            </div>\r\n                            <div className={styleMessages.chatsSettingsItem}>\r\n                                <div className={styleMessages.chatsSettingsItemH}>Change Photo</div>\r\n                                <ChangeChatPhoto msgStyle={styleMessages.chatsSettingsItemForm} setChatPhotoRequest={props.setChatPhotoRequest} chatTypeId={_chatTypeId} chatId={_chatId} />\r\n                            </div> \r\n                            <div className={styleMessages.chatsSettingsItem}>\r\n                            <div className={styleMessages.chatsSettingsItemH}>Rename Chat</div>\r\n                                <RenameChat msgStyle={styleMessages.chatsSettingsItemForm} renameChatRequest={props.renameChatRequest} chatTypeId={_chatTypeId} chatId={_chatId}/>\r\n                            </div> \r\n                             </>\r\n                    } \r\n                        <div className={styleMessages.chatsSettingsItem}>\r\n                            <div className={styleMessages.chatsMembersHeader}>\r\n                                {\r\n                                props.fWMFC.data === null &&\r\n                                <a onClick={(event)=>(event.stopPropagation(), props.addFocusedWindow(props.fWMFC.id, true))}>\r\n                                    Chat Members\r\n                                </a>\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                    \r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n \r\n            {/* event or event.target TODO*/}\r\n            \r\n        <div className={styleMessages.messages} ref={\r\n            // delete this ref if refToTopAtStart is already precced before (cause we dont nedd to posit again) so use \"\"\"&& refToTopAtStart\"\"\"\r\n            // rasCBCB1(props.currentChat.firstNewMsgID , refToTopAtStart) /// ref={undefined} ->          ()\r\n            props.currentChat.firstNewMsgID === null && refToTopAtStart ? refAtStart : undefined }>\r\n                {messages}\r\n                {/* <h1>{refToTopAtStart + 'is it okay refToTopAtStart ??????'}</h1> */}\r\n        </div>\r\n            {/* { ULTIMATE_CALLBACK( refToTopAtStart ? 'start' : 'notStart',\r\n                            refToTopAtStart ? refAtStart.current : refOMDPSR.current, \r\n                            refToTopAtStart ?  props.currentChat.firstNewMsgID === null : positioningScrollRefScroll && !oldMsgsDonwload,\r\n                             refToObserve.current)} */}\r\n\r\n\r\n                             \r\n        {/* <h3 className={styleMessages.trash} ref={() => ULTIMATE_CALLBACK( refToTopAtStart ? 'start' : 'notStart',\r\n                            refToTopAtStart ? refAtStart.current : refOMDPSR.current, \r\n                            refToTopAtStart ?  props.currentChat.firstNewMsgID === null : positioningScrollRefScroll && !oldMsgsDonwload,\r\n                             refToObserve.current)}>Trash</h3> */}\r\n\r\n\r\n        {/* when all ref tag elems rendered call it -> to make operations over that refs */}\r\n        <div className={styleMessages.createMessageForm}><CreateMessage chatTypeId={_chatTypeId} chatId={_chatId} isAuth={props.isAuth}/></div>\r\n\r\n\r\n            \r\n        </div>\r\n        </>\r\n            )\r\n        }\r\n}\r\n\r\n\r\nlet mapStateToProps = (state) => ({\r\n    messages: selectChatMessages(state),\r\n    isAuth: state.auth.isAuth,\r\n    chatTypeId: selectCTIPS(state),\r\n    chatId: selectCIPS(state),\r\n    currentChat: selectCurrentChat(state),\r\n\r\n    fWAUFC: selectFocusedWindowAddUserForChat(state),\r\n    fWMFC: selectFocusedWindowMembersForChat(state),\r\n    fWMOFC: selectFocusedWindowMemberOperationsForChat(state),\r\n\r\n\r\n    readFromIndexNext: state.chatsPage.readFromIndexNext,\r\n    readFromIndex: state.chatsPage.readFromIndex,\r\n    readFromIndexBefore: state.chatsPage.readFromIndexBefore,\r\n    IsFetchingMsgs: state.chatsPage.IsFetchingMsgs,\r\n\r\n    windowScrollOnMsgCreate: state.chatsPage.windowScrollOnMsgCreate,\r\n    isMessageCreating: state.chatsPage.isMessageCreating,\r\n    isRefreshedAfterMC: state.chatsPage.isRefreshedAfterMC,\r\n    numOfDeletedMsgs: state.chatsPage.numOfDeletedMsgs,\r\n})\r\n\r\nexport default compose(\r\n    withAuthRedirect,\r\n    connect(mapStateToProps, { getMessages, editMessageRequest, deleteMessageRequest,\r\n                                getCurrentChatData,\r\n                                clearChatMyLocal, clearChatMyGlobal, clearChatAllLocal, clearChatAllGlobal,\r\n                                toogleMemberStatus, removeMemberMsgs, removeOneMemberMsg, removeMember,\r\n                                setChatPhotoRequest, addMember, renameChatRequest,\r\n\r\n                                addFocusedWindow, clearCurrentFocusedWindow,\r\n\r\n                                getFile,  \r\n                                setRefreshMessageCreating,\r\n\r\n                                // saveImageToIDB,\r\n                                loadImageFromIDB,\r\n\r\n\r\n                            }),\r\n    withRouter\r\n)(ChatDetail)\r\n\r\n \r\n\r\n// pre render page effect useLayoutEffect\r\n// post render page effect useEffect\r\n\r\n\r\n","import React, { useEffect } from 'react';\r\nimport './App.css';\r\nimport Header from './components/Header/Header';\r\nimport Navbar from './components/Navbar/Navbar';\r\n// import Profile from './components/Profile/Profile';\r\nimport { Route, withRouter  } from \"react-router-dom\";\r\nimport ChatsContainer from './components/Chats/ChatsContainer';\r\nimport UsersContainer from './components/Users/UsersContainer';\r\nimport Profile from './components/Profile/Profile';\r\nimport Login from './components/Login/Login';\r\nimport UpdateProfile from './components/Profile/UpdateDeleteProfile/UpdateProfile';\r\nimport Preloader from './components/common/Preloader/Preloader';\r\nimport { initializeApp, clearAllFocusedWindows } from './redux/app-reducer';\r\nimport { compose } from 'redux';\r\nimport { connect } from 'react-redux';\r\nimport ChatDetail from './components/Chats/ChatItem/ChatDetail';\r\n\r\n\r\nconst App = React.memo((props) => {\r\n \r\n\r\n        console.log('rerender')\r\n        console.log(props.initialized)\r\n        useEffect(() => {props.initializeApp()}, [])\r\n        if((!props.initialized)) return <Preloader/>\r\n        return (\r\n                <div className='whole-app-page-wrapper' onClick={()=>{ props.clearAllFocusedWindows()   }}>\r\n                <div className='app-wrapper'>\r\n                        <Header />\r\n                        <Navbar />\r\n                        <div className='app-wrapper-content'>\r\n                        <Route path='/profile/:userId?'\r\n                                        render={() => <Profile />} />\r\n                        <Route path='/profile_update'\r\n                                render={() => <UpdateProfile />} />\r\n                        <Route path='/login' render={() => <Login />} />\r\n                        <Route path='/users'\r\n                                render={() => <UsersContainer />} />\r\n                        <Route exact path='/chats'\r\n                                render={() => <ChatsContainer   />} />\r\n                        <Route path='/chats/:chatType/:name?'\r\n                                render={() => <ChatDetail />} />\r\n                        </div>\r\n                </div>\r\n                </div>\r\n\r\n        )\r\n})\r\n\r\nconst mapStateToProps = (state) => ({\r\n        initialized: state.app.initialized,\r\n});\r\n\r\nexport default compose(\r\n        withRouter,\r\n        connect(mapStateToProps, {initializeApp,\r\n                clearAllFocusedWindows\r\n        })\r\n )(App);\r\n ","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","let initialState = {};\r\n\r\nconst sidebarReducer = (state = initialState, action) => {\r\n    return state;\r\n}\r\n\r\nexport default sidebarReducer;","import {applyMiddleware, combineReducers, createStore, compose} from \"redux\";\r\nimport {reducer as formReducer} from \"redux-form\";\r\n\r\nimport profileReducer from \"./profile-reducer\";\r\nimport chatsReducer from \"./chats-reducer\";\r\nimport sidebarReducer from \"./sidebar-reducer\";\r\nimport usersReducer from \"./users-reducer\";\r\nimport authReducer from \"./auth-reducer\";\r\nimport thunkMiddleware from \"redux-thunk\";\r\nimport appReducer from \"./app-reducer\";\r\n\r\nlet reducers = combineReducers({\r\n    profilePage: profileReducer,\r\n    chatsPage: chatsReducer,\r\n    sidebar: sidebarReducer,\r\n    usersPage: usersReducer,\r\n    auth: authReducer,\r\n    form: formReducer,\r\n    app: appReducer,\r\n});\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\nconst store = createStore(reducers, composeEnhancers(applyMiddleware(thunkMiddleware)));\r\n\r\nwindow.__store__ = store;\r\nexport default store;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nimport {BrowserRouter, HashRouter} from \"react-router-dom\"; \r\nimport store from './redux/redux-store';\r\nimport { Provider } from 'react-redux'; \r\n\r\nimport reactDebugHooks from 'react-debug-hooks'\r\nreactDebugHooks(React)\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\n \r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <HashRouter> \r\n\r\n    <Provider store={store} >\r\n      <App/>\r\n    </Provider>\r\n    </HashRouter>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n  ); \r\n\r\nserviceWorker.unregister();\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"profile_info\":\"ProfileInfo_profile_info__3Xye6\",\"landi_block\":\"ProfileInfo_landi_block__6gqOF\",\"descriptionBlock\":\"ProfileInfo_descriptionBlock__KO8pz\",\"ava_block\":\"ProfileInfo_ava_block__a6DMK\",\"username\":\"ProfileInfo_username__3sJav\",\"userinfo\":\"ProfileInfo_userinfo__zdjYE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"chats\":\"Chats_chats__26r34\",\"chats_header\":\"Chats_chats_header__2ZjAD\",\"chatsItems\":\"Chats_chatsItems__2Ger5\",\"createChat\":\"Chats_createChat__ciYfP\",\"addMember\":\"Chats_addMember__3K9eK\",\"getMemberList\":\"Chats_getMemberList___8yTw\",\"addMemberHeader\":\"Chats_addMemberHeader__2bT9H\",\"createChatHeader\":\"Chats_createChatHeader__1fp0w\",\"createChatForm\":\"Chats_createChatForm__qU4P4\",\"chatItem\":\"Chats_chatItem__d-61Y\",\"chatItemData\":\"Chats_chatItemData__3Q4U3\",\"chatItemPhoto\":\"Chats_chatItemPhoto__8OaoM\",\"chatLMBody\":\"Chats_chatLMBody__PdKCq\",\"chatLMSended\":\"Chats_chatLMSended__30pkV\",\"chatLMAuthorName\":\"Chats_chatLMAuthorName__32CRr\",\"chatLMAuthorNameDotted\":\"Chats_chatLMAuthorNameDotted__1J1Z0\",\"chatItemNewMsgsNum\":\"Chats_chatItemNewMsgsNum__1LG1Q\",\"chatItemName\":\"Chats_chatItemName__1M4vy\",\"member\":\"Chats_member__3xMbX\",\"memberName\":\"Chats_memberName__3s-UI\",\"memberPhoto\":\"Chats_memberPhoto__1n1Td\",\"chatSettings\":\"Chats_chatSettings__3ql28\",\"chatSettingsMembersList\":\"Chats_chatSettingsMembersList__1BctW\",\"smthElseList\":\"Chats_smthElseList__3Nx2r\",\"subElem\":\"Chats_subElem__1REmT\",\"subElem2\":\"Chats_subElem2__2R59R\",\"infoItem\":\"Chats_infoItem__3fkvK\",\"deleteChat\":\"Chats_deleteChat__3vv4E\",\"renameChatItem\":\"Chats_renameChatItem__1GfT8\",\"addBorder\":\"Chats_addBorder__3HJO5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"postsBlock\":\"MyPosts_postsBlock__2VQZc\",\"myPostsHeader\":\"MyPosts_myPostsHeader__1m1Iu\",\"createPost\":\"MyPosts_createPost__287DL\",\"posts\":\"MyPosts_posts__zffl0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fileImageActivate\":\"Message_fileImageActivate__nEFNT\",\"fileImageDeactivate\":\"Message_fileImageDeactivate__38RWt\",\"messageFile\":\"Message_messageFile__333Xv\",\"currentChat\":\"Message_currentChat__2SCp-\",\"trash\":\"Message_trash__1XG-x\",\"chatsHeader\":\"Message_chatsHeader__1aH3p\",\"chatsHeaderSettings\":\"Message_chatsHeaderSettings__3yzbg\",\"chatsSettings\":\"Message_chatsSettings__2drea\",\"chatsSettingsItem\":\"Message_chatsSettingsItem__3uDhW\",\"chatsSettingsItemForm\":\"Message_chatsSettingsItemForm__366Ei\",\"chatsSettingsItemH\":\"Message_chatsSettingsItemH__1h7H8\",\"chatsMembers\":\"Message_chatsMembers__2noEW\",\"usersForChatActive\":\"Message_usersForChatActive__3uOxB\",\"userForChat\":\"Message_userForChat__2MVhF\",\"chatsMembersActive\":\"Message_chatsMembersActive__1xxl7\",\"chatMember\":\"Message_chatMember__2En4H\",\"chatMemberSettings\":\"Message_chatMemberSettings__1qLcz\",\"chatsHeaderName\":\"Message_chatsHeaderName__3H2k1\",\"chatsHeaderPhoto\":\"Message_chatsHeaderPhoto__uBOeZ\",\"chatsHeaderPhotoAlt\":\"Message_chatsHeaderPhotoAlt__NVmFR\",\"messages\":\"Message_messages__3MN93\",\"loadOldMsgsDiv\":\"Message_loadOldMsgsDiv__2dBwp\",\"startChatDiv\":\"Message_startChatDiv__2C1ls\",\"newMsgsStartTag\":\"Message_newMsgsStartTag__1o397\",\"message\":\"Message_message__dqadB\",\"messageBody\":\"Message_messageBody__2oQBg\",\"messageSendedEdited\":\"Message_messageSendedEdited__927WX\",\"messageSended\":\"Message_messageSended__2c3O9\",\"messageEdited\":\"Message_messageEdited__108XK\",\"messageAuthorName\":\"Message_messageAuthorName__3J3wb\",\"createMessageForm\":\"Message_createMessageForm__2iUaw\",\"editMessage\":\"Message_editMessage__24hZ6\",\"deleteMessage\":\"Message_deleteMessage__2mrWg\",\"editField\":\"Message_editField__1PtXF\",\"error\":\"Message_error__1wiZz\",\"errorField\":\"Message_errorField__MR1Xt\",\"countChars\":\"Message_countChars__M9urq\",\"smthElseListActive\":\"Message_smthElseListActive__y4JSK\",\"subElemMSBs\":\"Message_subElemMSBs__2b8dk\",\"membOperLink\":\"Message_membOperLink__3T6zI\",\"infoItemMSBs\":\"Message_infoItemMSBs__dVy0_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__1SlV4\",\"loginBlock\":\"Header_loginBlock__3Y7F0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"paginator\":\"paginator_paginator__16emb\",\"pageNumber\":\"paginator_pageNumber__25CnE\",\"selectedPage\":\"paginator_selectedPage__3QX2R\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"userPhoto\":\"Users_userPhoto__108sy\",\"userChoosePhoto\":\"Users_userChoosePhoto__1FPZ5\",\"bottom\":\"Users_bottom__KcjiA\",\"selectedPage\":\"Users_selectedPage__3HiCL\"};"],"sourceRoot":""}